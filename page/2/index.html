<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>如云泊</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="">





    <meta property="og:type" content="website">
<meta property="og:title" content="如云泊">
<meta property="og:url" content="https://lifeislife.cn/page/2/index.html">
<meta property="og:site_name" content="如云泊">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Dominic">
<meta name="twitter:card" content="summary">





<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="../../css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PS8L2EEEPR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PS8L2EEEPR');
</script>


    


<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="atom.xml" title="如云泊" type="application/atom+xml">
</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="../../index.html">
                
                <img src="../../images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="../../archives">Archives</a>
            
            <a class="navbar-item "
               href="../../about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜索" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" target="_blank" rel="noopener" href="https://github.com/Dunky-Z">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/12/23/%E8%A7%A3%E5%86%B3Adobe-Photoshop%E6%AD%A3%E7%89%88%E5%8D%87%E7%BA%A7%E5%BC%B9%E7%AA%97/" itemprop="url">解决Adobe Photoshop正版升级弹窗</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-12-23T04:08:36.000Z" itemprop="datePublished">12月 23 2023</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            4 分钟 读完 (约 590 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h2><p>不知什么原因，一直正常使用的Adobe Photoshop 2021突然开始弹窗提示升级，还是日文的（应该是代理到到日本了），可能根据地区不同，弹窗的内容也不同，但是都是提示升级，倒计时10天，不知道十天之后啥情况。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/23/a8b83c2f3e0916e9b2fd92dc7332dc89.png"></p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>Adobe的其他软件同理，比如我在用的Lightroom也是这样，解决方法也是一样的。以下方式基于Windows 11，其他版本的Windows也是类似的。</p>
<p><strong>如果没有用代理</strong>，可以直接将Photoshop程序禁止联网。可以通过配置Windows的防火墙来实现，具体方法如下：</p>
<ol>
<li><p>打开设置搜索“防火墙”，打开Windows防火墙，选择“高级设置”。</p>
<p> <img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/23/a38bd63b6c184481c797cd3143e3b21d.png"></p>
</li>
<li><p>选择“出站规则”，点击“新建规则”，选择规则类型为“程序”，程序选择为Photoshop的安装目录下的Photoshop.exe，然后选择“阻止连接”，一路下一步，最后命名规则为“禁止Photoshop联网”。<br> <img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/23/31498beb037fc282838480a3624850cc.png"></p>
</li>
</ol>
<p><strong>如果使用了代理</strong>，防火墙可能会被绕过，Photoshop可能仍然会通过代理访问更新服务器。需要通过配置代理将Photoshop禁止代理。如果不配置，可以在<strong>每次打开Adobe相关软件前关闭代理</strong>，如果配置，这里以Clash for Windows为例，可以通过配置Clash的规则来实现，不用关闭代理。具体方法如下：</p>
<p>点击“Profiles”，选择自己的订阅，右击选择“Edit”，将以下这些规则添加到配置文件中保存即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- PROCESS-NAME,Lightroom.exe,REJECT</span><br><span class="line">- PROCESS-NAME,lightroom.exe,REJECT</span><br><span class="line">- PROCESS-NAME,Photoshop.exe,REJECT</span><br><span class="line">- PROCESS-NAME,photoshop.exe,REJECT</span><br><span class="line">- PROCESS-NAME,Adobe Lightroom CEF Helper.exe,REJECT</span><br><span class="line">- PROCESS-NAME,AdobeIPCBroker.exe,REJECT</span><br><span class="line">- PROCESS-NAME,dynamiclinkmanager.exe,REJECT</span><br><span class="line">- PROCESS-NAME,dynamiclinkmediaserver.exe,REJECT</span><br></pre></td></tr></table></figure>

<p>其他程序你可以自己添加，格式为<code>PROCESS-NAME,程序名,REJECT</code>。表示拒绝这些程序访问网络。</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/12/17/ZWIFT%E4%BD%BF%E7%94%A8Tips/" itemprop="url">ZWIFT使用Tips</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-12-17T05:24:55.000Z" itemprop="datePublished">12月 17 2023</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            几秒 读完 (约 84 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/17/0573bf51587d55e549ac5fd4719733b4.png"></p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/17/6fb1f8bb10562bb55eb8b7eddb97a0ce.png"></p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="启动后闪退"><a href="#启动后闪退" class="headerlink" title="启动后闪退"></a>启动后闪退</h2><p>将输入法切换为英文模式再重新启动。</p>
<h2 id="没有其他玩家，只有自己"><a href="#没有其他玩家，只有自己" class="headerlink" title="没有其他玩家，只有自己"></a>没有其他玩家，只有自己</h2><p>挂全局代理重新启动。</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/12/16/Nexus-%E9%95%9C%E5%83%8F%E4%BB%A3%E7%90%86/" itemprop="url">Nexus搭建内部镜像</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-12-16T04:16:34.000Z" itemprop="datePublished">12月 16 2023</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/Self-Hosted/">Self-Hosted</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            18 分钟 读完 (约 2748 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h1><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">version: "3.8"
services:
  nexus:
    image: sonatype/nexus3
    container_name: nexus
    restart: always
    ports:
      - 8081:8081
    volumes:
      - /srv/nexus/data:/nexus-data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改/srv/nexus目录的所有者为当前用户：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chown</span> -R username:username /srv/nexus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改data目录有最高权限，否则无法启动成功：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> -R <span class="token number">777</span> /srv/nexus/data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="代理Docker-Hub"><a href="#代理Docker-Hub" class="headerlink" title="代理Docker Hub"></a>代理Docker Hub</h1><h2 id="登录WEB页面"><a href="#登录WEB页面" class="headerlink" title="登录WEB页面"></a>登录WEB页面</h2><p>登录WEB页面，地址为：<a href="http://192.168.1.9:8081。">http://192.168.1.9:8081。</a><br>用户名为：admin，密码通过命令获取：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token builtin class-name">exec</span> nexus3 <span class="token function">cat</span> /nexus-data/admin.password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="创建Blob"><a href="#创建Blob" class="headerlink" title="创建Blob"></a>创建Blob</h2><p>在 Nexus Repository Manager 中，Blob Store（二进制大对象存储）是一个用于存储仓库数据的核心组件。Blob Store 主要用于存储各种二进制文件，例如软件包、依赖库、构建产物等，这些文件通常被称为“blob”。</p>
<p>Blob Store 的作用包括：</p>
<ol>
<li><p><strong>存储二进制文件：</strong> Blob Store 被设计用来安全、可靠地存储二进制文件。这些文件可以是各种形式的构建产物、软件包、依赖库等。Blob Store 是 Nexus 仓库管理系统的核心，它为这些文件提供了一个中央存储位置。</p>
</li>
<li><p><strong>支持不同类型的存储后端：</strong> Nexus 支持不同类型的 Blob Store，例如本地文件系统、云存储（如Amazon S3、Google Cloud Storage）等。这使得用户可以根据需求选择不同的存储后端，并根据实际情况进行扩展或迁移。</p>
</li>
<li><p><strong>提供存储策略：</strong> Blob Store 允许你定义存储策略，以确定何时以及如何清理或删除不再需要的文件。这对于管理仓库的存储空间非常重要，可以根据策略自动清理不再需要的快照或旧版本。</p>
</li>
<li><p><strong>支持代理和缓存：</strong> 在 Maven Repository 的场景下，Blob Store 还可以用于代理远程 Maven 仓库，并缓存远程仓库中的文件。这有助于提高构建性能，减少对远程仓库的依赖。</p>
</li>
</ol>
<p>我们缓存的镜像需要存储为blob，所以需要创建一个Blob store。点击左侧菜单栏的Blob Stores，然后点击Create blob store，选择Type为File，Name填写为dockerhub。</p>
<h2 id="创建Repository"><a href="#创建Repository" class="headerlink" title="创建Repository"></a>创建Repository</h2><p>在 Nexus Repository Manager 中，有三种主要的仓库类型：Hosted Repository、Proxy Repository、和 Group Repository。每种类型都有不同的作用和用途：</p>
<ul>
<li><p>Hosted Repository（托管仓库）:</p>
<ul>
<li>作用： 用于存储和管理本地创建的部署（deploy）的二进制文件。这包括你自己或你的团队创建的库，例如 Maven 构件、npm 包、Docker 镜像等。</li>
<li>使用场景： 当你需要在内部存储和分享自己创建的构建产物时，你可以使用 Hosted Repository。</li>
</ul>
</li>
<li><p>Proxy Repository（代理仓库）:</p>
<ul>
<li>作用： 用于代理和缓存远程仓库的二进制文件。当你从远程仓库获取构建依赖时，Proxy Repository 会将这些文件缓存在本地，从而提高构建性能并减少对远程仓库的依赖。</li>
<li>使用场景： 在构建过程中，你通常会依赖于一些公共的远程仓库，例如 Maven Central、npm registry、Docker Hub等。使用 Proxy Repository 可以有效地管理这些依赖并减少对远程仓库的直接访问。</li>
</ul>
</li>
<li><p>Group Repository（组合仓库）:</p>
<ul>
<li>作用： 允许你将多个仓库组合成一个逻辑单元。当你需要在构建中同时使用多个仓库的内容时，Group Repository 可以将这些仓库组合在一起，使它们在应用程序中看起来像一个单一的仓库。</li>
<li>使用场景： 当你有多个 Proxy Repository 或 Hosted Repository 时，你可以使用 Group Repository 将它们组合在一起。这对于简化构建配置、统一依赖管理等非常有用。</li>
</ul>
</li>
</ul>
<p>我们一般创建三个仓库，proxy代理公共镜像，hosted保存自己的镜像，group将proxy和hosted组合在一起。我们分别创建三个仓库。</p>
<h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><p>点击左侧菜单栏的Repositories，然后点击Create repository，选择Docker (proxy)，按照下图填写：</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/65fc511b83db1d0af9a6559da6a80162.png"></p>
<p>Remote storage 图中填写为<code>https://registry-1.docker.io</code>，这是dockerhub的地址。但是实测会很慢，所以我们使用加速地址<code>https://dockerproxy.com</code>。需要注意修改一下。</p>
<blockquote>
<p>还有一些国内镜像源可选，可以参考这个项目。<a target="_blank" rel="noopener" href="https://github.com/docker-practice/docker-registry-cn-mirror-test/actions/runs/7228669255">Test Registry · docker-practice/docker-registry-cn-mirror-test@83a4dd4</a></p>
</blockquote>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/c41a82504deb2a41eab15e4674199445.png"></p>
<p>Blob store选择为刚刚创建的<code>dockerhub</code>。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/2a4e0d1685e2d3e8a984bc46c0f039d2.png"></p>
<h3 id="hosted"><a href="#hosted" class="headerlink" title="hosted"></a>hosted</h3><p>hosted比较简单，只需要填个名称就行了，这里填写为<code>docker-hosted</code>。</p>
<h3 id="group"><a href="#group" class="headerlink" title="group"></a>group</h3><p>group 需要注意以下：</p>
<ol>
<li>HTTP需要单独设置端口号。我们设置与WEB页面不同的端口号，8082即可。</li>
<li>需要将proxy和hosted都添加到group中，这样才能将两个仓库组合在一起。</li>
</ol>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/922dcd44e678c2e22df359100fe32d53.png"></p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/8c4d65a43860e9b921eafc6898276123.png"></p>
<h2 id="启用Realms"><a href="#启用Realms" class="headerlink" title="启用Realms"></a>启用Realms</h2><p>这里要在 Security-Realms 里面启用 Docker Bearer Token Realm。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/6dadf22bfabdf994b394e93a5beb6001.png"></p>
<h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><p>如果直接使用docker pull拉取镜像，会报错：</p>
<pre class="line-numbers language-base" data-language="base"><code class="language-base">$ docker pull 192.168.1.9:8082/redis

Using default tag: latest
Error response from daemon: Get "https://192.168.1.9:8082/v2/": http: server gave HTTP response to HTTPS client<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>编辑<code>/etc/docker/daemon.json</code>文件，添加以下内容：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"insecure-registries"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"192.168.1.9:8082"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"http://192.168.1.9:8082"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意：registry-mirrors中只保留一个Nexus的地址，这样默认就会从Nexus拉取镜像。如果有多个地址，就可能会从其他地址拉取镜像。因为我们在Nexus中配置的URL就是docker-proxy的地址，他就是一个国内代理地址，所以这里我们只保留一个Nexus的地址就行。<br>注意： insecure-registries 拼写，不要写成 insecure-registry。最好直接复制，json格式很严格。</p>
</blockquote>
<p>重启Docker服务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>登录Docker Registry：</p>
<p>需要注意的shi，这里的用户名和密码是Nexus的用户名和密码，不是Docker Hub的用户名和密码。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker login <span class="token number">192.168</span>.1.9:8082 -u admin -p admin123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>拉取镜像：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ docker pull redis                      

Using default tag: latest
latest: Pulling from redis
1f7ce2fa46ab: Already exists 
4827e9d1e197: Pull complete 
5845062cfda9: Pull complete 
44d659adcf8b: Pull complete 
b6962d83313d: Pull complete 
5d29cf86ecab: Pull complete 
4f4fb700ef54: Pull complete 
3a2d9f90268c: Pull complete 
Digest: sha256:249e1bfb9448ae9e76807748f8cb3c5cc73e55441b7b36364c61a7428c9e814c
Status: Downloaded newer image <span class="token keyword">for</span> <span class="token number">192.168</span>.1.9:8082/redis:latest
<span class="token number">192.168</span>.1.9:8082/redis:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以在首页的Browse Docker中看到镜像已经被缓存了。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/151588f16856a1e6e2d5215d230ed0de.png"></p>
<h2 id="推送镜像"><a href="#推送镜像" class="headerlink" title="推送镜像"></a>推送镜像</h2><p>如果你需要上传自己修改的镜像，那么就需要修改之前的docker-hosted，其中HTTP中该为8083，和docker-proxy的端口号区分。这样我们就可以从8082下载镜像，从8083推送镜像。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2024/01/17/be0df03ad283819763b6a9f97ce88a59.png"></p>
<p>首先我们需要重命名镜像，格式如下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker tag <span class="token operator">&lt;</span>imageId or imageName<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>nexus-hostname<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>repository-port<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>image<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>tag<span class="token operator">&gt;</span>
docker tag af340544ed62 <span class="token number">192.168</span>.1.9:8083/hello-world:mytag
docker push <span class="token number">192.168</span>.1.9:8083/hello-world:mytag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>拉取这个镜像：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker pull <span class="token number">192.168</span>.1.9:8083/hello-world:mytag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="代理-YUM-源"><a href="#代理-YUM-源" class="headerlink" title="代理 YUM 源"></a>代理 YUM 源</h1><h1 id="代理-APT-源"><a href="#代理-APT-源" class="headerlink" title="代理 APT 源"></a>代理 APT 源</h1><p>和 YUM 源代理稍有不同的是，APT 源代理时没有 Group 仓库，但是使用APT源的系统如Ubuntu也是有多个版本的，我们只需要在 Distribution 参数里填写需要代理的版本即可，每隔版本用逗号分隔。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2024/03/01/11753bea79901711a31f9e435d31fc91.png"></p>
<p>常用的版本以及代号如下：</p>
<ul>
<li>Ubuntu 16.04 Xenial Xerus</li>
<li>Ubuntu 18.04 Bionic Beaver</li>
<li>Ubuntu 20.04 Focal Fossa</li>
<li>Ubuntu 21.04 Hirsute Hippo</li>
<li>Ubuntu 21.10 Impish Indri</li>
<li>Ubuntu 22.04 Jammy Jellyfish</li>
<li>Ubuntu 22.10 Kinetic Kudu</li>
<li>Ubuntu 23.04 Lunar Lobster</li>
<li>Ubuntu 23.10 Mantic Minotau</li>
</ul>
<p>代理地址为：<a target="_blank" rel="noopener" href="http://192.168.1.9:8081/repository/apt-proxy/%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%9C%A8Ubuntu%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E5%9C%B0%E5%9D%80%E6%9D%A5%E4%BB%A3%E7%90%86APT%E6%BA%90%E3%80%82%E4%BF%AE%E6%94%B9%60/etc/apt/sources.list%60%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B0%86%E5%8E%9F%E6%9D%A5%E7%9A%84%E6%BA%90%E5%9C%B0%E5%9D%80%E6%9B%BF%E6%8D%A2%E4%B8%BANexus%E7%9A%84%E5%9C%B0%E5%9D%80%E5%8D%B3%E5%8F%AF%E3%80%82">http://192.168.1.9:8081/repository/apt-proxy/，我们可以在Ubuntu中使用这个地址来代理APT源。修改`/etc/apt/sources.list`文件，将原来的源地址替换为Nexus的地址即可。</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span>
deb http://192.168.1.9:8081/repository/apt-proxy/ jammy main restricted universe multiverse
<span class="token comment"># deb-src http://192.168.1.9:8081/repository/apt-proxy/ jammy main restricted universe multiverse</span>
deb http://192.168.1.9:8081/repository/apt-proxy/ jammy-updates main restricted universe multiverse
<span class="token comment"># deb-src http://192.168.1.9:8081/repository/apt-proxy/ jammy-updates main restricted universe multiverse</span>
deb http://192.168.1.9:8081/repository/apt-proxy/ jammy-backports main restricted universe multiverse
<span class="token comment"># deb-src http://192.168.1.9:8081/repository/apt-proxy/ jammy-backports main restricted universe multiverse</span>

deb http://192.168.1.9:8081/repository/apt-proxy/ jammy-security main restricted universe multiverse
<span class="token comment"># deb-src http://192.168.1.9:8081/repository/apt-proxy/ jammy-security main restricted universe multiverse</span>

<span class="token comment"># 预发布软件源，不建议启用</span>
<span class="token comment"># deb http://192.168.1.9:8081/repository/apt-proxy/ jammy-proposed main restricted universe multiverse</span>
<span class="token comment"># # deb-src http://192.168.1.9:8081/repository/apt-proxy/ jammy-proposed main restricted universe multiverse</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="代理-pip-源"><a href="#代理-pip-源" class="headerlink" title="代理 pip 源"></a>代理 pip 源</h1><p>使用阿里云作为代理，我们需要在Nexus中创建一个PyPI代理仓库。点击左侧菜单栏的Repositories，然后点击Create repository，选择PyPI (proxy)，按照下图填写：</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/%2F2024%2F03%2F15%2Fc88f9c65dceb08b3b1b701a6625a4764.png"></p>
<p>再创建一个PyPI Group仓库，将刚刚创建的PyPI代理仓库和PyPI Hosted仓库添加到Group仓库中。</p>
<p>编辑<code>/etc/pip.conf</code>文件，添加以下内容：</p>
<blockquote>
<p>或者在用户目录下的<code>~/.pip/pip.conf</code>文件中添加</p>
</blockquote>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">[global]
index = http://192.168.1.9:8081/repository/pypi/
index-url = http://192.168.1.9:8081/repository/pypi/simple
trusted-host =  192.168.1.9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="在-WSL2-中使用-Nexus-代理"><a href="#在-WSL2-中使用-Nexus-代理" class="headerlink" title="在 WSL2 中使用 Nexus 代理"></a>在 WSL2 中使用 Nexus 代理</h1><p>因为 WSL2 使用的是宿主机Windows的Docker desktop作为Docker引擎，所以我们需要在Windows中配置Docker的代理。打开Docker Desktop，点击Settings，然后选择Docker Engine，添加以下内容：</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/%2F2024%2F03%2F15%2Ffa63bec3941423faa870438fc14b06e5.png"></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"builder"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"gc"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"defaultKeepStorage"</span><span class="token operator">:</span> <span class="token string">"20GB"</span><span class="token punctuation">,</span>
      <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"experimental"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"insecure-registries"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"http://192.168.1.9:8082"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"http://192.168.1.9:8082"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重启Docker Desktop。然后在WSL2中使用 <code>docker info</code> 查看是否配置成功。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/%2F2024%2F03%2F15%2Fa4bf4946f10cce7d25cd5f25ce104fc5.png"></p>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="docker-login-nexus-unauthorized-authentication-required"><a href="#docker-login-nexus-unauthorized-authentication-required" class="headerlink" title="docker login nexus unauthorized authentication required"></a>docker login nexus unauthorized authentication required</h2><ol>
<li>确认登录密码是否正确，密码为Nexus登录密码</li>
<li>却是否启用Realms</li>
</ol>
<h2 id="docker-login-nexus-connection-refused"><a href="#docker-login-nexus-connection-refused" class="headerlink" title="docker login nexus connection refused"></a>docker login nexus connection refused</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker login <span class="token number">192.168</span>.1.9:8082 -u admin -p admin123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li><p>确认Docker compose配置文件中已经将端口8082暴露，如果新增需要重启Nexus</p>
</li>
<li><p>确认防火墙关闭或者已经打开端口</p>
<ol>
<li>```bash<br> sudo ufw allow 8082<br> sudo ufw allow 8082/tcp <pre class="line-numbers language-none"><code class="language-none">
3. 确认已经将私有仓库添加到了`/etc/docker/daemon.json`，并且及时重启了docker服务

    1. ```bash
        sudo systemctl restart docker.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>确认已经开启了Http connector</p>
<ol>
<li>如图：<br><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2023/12/16/922dcd44e678c2e22df359100fe32d53.png"></li>
</ol>
</li>
</ol>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></body></html>
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/12/14/Tunasync%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E7%AB%99/" itemprop="url">Tunasync 搭建私有镜像站</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-12-14T06:15:54.000Z" itemprop="datePublished">12月 14 2023</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/Self-Hosted/">Self-Hosted</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            6 分钟 读完 (约 954 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="Tunasync-项目简介"><a href="#Tunasync-项目简介" class="headerlink" title="Tunasync 项目简介"></a>Tunasync 项目简介</h1><p>Tunasync 是一个开源的镜像站点镜像工具，可以帮助你快速搭建一个镜像站点，也可以帮助你快速的同步镜像站点的镜像。我们所熟知的清华大学镜像站就是使用 Tunasync 来同步镜像的。</p>
<h1 id="准备-workspace"><a href="#准备-workspace" class="headerlink" title="准备 workspace"></a>准备 workspace</h1><p>创建目录用于存放 Tunasync 的程序、配置文件和数据库文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/username/tunasync</span><br><span class="line">mkdir /home/username/tunasync/conf</span><br><span class="line">mkdir /home/username/tunasync/db</span><br></pre></td></tr></table></figure>

<p>创建目录用于存放镜像文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /srv/mirrors</span><br></pre></td></tr></table></figure>

<p>srv 目录需要 root 权限，将 mirrors 目录的所有者改为当前用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R username:username /srv/mirrors</span><br></pre></td></tr></table></figure>

<h1 id="下载-Tunasync"><a href="#下载-Tunasync" class="headerlink" title="下载 Tunasync"></a>下载 Tunasync</h1><p>可以从 <a target="_blank" rel="noopener" href="https://github.com/tuna/tunasync">Tunasync 项目</a>的 Github releases 编译好的程序直接使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/username/tunasync</span><br><span class="line">wget https://github.com/tuna/tunasync/releases/download/v0.8.0/tunasync-linux-amd64-bin.tar.gz</span><br><span class="line">tar -zxvf tunasync-linux-amd64-bin.tar.gz</span><br></pre></td></tr></table></figure>

<h1 id="配置-Tunasync"><a href="#配置-Tunasync" class="headerlink" title="配置 Tunasync"></a>配置 Tunasync</h1><h2 id="Manager-配置"><a href="#Manager-配置" class="headerlink" title="Manager 配置"></a>Manager 配置</h2><p>创建配置文件<code>/home/username/tunasync/conf/manager.conf</code>，并添加以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">debug = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[server]</span><br><span class="line">addr = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">port = 12345</span><br><span class="line">ssl_cert = <span class="string">&quot;&quot;</span></span><br><span class="line">ssl_key = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[files]</span><br><span class="line">db_type = <span class="string">&quot;bolt&quot;</span></span><br><span class="line">db_file = <span class="string">&quot;/home/username/tunasync/db/manager.db&quot;</span></span><br><span class="line">ca_cert = <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Worker-配置"><a href="#Worker-配置" class="headerlink" title="Worker 配置"></a>Worker 配置</h2><p>创建配置文件<code>/home/username/tunasync/conf/worker-openeuler.conf</code>，并添加以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">name = <span class="string">&quot;openeuler_worker&quot;</span></span><br><span class="line">log_dir = <span class="string">&quot;/srv/mirrors/log/tunasync/&#123;&#123;.Name&#125;&#125;&quot;</span></span><br><span class="line">mirror_dir = <span class="string">&quot;/srv/mirrors&quot;</span></span><br><span class="line">concurrent = 10</span><br><span class="line">interval = 1440</span><br><span class="line"></span><br><span class="line">[manager]</span><br><span class="line">api_base = <span class="string">&quot;http://localhost:12345&quot;</span></span><br><span class="line">token = <span class="string">&quot;some_token&quot;</span></span><br><span class="line">ca_cert = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[cgroup]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">base_path = <span class="string">&quot;/sys/fs/cgroup&quot;</span></span><br><span class="line">group = <span class="string">&quot;tunasync&quot;</span></span><br><span class="line"></span><br><span class="line">[server]</span><br><span class="line">hostname = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">listen_addr = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">listen_port = 16010</span><br><span class="line">ssl_cert = <span class="string">&quot;&quot;</span></span><br><span class="line">ssl_key = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[[mirrors]]</span><br><span class="line">name = <span class="string">&quot;centos&quot;</span></span><br><span class="line">provider = <span class="string">&quot;rsync&quot;</span></span><br><span class="line">upstream = <span class="string">&quot;rsync://mirrors.tuna.tsinghua.edu.cn/openeuler/&quot;</span></span><br><span class="line">use_ipv6 = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h1 id="启动-Tunasync"><a href="#启动-Tunasync" class="headerlink" title="启动 Tunasync"></a>启动 Tunasync</h1><h2 id="启动-Manager"><a href="#启动-Manager" class="headerlink" title="启动 Manager"></a>启动 Manager</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/username/tunasync</span><br><span class="line">./tunasync manager -c conf/manager.conf &gt;&gt; /srv/mirrors/<span class="built_in">log</span>/plog/manager.log &amp;</span><br></pre></td></tr></table></figure>

<h2 id="启动-Worker"><a href="#启动-Worker" class="headerlink" title="启动 Worker"></a>启动 Worker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/username/tunasync</span><br><span class="line">./tunasync worker -c conf/worker-openeuler.conf &gt;&gt; /srv/mirrors/<span class="built_in">log</span>/plog/worker-openeuler.log &amp;</span><br></pre></td></tr></table></figure>

<p>通常可能同步不止一个镜像站点，可以创建多个 Worker 配置文件，然后启动多个 Worker。</p>
<h1 id="创建-web-服务"><a href="#创建-web-服务" class="headerlink" title="创建 web 服务"></a>创建 web 服务</h1><ol>
<li><p><strong>安装 Apache2：</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install apache2</span><br></pre></td></tr></table></figure></li>
<li><p><strong>修改配置文件：</strong></p>
<p> Ubuntu 中的 Apache2 主要配置文件是 <code>/etc/apache2/apache2.conf</code>。可以在此文件中进行全局配置，也可以使用专门的配置文件，例如 <code>/etc/apache2/sites-available/your-site.conf</code>。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apache2/apache2.conf</span><br></pre></td></tr></table></figure>

<p> 在 <code>apache2.conf</code> 文件中，添加以下行，设置 <code>DocumentRoot</code> 和目录访问权限：</p>
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /mirrors</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;/mirrors&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p> 请确保将 <code>&lt;Directory&gt;</code> 部分添加到正确的位置。可以在文件中找到 <code>&lt;Directory /var/www/&gt;</code> 部分，然后在该部分下添加配置。</p>
</li>
<li><p><strong>重新启动 Apache2 服务：</strong></p>
<p> 在进行配置更改后，需要重新启动 Apache2 服务以使更改生效：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure></li>
<li><p><strong>补充文件：</strong></p>
<p> 将 <code>index.html</code> 文件和其他需要的文件添加到 <code>/srv/mirrors</code> 目录中。</p>
</li>
<li><p><strong>测试：</strong></p>
<p> 打开 Web 浏览器，访问 <code>http://your-server-ip</code> 或 <code>http://localhost</code>，应该能够看到 <code>/srv/mirrors</code> 目录中的文件。</p>
</li>
<li><p>如打不开，需要开启防火墙</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow http</span><br><span class="line">sudo ufw allow https</span><br></pre></td></tr></table></figure></li>
<li><p>修改 Web 服务端口</p>
<ol>
<li><p><strong>编辑 Apache2 配置文件：</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apache2/ports.conf</span><br></pre></td></tr></table></figure></li>
<li><p>**在文件中找到 <strong>​</strong><code>Listen</code><strong>​ ** 行，修改端口：</strong></p>
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">Listen</span></span> <span class="number">2081</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>编辑虚拟主机配置（如果有）：</strong></p>
<p> 如果你有虚拟主机配置文件（通常在 <code>/etc/apache2/sites-available/</code> 中），确保其中的 <code>&lt;VirtualHost&gt;</code> 部分中的端口也被修改为 2081。</p>
</li>
<li><p><strong>保存并退出配置文件。</strong></p>
</li>
<li><p><strong>重启 Apache 服务：</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="打开防火墙端口"><a href="#打开防火墙端口" class="headerlink" title="打开防火墙端口"></a>打开防火墙端口</h3><pre><code>1. **打开 2081 端口：**

    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 2081</span><br></pre></td></tr></table></figure>

2. **检查配置：**

    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>

    确保 2081 端口已经正确添加。
3. **重启防火墙（可选）：**

    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure>

    或者

    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart ufw</span><br></pre></td></tr></table></figure>

这样，你就将 Apache2 Web 服务的端口修改为 2081，并且只开放了 2081 端口。确保修改了防火墙规则后，仍能够通过新的端口访问你的网站。
</code></pre>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/12/14/VSCode-Linux%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%8E%AF%E5%A2%83/" itemprop="url">VSCode Linux内核源码阅读环境</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-12-14T02:02:32.000Z" itemprop="datePublished">12月 14 2023</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/">工欲善其事必先利其器</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 分钟 读完 (约 342 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="安装Clangd插件"><a href="#安装Clangd插件" class="headerlink" title="安装Clangd插件"></a>安装Clangd插件</h2><p>在VSCode中，你可以通过以下步骤安装Clangd插件：</p>
<ul>
<li>打开VSCode；</li>
<li>点击左侧的插件图标（Ctrl+Shift+X）；</li>
<li>搜索“Clangd”插件；</li>
<li>点击“安装”按钮。</li>
</ul>
<h2 id="生成compile-commands-json"><a href="#生成compile-commands-json" class="headerlink" title="生成compile_commands.json"></a>生成compile_commands.json</h2><p>对于make项目来说，常规来讲，可以使用Bear来对源码生成compile_commands.json。首先安装Bear：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install bear</span><br></pre></td></tr></table></figure>

<p>然后在项目根目录下执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bear make -j32</span><br></pre></td></tr></table></figure>

<p>编译完成后，会在项目根目录下生成compile_commands.json文件。</p>
<blockquote>
<p>对于CMAKE项目来说，可以在CMakeLists.txt中添加以下语句，然后重新编译项目即可生成compile_commands.json文件：<br>set(CMAKE_EXPORT_COMPILE_COMMANDS True)</p>
</blockquote>
<h2 id="配置Clangd插件"><a href="#配置Clangd插件" class="headerlink" title="配置Clangd插件"></a>配置Clangd插件</h2><p>进入到项目目录下，下载配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth 1 https://github.com/Dunky-Z/dot-vscode.git .vscode</span><br></pre></td></tr></table></figure>

<p>主要修改<code>--compile-commands-dir</code>参数，将其修改为自己的路径。</p>
<p>随便打开内核源码文件，clangd将会自动生成索引，并将索引文件.idx保存在项目根目录下的.cache目录中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Linux-5.4</span><br><span class="line">├── .cache</span><br><span class="line">│   └── clangd</span><br><span class="line">├── .config</span><br><span class="line">├── .git</span><br></pre></td></tr></table></figure>

<p>如果生成了索引文件，那么说明配置成功，可以打开源码文件看看是否能够正常跳转。</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/12/13/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91/" itemprop="url">嵌入式Linux驱动开发环境搭建踩坑</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-12-13T14:59:23.000Z" itemprop="datePublished">12月 13 2023</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            7 分钟 读完 (约 1073 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>通过<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1Gnh9G8a05LSgHYlohyl93Q?pwd=root#list/path=%2F">文档资料百度网盘</a>下载配套资料，学习手册目录中有嵌入式Linux应用开发完全手册V5.1_STM32MP157_Pro开发板.pdf，里面有详细的开发环境搭建步骤，但是在搭建过程中还是遇到了一些问题，记录如下：</p>
<h2 id="ModuleNotFoundError-No-module-named-‘requests’"><a href="#ModuleNotFoundError-No-module-named-‘requests’" class="headerlink" title="ModuleNotFoundError: No module named ‘requests’"></a>ModuleNotFoundError: No module named ‘requests’</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">../repo/repo init -u https://gitee.com/weidongshan/manifests.git -b linux-sdk -m stm32mp1/100ask_stm32mp157_pro_release-v2.0.xml --no-repo-verify</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/nic/develop/repo/main.py&quot;</span>, line 56, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from subcmds.version import Version</span><br><span class="line">  File <span class="string">&quot;/home/nic/develop/repo/subcmds/__init__.py&quot;</span>, line 35, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    mod = __import__(__name__,</span><br><span class="line">  File <span class="string">&quot;/home/nic/develop/repo/subcmds/selfupdate.py&quot;</span>, line 22, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from subcmds.sync import _PostRepoUpgrade</span><br><span class="line">  File <span class="string">&quot;/home/nic/develop/repo/subcmds/sync.py&quot;</span>, line 74, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from project import Project</span><br><span class="line">  File <span class="string">&quot;/home/nic/develop/repo/project.py&quot;</span>, line 33, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import requests</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">&#x27;requests&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install requests</span><br></pre></td></tr></table></figure>

<h2 id="ModuleNotFoundError-No-module-named-‘formatter’"><a href="#ModuleNotFoundError-No-module-named-‘formatter’" class="headerlink" title="ModuleNotFoundError: No module named ‘formatter’"></a>ModuleNotFoundError: No module named ‘formatter’</h2><p>formatter已经在python3.4标记成废弃接口，在python3.10已经正式删除，并且其依赖的cStringIO也已经删除。所以不能简单的安装formatter模块，可以通过两种方式解决：</p>
<h3 id="方法一：降低python版本到3-9以下"><a href="#方法一：降低python版本到3-9以下" class="headerlink" title="方法一：降低python版本到3.9以下"></a>方法一：降低python版本到3.9以下</h3><ol>
<li>添加 ppa 源，此源可安装多个 python 版本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:deadsnakes/ppa</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装 python3.9</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3.9</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>建立 python 的组,并添加 Python3.9 的可选项，优先级为 1</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.9 1</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>验证当前 python 是否是 3.9 版本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python --version</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>如果不是，用以下命令手动配置一下</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config python</span><br></pre></td></tr></table></figure>

<h3 id="方法二：修改repo源码"><a href="#方法二：修改repo源码" class="headerlink" title="方法二：修改repo源码"></a>方法二：修改repo源码</h3><p>将<code>repo/repo/subcmds/help.py</code>文件替换为如下内容：</p>
<blockquote>
<p>也可以参考<a target="_blank" rel="noopener" href="https://gerrit-review.googlesource.com/c/git-repo/+/303282">Google修复后的代码</a>，根据diff修改文件。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright (C) 2008 The Android Open Source Project</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> textwrap</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> subcmds <span class="keyword">import</span> all_commands</span><br><span class="line"><span class="keyword">from</span> color <span class="keyword">import</span> Coloring</span><br><span class="line"><span class="keyword">from</span> command <span class="keyword">import</span> PagedCommand, MirrorSafeCommand, GitcAvailableCommand, GitcClientCommand</span><br><span class="line"><span class="keyword">import</span> gitc_utils</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Help</span>(<span class="params">PagedCommand, MirrorSafeCommand</span>):</span></span><br><span class="line">  common = <span class="literal">False</span></span><br><span class="line">  helpSummary = <span class="string">&quot;Display detailed help on a command&quot;</span></span><br><span class="line">  helpUsage = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">%prog [--all|command]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">  helpDescription = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Displays detailed usage information about a command.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_PrintCommands</span>(<span class="params">self, commandNames</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Helper to display |commandNames| summaries.&quot;&quot;&quot;</span></span><br><span class="line">    maxlen = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> commandNames:</span><br><span class="line">      maxlen = <span class="built_in">max</span>(maxlen, <span class="built_in">len</span>(name))</span><br><span class="line">    fmt = <span class="string">&#x27;  %%-%ds  %%s&#x27;</span> % maxlen</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> commandNames:</span><br><span class="line">      command = all_commands[name]()</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">        summary = command.helpSummary.strip()</span><br><span class="line">      <span class="keyword">except</span> AttributeError:</span><br><span class="line">        summary = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="built_in">print</span>(fmt % (name, summary))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_PrintAllCommands</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;usage: repo COMMAND [ARGS]&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The complete list of recognized repo commands are:&#x27;</span>)</span><br><span class="line">    commandNames = <span class="built_in">list</span>(<span class="built_in">sorted</span>(all_commands))</span><br><span class="line">    self._PrintCommands(commandNames)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;See &#x27;repo help &lt;command&gt;&#x27; for more information on a &quot;</span></span><br><span class="line">          <span class="string">&#x27;specific command.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_PrintCommonCommands</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;usage: repo COMMAND [ARGS]&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The most commonly used repo commands are:&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gitc_supported</span>(<span class="params">cmd</span>):</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(cmd, GitcAvailableCommand) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(cmd, GitcClientCommand):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">if</span> self.manifest.isGitcClient:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">isinstance</span>(cmd, GitcClientCommand):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">      <span class="keyword">if</span> gitc_utils.get_gitc_manifest_dir():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    commandNames = <span class="built_in">list</span>(<span class="built_in">sorted</span>([name</span><br><span class="line">                                <span class="keyword">for</span> name, command <span class="keyword">in</span> all_commands.items()</span><br><span class="line">                                <span class="keyword">if</span> command.common <span class="keyword">and</span> gitc_supported(command)]))</span><br><span class="line">    self._PrintCommands(commandNames)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;See &#x27;repo help &lt;command&gt;&#x27; for more information on a specific command.\n&quot;</span></span><br><span class="line">        <span class="string">&quot;See &#x27;repo help --all&#x27; for a complete list of recognized commands.&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_PrintCommandHelp</span>(<span class="params">self, cmd, header_prefix=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">_Out</span>(<span class="params">Coloring</span>):</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, gc</span>):</span></span><br><span class="line">        Coloring.__init__(self, gc, <span class="string">&#x27;help&#x27;</span>)</span><br><span class="line">        self.heading = self.printer(<span class="string">&#x27;heading&#x27;</span>, attr=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self._first = <span class="literal">True</span></span><br><span class="line">      </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">_PrintSection</span>(<span class="params">self, heading, bodyAttr</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">          body = <span class="built_in">getattr</span>(cmd, bodyAttr)</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> body == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> body <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._first:</span><br><span class="line">          self.nl()</span><br><span class="line">        self._first = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        self.heading(<span class="string">&#x27;%s%s&#x27;</span>, header_prefix, heading)</span><br><span class="line">        self.nl()</span><br><span class="line">        self.nl()</span><br><span class="line"></span><br><span class="line">        me = <span class="string">&#x27;repo %s&#x27;</span> % cmd.NAME</span><br><span class="line">        body = body.strip()</span><br><span class="line">        body = body.replace(<span class="string">&#x27;%prog&#x27;</span>, me)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Extract the title, but skip any trailing &#123;#anchors&#125;.</span></span><br><span class="line">        asciidoc_hdr = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^\n?#+ ([^&#123;]+)(\&#123;#.+\&#125;)?$&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> para <span class="keyword">in</span> body.split(<span class="string">&quot;\n\n&quot;</span>):</span><br><span class="line">          <span class="keyword">if</span> para.startswith(<span class="string">&#x27; &#x27;</span>):</span><br><span class="line">            self.write(<span class="string">&#x27;%s&#x27;</span>, para)</span><br><span class="line">            self.nl()</span><br><span class="line">            self.nl()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">          m = asciidoc_hdr.match(para)</span><br><span class="line">          <span class="keyword">if</span> m:</span><br><span class="line">            self.heading(<span class="string">&#x27;%s%s&#x27;</span>, header_prefix, m.group(<span class="number">1</span>))</span><br><span class="line">            self.nl()</span><br><span class="line">            self.nl()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">          lines = textwrap.wrap(para.replace(<span class="string">&#x27;  &#x27;</span>, <span class="string">&#x27; &#x27;</span>), width=<span class="number">80</span>,</span><br><span class="line">                                break_long_words=<span class="literal">False</span>, break_on_hyphens=<span class="literal">False</span>)</span><br><span class="line">          <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            self.write(<span class="string">&#x27;%s&#x27;</span>, line)</span><br><span class="line">            self.nl()</span><br><span class="line">          self.nl()</span><br><span class="line"></span><br><span class="line">    out = _Out(self.manifest.globalConfig)</span><br><span class="line">    out._PrintSection(<span class="string">&#x27;Summary&#x27;</span>, <span class="string">&#x27;helpSummary&#x27;</span>)</span><br><span class="line">    cmd.OptionParser.print_help()</span><br><span class="line">    out._PrintSection(<span class="string">&#x27;Description&#x27;</span>, <span class="string">&#x27;helpDescription&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_PrintAllCommandHelp</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> <span class="built_in">sorted</span>(all_commands):</span><br><span class="line">      cmd = all_commands[name]()</span><br><span class="line">      cmd.manifest = self.manifest</span><br><span class="line">      self._PrintCommandHelp(cmd, header_prefix=<span class="string">&#x27;[%s] &#x27;</span> % (name,))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_Options</span>(<span class="params">self, p</span>):</span></span><br><span class="line">    p.add_option(<span class="string">&#x27;-a&#x27;</span>, <span class="string">&#x27;--all&#x27;</span>,</span><br><span class="line">                 dest=<span class="string">&#x27;show_all&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>,</span><br><span class="line">                 <span class="built_in">help</span>=<span class="string">&#x27;show the complete list of commands&#x27;</span>)</span><br><span class="line">    p.add_option(<span class="string">&#x27;--help-all&#x27;</span>,</span><br><span class="line">                 dest=<span class="string">&#x27;show_all_help&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>,</span><br><span class="line">                 <span class="built_in">help</span>=<span class="string">&#x27;show the --help of all commands&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Execute</span>(<span class="params">self, opt, args</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(args) == <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">if</span> opt.show_all_help:</span><br><span class="line">        self._PrintAllCommandHelp()</span><br><span class="line">      <span class="keyword">elif</span> opt.show_all:</span><br><span class="line">        self._PrintAllCommands()</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        self._PrintCommonCommands()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(args) == <span class="number">1</span>:</span><br><span class="line">      name = args[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">        cmd = all_commands[name]()</span><br><span class="line">      <span class="keyword">except</span> KeyError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;repo: &#x27;%s&#x27; is not a repo command.&quot;</span> % name, file=sys.stderr)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">      cmd.manifest = self.manifest</span><br><span class="line">      self._PrintCommandHelp(cmd)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      self._PrintCommandHelp(self)</span><br></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/11/19/%E8%A7%A3%E5%86%B3Ubuntu%E6%9B%B4%E6%96%B0%E6%BA%90%E6%8A%A5%E9%94%99Clearsigned-file-isn-t-valid-got-NOSPLIT/" itemprop="url">解决Ubuntu更新源报错Clearsigned file isnt valid, got NOSPLIT</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-11-19T13:18:09.000Z" itemprop="datePublished">11月 19 2023</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 分钟 读完 (约 205 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>

<p>在更新源时报错 Clearsigned file isn’t valid, got ‘NOSPLIT’ (does the network require authentication?)。</p>
<p>换中科大的源解决，其余源无法解决。</p>
<p>如要用于其他版本，把 jammy 换成其他版本代号即可: 22.04：jammy；20.04：focal；18.04：bionic；16.04：xenial；14.04：trusty。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认注释了源码仓库，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span></span><br></pre></td></tr></table></figure>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/11/18/%E4%BD%BF%E7%94%A8Gitea%E9%83%A8%E7%BD%B2%E4%B8%AA%E4%BA%BA%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93/" itemprop="url">使用Gitea部署个人代码仓库</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-11-18T10:17:42.000Z" itemprop="datePublished">11月 18 2023</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/Self-Hosted/">Self-Hosted</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            3 分钟 读完 (约 451 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="docker-compose-部署"><a href="#docker-compose-部署" class="headerlink" title="docker-compose 部署"></a>docker-compose 部署</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">postgres:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5432</span><span class="string">:5432</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">br-net-gitea</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./postgresql:/var/lib/postgresql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/var/lib/postgresql/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/gitea:1.20.5</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_UID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_GID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__DB_TYPE=postgres</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__HOST=192.168.1.9:5432</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__NAME=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__USER=user</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__PASSWD=123456</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">br-net-gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/git/.ssh/:/data/git/.ssh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3000</span><span class="string">:3000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:2222:22&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgres</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">act_runner:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/act_runner:latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA_INSTANCE_URL=http://192.168.1.9:3000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA_RUNNER_REGISTRATION_TOKEN=Qw5Qf4A1bTENfIOQlc1NSNyFYMLp7TAtSujb5ihF</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA_RUNNER_NAME=docker_runner</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./act_runner/act_data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./act_runner/act_cache:/root/.cache</span></span><br></pre></td></tr></table></figure>

<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="首次登录web时没有创建管理员账号，如何登录"><a href="#首次登录web时没有创建管理员账号，如何登录" class="headerlink" title="首次登录web时没有创建管理员账号，如何登录"></a>首次登录web时没有创建管理员账号，如何登录</h2><p>打开Gitea网页注册的第一个账号就是管理员账号。无需特殊设置。也无需找回密码。</p>
<h2 id="从Github导入仓库时报错：从不允许的主机导入"><a href="#从Github导入仓库时报错：从不允许的主机导入" class="headerlink" title="从Github导入仓库时报错：从不允许的主机导入"></a>从Github导入仓库时报错：从不允许的主机导入</h2><p>打开配置文件<code>gitea/conf/app.ini</code>，修改以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[migrations]</span><br><span class="line">ALLOW_LOCALNETWORKS    = true</span><br><span class="line">ALLOWED_DOMAINS = 127.0.0.1,192.168.31.100,github.com,*.github.com</span><br><span class="line">IMPORT_LOCAL_PATHS = true  ;; 导入本地仓库开关，false：设置为false，防止所有用户（包括admin）导入服务器上的本地路径。</span><br></pre></td></tr></table></figure>

<p><code>docker-compose restart gitea</code>重启容器。</p>
<blockquote>
<p>以下修改配置文件后，需要重启容器才能生效，不再赘述。</p>
</blockquote>
<h2 id="如何开启软件包"><a href="#如何开启软件包" class="headerlink" title="如何开启软件包"></a>如何开启软件包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[packages]</span><br><span class="line">ENABLED = true</span><br></pre></td></tr></table></figure>

<h2 id="开启action"><a href="#开启action" class="headerlink" title="开启action"></a>开启action</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[actions]</span><br><span class="line">ENABLED=true</span><br></pre></td></tr></table></figure>

<h2 id="error-response-from-daemon-server-gave-http-response-to-https-client"><a href="#error-response-from-daemon-server-gave-http-response-to-https-client" class="headerlink" title="error response from daemon server gave http response to https client"></a>error response from daemon server gave http response to https client</h2><p>docker login 报错</p>
<p>配置/etc/docker/daemon.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;insecure-registries&quot;: [</span><br><span class="line">    &quot;192.168.1.9:2010&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="如何上传docker镜像到gitea制品库"><a href="#如何上传docker镜像到gitea制品库" class="headerlink" title="如何上传docker镜像到gitea制品库"></a>如何上传docker镜像到gitea制品库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 登录你的镜像仓库，也就是你的 Gitea 服务器地址</span><br><span class="line">docker login 192.168.1.9:2010</span><br><span class="line"></span><br><span class="line"># 从官方仓库拉取一个 nginx:latest 镜像，并改名</span><br><span class="line">docker pull nginx:latest</span><br><span class="line">docker tag nginx:latest 192.168.1.9:2010/zhangsan/nginx:latest</span><br><span class="line"></span><br><span class="line"># 推送镜像到 Gitea 服务器</span><br><span class="line">docker push 192.168.1.9:2010/zhangsan/nginx:latest</span><br></pre></td></tr></table></figure>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/09/19/ocrmypdf-%E8%AE%A9PDF%E5%8F%AF%E6%90%9C%E7%B4%A2/" itemprop="url">ocrmypdf 让 PDF 可搜索</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-09-19T11:51:18.000Z" itemprop="datePublished">9月 19 2023</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/">工欲善其事必先利其器</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            7 分钟 读完 (约 990 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>买的一些课程配套资料都是 PDF 格式的，为了防止盗版都事先用的图片转成的 PDF，这样 PDF 里的内容既没法复制也没法搜索，在查找资料里的关键词的时候就很不方便，所以就想着把这些 PDF 转成可搜索的 PDF。找到了一款工具叫做 ocrmypdf，可以把 PDF 转成可搜索的 PDF，而且还支持中文，这里记录一下使用方法。详细使用文档可以参考官方文档<a target="_blank" rel="noopener" href="https://ocrmypdf.readthedocs.io/en/latest/installation.html"> OCRmyPDF documentation</a>。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ocrmypdf</span><br></pre></td></tr></table></figure>

<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="指定-OCR-的语言"><a href="#指定-OCR-的语言" class="headerlink" title="指定 OCR 的语言"></a>指定 OCR 的语言</h2><p>安装语言包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install tesseract-ocr-chi-sim</span><br></pre></td></tr></table></figure>

<p>查看是否安装成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tesseract --list-langs</span><br><span class="line">List of available languages (3):</span><br><span class="line">chi_sim</span><br><span class="line">eng</span><br><span class="line">osd</span><br></pre></td></tr></table></figure>

<p>注意参数 <code>-l</code> 后面的语言包名称是下划线，而不是短横线。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ocrmypdf -l chi_sim input.pdf output.pdf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$  ocrmypdf -l chi_sim  --redo-ocr  input.pdf output.pdf</span><br><span class="line">Scanning contents: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 752/752 [00:14&lt;00:00, 51.36page/s]</span><br><span class="line">Start processing 24 pages concurrently</span><br><span class="line">   33 redoing OCR                                                                                                                                                 </span><br><span class="line">   26 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">   54 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">   88 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  119 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  203 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  256 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  265 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  347 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  376 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  383 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  386 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  402 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  404 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  403 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  412 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  415 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  410 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  439 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  519 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  526 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  587 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  591 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  595 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  607 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  644 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  661 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  682 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  720 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">  742 [tesseract] lots of diacritics - possibly poor OCR                                                                                                          </span><br><span class="line">OCR: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 752.0/752.0 [03:41&lt;00:00,  3.40page/s]</span><br><span class="line">Postprocessing...</span><br><span class="line">Some input metadata could not be copied because it is not permitted <span class="keyword">in</span> PDF/A. You may wish to examine the output PDF<span class="string">&#x27;s XMP metadata.                              </span></span><br><span class="line"><span class="string">PDF/A conversion: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 752/752 [01:09&lt;00:00, 10.80page/s]</span></span><br><span class="line"><span class="string">Recompressing JPEGs: 0image [00:00, ?image/s]</span></span><br><span class="line"><span class="string">Deflating JPEGs: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 756/756 [00:00&lt;00:00, 920.21image/s]</span></span><br><span class="line"><span class="string">JBIG2: 0item [00:00, ?item/s]</span></span><br><span class="line"><span class="string">Optimize ratio: 1.20 savings: 17.0%</span></span><br><span class="line"><span class="string">Output file is okay but is not PDF/A (seems to be No PDF/A metadata in XMP)</span></span><br></pre></td></tr></table></figure>

<p>转换的结果还不错，页面排版不会改变，保持原样，但是搜索文字时可能需要用空格分开。</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2023/09/08/uCore-%E5%AE%9E%E9%AA%8C%E7%AC%AC0%E7%AB%A0-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url">uCore-实验第 0 章 - 实验环境搭建</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2023-09-08T02:46:20.000Z" itemprop="datePublished">9月 8 2023</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/uCore-%E5%AE%9E%E9%AA%8C/">uCore 实验</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 分钟 读完 (约 212 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <blockquote>
<p>本次实验是清华大学操作系统课程的课程实验，实验内容是基于 RISC-V 架构的 uCore 操作系统。本次实验的目的是搭建实验环境，为后续实验做准备。指导书参考<a target="_blank" rel="noopener" href="https://learningos.github.io/uCore-Tutorial-Guide-2023S/index.html">uCore-Tutorial-Guide-2023S 文档</a>。本系列文章内容主要是指导书的补充以及我在实验过程的一些理解。</p>
</blockquote>
<p>本章没有什么需要特别说明的，指导手册十分详细，按照指导手册的步骤一步步来就可以了。因为平时也在用 WSL2 开发，所以配置十分顺利，没有遇到什么问题。这篇文章就当占坑了，如果后续有什么需要补充的再来更新。</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous">
        <a href="../../">上一页</a>
    </div>
    <div class="pagination-next">
        <a href="../3/">下一页</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link" href="../../">1</a></li>
        
        <li><a class="pagination-link is-current" href="">2</a></li>
        
        <li><a class="pagination-link" href="../3/">3</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="../27/">27</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Dominic&nbsp;
                powered_by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="../../js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '../../content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="../../js/insight.js"></script>

    
</body>
</html>