<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>如云泊</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="">










<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="../../css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>



<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="atom.xml" title="如云泊" type="application/atom+xml">
</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="../../index.html">
                
                <img src="../../images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/12/24/Ubuntu-18-04-%E5%AE%89%E8%A3%85Clang-LLVM-11/" itemprop="url">Ubuntu 18.04 安装Clang/LLVM 11</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-12-24T07:53:22.000Z" itemprop="datePublished">12月 24 2022</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            6 分钟 读完 (约 908 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="从-APT-安装"><a href="#从-APT-安装" class="headerlink" title="从 APT 安装"></a>从 APT 安装</h2><p>Install the GPG Key for <code>https://apt.llvm.org/</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -<br></code></pre></td></tr></table></figure>

<p>Add the repo for Clang 11 <code>stable-old</code> for Ubuntu 18.04 Bionic</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-11 main&quot;</span> | sudo tee -a /etc/apt/sources.list<br>sudo apt-get update<br></code></pre></td></tr></table></figure>

<p>Install practically everything (except <code>python-clang-11</code> which for some reason doesn’t work)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt-get install libllvm-11-ocaml-dev libllvm11 llvm-11 llvm-11-dev llvm-11-doc llvm-11-examples llvm-11-runtime \<br>clang-11 clang-tools-11 clang-11-doc libclang-common-11-dev libclang-11-dev libclang1-11 clang-format-11 clangd-11 \<br>libfuzzer-11-dev lldb-11 lld-11 libc++-11-dev libc++abi-11-dev libomp-11-dev -y<br></code></pre></td></tr></table></figure>

<p>Make Clang 11 and everything related to it defaults</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo update-alternatives \<br>  --install /usr/lib/llvm              llvm             /usr/lib/llvm-11         50 \<br>  --slave   /usr/bin/llvm-config       llvm-config      /usr/bin/llvm-config-11  \<br>  --slave   /usr/bin/llvm-ar           llvm-ar          /usr/bin/llvm-ar-11 \<br>  --slave   /usr/bin/llvm-as           llvm-as          /usr/bin/llvm-as-11 \<br>  --slave   /usr/bin/llvm-bcanalyzer   llvm-bcanalyzer  /usr/bin/llvm-bcanalyzer-11 \<br>  --slave   /usr/bin/llvm-cov          llvm-cov         /usr/bin/llvm-cov-11 \<br>  --slave   /usr/bin/llvm-diff         llvm-diff        /usr/bin/llvm-diff-11 \<br>  --slave   /usr/bin/llvm-dis          llvm-dis         /usr/bin/llvm-dis-11 \<br>  --slave   /usr/bin/llvm-dwarfdump    llvm-dwarfdump   /usr/bin/llvm-dwarfdump-11 \<br>  --slave   /usr/bin/llvm-extract      llvm-extract     /usr/bin/llvm-extract-11 \<br>  --slave   /usr/bin/llvm-link         llvm-link        /usr/bin/llvm-link-11 \<br>  --slave   /usr/bin/llvm-mc           llvm-mc          /usr/bin/llvm-mc-11 \<br>  --slave   /usr/bin/llvm-mcmarkup     llvm-mcmarkup    /usr/bin/llvm-mcmarkup-11 \<br>  --slave   /usr/bin/llvm-nm           llvm-nm          /usr/bin/llvm-nm-11 \<br>  --slave   /usr/bin/llvm-objdump      llvm-objdump     /usr/bin/llvm-objdump-11 \<br>  --slave   /usr/bin/llvm-ranlib       llvm-ranlib      /usr/bin/llvm-ranlib-11 \<br>  --slave   /usr/bin/llvm-readobj      llvm-readobj     /usr/bin/llvm-readobj-11 \<br>  --slave   /usr/bin/llvm-rtdyld       llvm-rtdyld      /usr/bin/llvm-rtdyld-11 \<br>  --slave   /usr/bin/llvm-size         llvm-size        /usr/bin/llvm-size-11 \<br>  --slave   /usr/bin/llvm-stress       llvm-stress      /usr/bin/llvm-stress-11 \<br>  --slave   /usr/bin/llvm-symbolizer   llvm-symbolizer  /usr/bin/llvm-symbolizer-11 \<br>  --slave   /usr/bin/llvm-tblgen       llvm-tblgen      /usr/bin/llvm-tblgen-11<br><br>sudo update-alternatives \<br>  --install /usr/bin/clang                 clang                  /usr/bin/clang-11    50 \<br>  --slave   /usr/bin/clang++               clang++                /usr/bin/clang++-11 \<br>  --slave   /usr/bin/lld                   lld                    /usr/bin/lld-11 \<br>  --slave   /usr/bin/clang-format          clang-format           /usr/bin/clang-format-11  \<br>  --slave   /usr/bin/clang-tidy            clang-tidy             /usr/bin/clang-tidy-11  \<br>  --slave   /usr/bin/clang-tidy-diff.py    clang-tidy-diff.py     /usr/bin/clang-tidy-diff-11.py \<br>  --slave   /usr/bin/clang-include-fixer   clang-include-fixer    /usr/bin/clang-include-fixer-11 \<br>  --slave   /usr/bin/clang-offload-bundler clang-offload-bundler  /usr/bin/clang-offload-bundler-11 \<br>  --slave   /usr/bin/clangd                clangd                 /usr/bin/clangd-11 \<br>  --slave   /usr/bin/clang-check           clang-check            /usr/bin/clang-check-11 \<br>  --slave   /usr/bin/scan-view             scan-view              /usr/bin/scan-view-11 \<br>  --slave   /usr/bin/clang-apply-replacements clang-apply-replacements /usr/bin/clang-apply-replacements-11 \<br>  --slave   /usr/bin/clang-query           clang-query            /usr/bin/clang-query-11 \<br>  --slave   /usr/bin/modularize            modularize             /usr/bin/modularize-11 \<br>  --slave   /usr/bin/sancov                sancov                 /usr/bin/sancov-11 \<br>  --slave   /usr/bin/c-index-test          c-index-test           /usr/bin/c-index-test-11 \<br>  --slave   /usr/bin/clang-reorder-fields  clang-reorder-fields   /usr/bin/clang-reorder-fields-11 \<br>  --slave   /usr/bin/clang-change-namespace clang-change-namespace  /usr/bin/clang-change-namespace-11 \<br>  --slave   /usr/bin/clang-import-test     clang-import-test      /usr/bin/clang-import-test-11 \<br>  --slave   /usr/bin/scan-build            scan-build             /usr/bin/scan-build-11 \<br>  --slave   /usr/bin/scan-build-py         scan-build-py          /usr/bin/scan-build-py-11 \<br>  --slave   /usr/bin/clang-cl              clang-cl               /usr/bin/clang-cl-11 \<br>  --slave   /usr/bin/clang-rename          clang-rename           /usr/bin/clang-rename-11 \<br>  --slave   /usr/bin/find-all-symbols      find-all-symbols       /usr/bin/find-all-symbols-11 \<br>  --slave   /usr/bin/lldb                  lldb                   /usr/bin/lldb-11 \<br>  --slave   /usr/bin/lldb-server           lldb-server            /usr/bin/lldb-server-11<br></code></pre></td></tr></table></figure>

<h2 id="Installing-CMake"><a href="#Installing-CMake" class="headerlink" title="Installing CMake"></a>Installing CMake</h2><p>Install Kitware’s GPG Key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2&gt;/dev/null | gpg --dearmor - | sudo tee /etc/apt/trusted.gpg.d/kitware.gpg &gt;/dev/null<br></code></pre></td></tr></table></figure>

<p>Add repository</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb https://apt.kitware.com/ubuntu/ bionic main&quot;</span> | sudo tee -a /etc/apt/sources.list<br>sudo apt-get update<br></code></pre></td></tr></table></figure>

<p>Install this optional package so you don’t have to mess with GPG keys anymore</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt-get install kitware-archive-keyring<br>sudo rm /etc/apt/trusted.gpg.d/kitware.gpg<br></code></pre></td></tr></table></figure>

<p>Now upgrade <code>cmake</code> if you already have it installed with <code>sudo apt-get upgrade -y</code> or just install it using <code>sudo apt-get install cmake -y</code> </p>
<h2 id="使用源码安装"><a href="#使用源码安装" class="headerlink" title="使用源码安装"></a>使用源码安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 更新软件包列表</span><br>sudo apt update<br><br><span class="hljs-comment"># 安装必要的依赖包</span><br>sudo apt install build-essential cmake python3-dev<br><br><span class="hljs-comment"># 下载 Clang/LLVM 11 的源代码</span><br>wget https://github.com/llvm/llvm-project/releases/download/llvmorg-11.0.0/llvm-11.0.0.src.tar.xz<br><br><span class="hljs-comment"># 解压源代码文件</span><br>tar xvf llvm-11.0.0.src.tar.xz<br><br><span class="hljs-comment"># 进入解压后的目录</span><br><span class="hljs-built_in">cd</span> llvm-11.0.0.src<br><br><span class="hljs-comment"># 创建一个新的目录，用于存放 Clang/LLVM 编译的结果</span><br>mkdir build<br><span class="hljs-built_in">cd</span> build<br><br><span class="hljs-comment"># 使用 cmake 编译 Clang/LLVM</span><br>cmake ..<br><br><span class="hljs-comment"># 编译 Clang/LLVM</span><br>make<br><br><span class="hljs-comment"># 安装 Clang/LLVM</span><br>sudo make install<br><br></code></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/12/04/%E6%AF%8F%E5%A4%A9%E5%AD%A6%E5%91%BD%E4%BB%A4-chown%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E6%8B%A5%E6%9C%89%E8%80%85/" itemprop="url">每天学命令-chown 修改文件拥有者</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-12-04T08:32:59.000Z" itemprop="datePublished">12月 4 2022</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/%E6%AF%8F%E5%A4%A9%E5%AD%A6%E5%91%BD%E4%BB%A4/">每天学命令</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 分钟 读完 (约 337 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>chown 命令用来变更文件或目录的拥有者或所属群组，通过 chown 改变文件的拥有者和群组。用户可以是用户名或者用户 ID；组可以是组名或者组 ID；文件是以空格分开的文件列表，文件名也支持通配符。</p>
<h2 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash">chown [选项] [用户或组] [文件或目录]<br>-c或--changes           <span class="hljs-comment">#效果类似“-v”参数，但仅回报更改的部分；</span><br>-f或--quite或—-silent    <span class="hljs-comment">#不显示错误信息；</span><br>-h或--no-dereference    <span class="hljs-comment">#只对符号连接的文件作修改，而不更改其他任何相关文件；</span><br>-R或--recursive         <span class="hljs-comment">#递归处理，将指定目录下的所有文件及子目录一并处理；</span><br>-v或--version           <span class="hljs-comment">#显示指令执行过程；</span><br>--dereference          <span class="hljs-comment">#效果和“-h”参数相同；</span><br>--<span class="hljs-built_in">help</span>                 <span class="hljs-comment">#在线帮助</span><br>--reference=&lt;参考文件或目录&gt;   <span class="hljs-comment">#把指定文件或目录的拥有者与所属群组全部设成和参考文件或目录的拥有者与所属群组相同；</span><br>--version    <span class="hljs-comment">#显示版本信息。</span><br></code></pre></td></tr></table></figure>

<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>将文件<code>test.md</code>拥有者改为<code>nic</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">chown nic test.md<br></code></pre></td></tr></table></figure>

<p>将目录<code>/home/nic/develop</code>及其下面的所有文件、子目录的文件拥有者改为<code>nic</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">chown -R nic /home/nic/develop<br><br></code></pre></td></tr></table></figure>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/12/04/%E6%AF%8F%E5%A4%A9%E5%AD%A6%E5%91%BD%E4%BB%A4-tree%E6%98%BE%E7%A4%BA%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" itemprop="url">每天学命令-tree 显示目录结构</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-12-04T08:31:54.000Z" itemprop="datePublished">12月 4 2022</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/%E6%AF%8F%E5%A4%A9%E5%AD%A6%E5%91%BD%E4%BB%A4/">每天学命令</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            3 分钟 读完 (约 436 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Bash">-a   <span class="hljs-comment">#显示所有文件</span><br>-d   <span class="hljs-comment">#只显示目录（名称）</span><br>-l   <span class="hljs-comment">#显示链接文件的原始文件</span><br>-f   <span class="hljs-comment">#显示所列出的文件或目录的完整目录路径</span><br>-i   <span class="hljs-comment">#不以阶梯的形式显示文件或目录名称</span><br>-q   <span class="hljs-comment">#将控制字符以?字符代替，显示文件和目录名称</span><br>-N   <span class="hljs-comment">#直接显示文件或目录的名称</span><br>-p   <span class="hljs-comment">#显示每个文件的权限信息</span><br>-u   <span class="hljs-comment">#显示文件所有者或者uid</span><br>-g   <span class="hljs-comment">#显示文件所属组或者gid</span><br>-s   <span class="hljs-comment">#显示每个文件的大小信息</span><br>-h   <span class="hljs-comment">#以可读的方式显示文件的大小信息</span><br>-D   <span class="hljs-comment">#显示最后修改日期</span><br>-v   <span class="hljs-comment">#按字母数字正序显示文件</span><br>-r   <span class="hljs-comment">#按字母数字倒序显示文件</span><br>-t   <span class="hljs-comment">#按最后时间排序显示文件</span><br>-C   <span class="hljs-comment">#在文件和目录列表上加上色彩，便于区分文件类型</span><br>-P pattern    <span class="hljs-comment">#只显示匹配正则表式的文件或目录名称</span><br>-I pattern    <span class="hljs-comment">#与上结果相反</span><br><br></code></pre></td></tr></table></figure>



<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>显示当前目录及其子目录下的文件及目录名称</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Bash">$ tree                 <br>.<br>├── CODE_OF_CONDUCT.md<br>├── CONTRIBUTING.md<br>├── Fedora-35<br>│   ├── Dockerfile<br>│   └── Readme.md<br>├── LICENSE<br>├── README.md<br>├── Ubuntu-20<br>│   ├── Dockerfile<br>│   ├── Readme.md<br>│   ├── init_edkrepo_conf.sh<br>│   └── ubuntu20_dev_entrypoint.sh<br>└── Windows-2022<br>    ├── Dockerfile<br>    └── Readme.md<br><br>3 directories, 12 files<br></code></pre></td></tr></table></figure>

<p>只显示一层目录结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Bash">$ tree -L 1              <br>.<br>├── CODE_OF_CONDUCT.md<br>├── CONTRIBUTING.md<br>├── Fedora-35<br>├── LICENSE<br>├── README.md<br>├── Ubuntu-20<br>└── Windows-2022<br><br>3 directories, 4 files<br></code></pre></td></tr></table></figure>

<p>只显示目录不显示文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Bash">$ tree -d           <br>.<br>├── Fedora-35<br>├── Ubuntu-20<br>└── Windows-2022<br><br>3 directories<br></code></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/12/03/CodeReview%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%BC%A9%E5%86%99/" itemprop="url">CodeReview 中常见缩写</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-12-03T11:55:07.000Z" itemprop="datePublished">12月 3 2022</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            5 分钟 读完 (约 682 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <ul>
<li>ASAP: As Soon As Possible. 请尽快完成</li>
<li>ACK: Acknowledgement. 承认，同意。表示接受代码的改动</li>
<li>CR: Code Review. 请求代码审查</li>
<li>CCN: Code Comments Needed.需要的代码注释：在这里有一些简短的注释在高层次上描述每个主要代码块的作用（例如，“处理 HTTP 请求中的标头”）会很有帮助</li>
<li>DOODOO: Documentation Out Of Date Or Obsolete.文档过时或过时：此文档似乎不正确：是否过时？</li>
<li>DNM: Do not merge. 不要合并</li>
<li>ditto: 多个重复的表述，下一次可以用 ditto 表示同上</li>
<li>IMO: In My Opinion 在我看来、依我看、依我所见</li>
<li>LGT1: Looks Good To 1. 如果有一个回复 LGTM 则可以添加为 LGT1，1 代表目前有 1 个赞</li>
<li>LGT2: Looks Good To 2. 如果有两个回复 LGTM 则可以添加为 LGT2，2 代表目前有 2 个赞</li>
<li>LGTM: Looks Good To Me. 代码已经过 review，可以合并</li>
<li>MCE: Must Check for Errors.必须检查错误：这里可能会发生错误或异常情况，但您没有任何代码来处理此类事件</li>
<li>MR：merge request. 合并请求</li>
<li>NACK/NAK: Negative acknowledgement. 不同意，不接受这次的改动</li>
<li>IMHO: In My Humble Opinion IMO 谦虚的说法</li>
<li>IMO: In My Opinion. 在我看来</li>
<li>IIRC: If I Recall Correctly. 如果我没有记错的话</li>
<li>PR：Pull Request. 拉取请求，给其他项目提交代码</li>
<li>PTAL: Please Take A Look. 提示项目 Owner/contributor review</li>
<li>RFC: Request For Comment. 请求进行讨论，表示认为某个想法很好，邀请大家一起讨论一下</li>
<li>RCP: Repeated Code Pattern.重复代码模式：与上面几行非常相似的代码在许多不同的地方重复出现。找到一种方法来简化它（例如，定义一个隐藏细节的更高级别的 API，或者找到一个更集中的地方来执行这些操作，这样这里就不需要这段代码了）。</li>
<li>SGTM: Sounds Good To Me. 和上面那句意思差不多，也是已经通过了 review 的意思</li>
<li>TBD: To Be Done. 未完成，待续</li>
<li>TL;DR: Too Long; Don’t Read. PR 内容太多，没办法看</li>
<li>TMLI: Too Many Levels of Indentation.Too Many Levels of Indentation：缩进太深的代码很难阅读。在大多数情况下，可以重构代码以减少嵌套级别。</li>
<li>WIP: Work In Progress. 告诉项目维护者这个功能还未完成，方便维护者 review 已提交的代码</li>
<li>TBR: To Be Reviewed. 提示维护者进行 review</li>
<li>TBD: To Be Done (or Defined/Discussed/Decided/Determined). 根据语境不同意义有所区别，但一般都是还没搞定的意思</li>
</ul>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/12/03/OFFICE-%E8%A7%A3%E5%86%B3Word%E7%BC%96%E8%BE%91%E5%8D%A1%E9%A1%BF/" itemprop="url">OFFICE-解决 Word 编辑卡顿</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-12-03T11:01:27.000Z" itemprop="datePublished">12月 3 2022</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 分钟 读完 (约 126 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>打开 Word 很快，但是一编辑就特别卡，尤其时拖动表格时几乎是逐帧移动。这是硬件图形加速问题。解决方式如下。</p>
<ol>
<li>打开 Word，点击左上角—&gt;文件—&gt;选项—&gt;高级，一直拉到“显示”；</li>
<li>勾选<strong>禁用硬件图形加速</strong>；</li>
<li>取消勾选<strong>子像素定位平滑屏幕上的字体</strong>。</li>
</ol>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2022/12/03/7215b5c4712d13d43182a8c610d64c37.png"></p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/12/03/Git-clone%E4%B8%8B%E6%9D%A5%E7%9A%84%E5%88%86%E6%94%AF%E4%B8%8D%E5%AE%8C%E6%95%B4/" itemprop="url">Git clone下来的分支不完整</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-12-03T10:52:10.000Z" itemprop="datePublished">12月 3 2022</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/Git-%E5%AE%9E%E6%88%98/">Git 实战</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 分钟 读完 (约 125 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>将仓库<code>git clone</code>到本地后发现本地缺失了一些远程仓库的分支。一般发生在<code>git clone —depth 1</code>设置克隆深度时发生。因为有些大型项目一次性克隆容易出错，所以只克隆一层深度。</p>
<p>如远程有分支<code>branch_a</code>，克隆下来后使用<code>git branch -av</code>命令查看所有分支没有显示该分支，该如何解决？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">git remote set-branches origin <span class="hljs-string">&#x27;branch_a&#x27;</span><br>git fetch -v<br></code></pre></td></tr></table></figure>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/11/20/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%90%91%E5%BC%80%E6%BA%90%E7%A4%BE%E5%8C%BA%E6%8F%90Patch/" itemprop="url">手把手教你向开源社区提 Patch</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-11-20T07:11:57.000Z" itemprop="datePublished">11月 20 2022</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/Git-%E5%AE%9E%E6%88%98/">Git 实战</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            37 分钟 读完 (约 5611 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="提交补丁的最佳实践"><a href="#提交补丁的最佳实践" class="headerlink" title="提交补丁的最佳实践"></a>提交补丁的最佳实践</h1><blockquote>
<p>本文翻译自官方教程<a target="_blank" rel="noopener" href="https://git-scm.com/docs/MyFirstContribution">Git - MyFirstContribution</a>，原文包含开发到提交的整个周期。但是想要提交的人应该都已经开发完代码了，所以本文用自己的实际例子重新写了一遍，省去了开发代码等流程，重点介绍如何使用 git send-email。</p>
</blockquote>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="下载-OpenSBI-仓库"><a href="#下载-OpenSBI-仓库" class="headerlink" title="下载 OpenSBI 仓库"></a>下载 OpenSBI 仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/riscv-software-src/opensbi.git<br><span class="hljs-built_in">cd</span> opensbi<br></code></pre></td></tr></table></figure>

<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>要从源代码构建 OpenSBI：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注：OpenSBI 的构建是可并行的。上面的命令可以添加<code>-j#</code>参数，如<code>-j12</code>。</p>
</blockquote>
<h3 id="确认要解决的问题"><a href="#确认要解决的问题" class="headerlink" title="确认要解决的问题"></a>确认要解决的问题</h3><p>在本文档中，我们将模拟提交一个简单的 Patch，<code>.gitignore</code>文件可以过滤不必要的文件，现在使用 VSCode 的用户越来越多，使用 VSCode 开发时常常会生成<code>.vscode</code>目录，但是这些文件不该被推送至远程，原仓库中的<code>.gitignore</code>文件中没有过滤该文件，我们给他加上。</p>
<p>为了能够模拟一次发送多个<code>commit</code>的场景，我们将再添加一个<code>.so</code>用来过滤编译过程中生成的<code>.so</code>文件。</p>
<h3 id="建立工作空间"><a href="#建立工作空间" class="headerlink" title="建立工作空间"></a>建立工作空间</h3><p>让我们先建立一个开发分支来进行我们的修改。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b update_gitignore origin/master<br></code></pre></td></tr></table></figure>

<p>我们将在这里做一些提交，以演示如何将一个带有多个补丁的主题同时送审。</p>
<h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><h3 id="过滤-vscode"><a href="#过滤-vscode" class="headerlink" title="过滤 .vscode"></a>过滤 .vscode</h3><p>打开文件<code>.gitignore</code>，为该文件添加<code>/.vscode/</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Object files</span><br>*.o<br>*.a<br>*.dep<br><br><span class="hljs-comment">#Build &amp; install directories</span><br>build/<br>install/<br><br><span class="hljs-comment"># Development friendly files</span><br>tags<br>cscope*<br><br>/.vscode/<br></code></pre></td></tr></table></figure>

<p>为以上修改做一次提交：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git status<br>On branch update_gitignore<br>Your branch is up to date with <span class="hljs-string">&#x27;origin/master&#x27;</span>.<br><br>Changes not staged <span class="hljs-keyword">for</span> commit:<br>  (use <span class="hljs-string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)<br>  (use <span class="hljs-string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="hljs-keyword">in</span> working directory)<br><br>        modified:   .gitignore<br>$ git add .gitignore<br>$ git commit -s<br></code></pre></td></tr></table></figure>

<p>执行以上命令后将会弹出编辑框用来编写提交信息。主题行要少于 50 个字符，然后是一个空行（必须），然后是您的提交消息的正文。请记住要明确并提供更改的原因（理由），特别是如果无法从您的差异中轻松理解你的提交内容时。编辑提交消息时，不要删除上面 <code>Signed-off-by</code> 添加的 trailer。（由上面命令<code>-s</code>参数生成）。</p>
<p>其他规范请详细查阅目标社区的提交规范，如OpenSBI要求主题行需要以 <code>lib:</code>， <code>platform:</code>, <code>firmware:</code>, <code>docs:</code>, <code>utils:</code> 或者 <code>top:</code>为前缀，修改<code>.gitignore</code>属于<code>top</code>范畴，所以我们需要将其加在主题行上。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">top: filter .vscode folder<br><br>Filter the workspace&#x27;s &#x27;.vscode&#x27; directory by adding &#x27;/.vscode/&#x27; to the.gitignore file.<br><br>Signed-off-by: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br></code></pre></td></tr></table></figure>

<p>继续用 <code>git show</code> 检查您的新提交。尤其不要出现不需要在本次提交的内容。通常使用不同的 IDE 都可能会无意间生成一些配置文件等，请注意将其剔除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs text">commit 5dc340c29979d4c5d8c4d5a6e881348239714434 (HEAD -&gt; update_gitignore)<br>Author: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date:   Fri Nov 18 16:06:21 2022 +0800<br><br>    top: filter .vscode folder<br>    <br>    Filter the workspace&#x27;s &#x27;.vscode&#x27; directory by adding &#x27;/.vscode/&#x27; to the.gitignore file.<br>    <br>    Signed-off-by: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br><br>diff --git a/.gitignore b/.gitignore<br>index 95692bb..90cf552 100644<br>--- a/.gitignore<br>+++ b/.gitignore<br>@@ -10,3 +10,5 @@ install/<br> # Development friendly files<br> tags<br> cscope*<br>+<br>+/.vscode/<br></code></pre></td></tr></table></figure>

<h3 id="过滤-cache"><a href="#过滤-cache" class="headerlink" title="过滤 .cache"></a>过滤 .cache</h3><p>与上一节步骤类似，我们在<code>.gitignore</code>文件中再添加一个<code>/.cache/</code>字段用来过滤<code>.cache</code>文件夹。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Object files</span><br>*.o<br>*.a<br>*.dep<br><br><span class="hljs-comment">#Build &amp; install directories</span><br>build/<br>install/<br><br><span class="hljs-comment"># Development friendly files</span><br>tags<br>cscope*<br><br>/.vscode/<br>/.cache/<br></code></pre></td></tr></table></figure>

<p>添加完我们就即使保存工作进度，新生成一个<code>commit</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .gitignore<br>git commit -s<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">top: filter .cache folder<br><br>Filter the workspace&#x27;s &#x27;.cache&#x27; directory by adding &#x27;/.cache/&#x27; to the.gitignore file.<br><br>Signed-off-by: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br></code></pre></td></tr></table></figure>

<p>以上我们就已经准备好所有的代码了，在大部分场景下可能修改的是<code>.c</code>或者<code>.h</code>等源文件，这就需要我们能够使代码编译、运行并且测试通过后再提交。</p>
<p>这里为了演示提交流程，就没有涉及这些步骤。接下来我们就要准备提交的补丁文件了。</p>
<h2 id="准备提交补丁"><a href="#准备提交补丁" class="headerlink" title="准备提交补丁"></a>准备提交补丁</h2><p>OpenSBI 项目是通过电子邮件发送补丁来进行代码审查的，当补丁准备好并得到社区认可后，维护者就会应用（Apply）这些补丁。OpenSBI 项目不接受来自 Pull Request 的贡献，而且通过电子邮件发送的补丁需要以指定的方式进行审核。</p>
<p>在研究如何将你的提交转化为电子邮件的补丁之前，让我们先分析一下最终的结果，即<strong>补丁系列</strong>（Patch Series）是什么样子。下面是 OpenSBI 邮件列表存档的网页界面上的补丁系列的摘要视图的一个例子。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/16-32-16-e3a06471e8dc4a8dc2d7c7ca641043e2-20221118163214-5afd66.png"></p>
<p>我们可以注意几点：</p>
<ul>
<li>每次提交都是以单独的邮件形式发送，提交信息的标题为主题，前缀为<code>[PATCH i/n]</code>，代表<code>n</code>个提交系列中的第 <code>i</code> 个提交。</li>
<li>每个补丁都是作为对<code>cover letter</code>的回复，<code>cover letter</code>的前缀为<code>[PATCH 0/n]</code>，序号为 0 的标题。</li>
<li>补丁系列的后续迭代被标记为 <code>PATCH v2</code>、<code>PATCH v3</code>，等等，以代替 <code>PATCH</code>。例如，<code>[PATCH v2 1/3]</code>将是第二次迭代中三个补丁的第一个补丁。每次迭代都有一个新的<code>cover letter</code>（如上面的<code>[PATCH v2 0/3]</code>），本身就是对前一次迭代的<code>cover letter</code>的回复（下面会有更多介绍）。</li>
</ul>
<blockquote>
<p>注：单一补丁的主题是以<code>[PATCH]</code>、<code>[PATCH v2]</code>等发送的，没有 <code>i/n</code> 编号。如上图中的第四个 Patch，就是一个单一补丁。</p>
</blockquote>
<h3 id="什么是-cover-letter"><a href="#什么是-cover-letter" class="headerlink" title="什么是 cover letter"></a>什么是 cover letter</h3><p>除了给每个补丁发一封邮件外，OpenSBI 社区还希望你的补丁能附带一封 cover letter。这是修改提交的一个重要组成部分，因为它概括了你想要做什么，以及为什么要这样做，比仅仅看你的补丁更明显。</p>
<p>你的 cover letter 的标题应该是能简洁地涵盖你整个主题分支的目的。就像我们的提交信息标题一样。下面是我们的系列标题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Update gitignore ---<br></code></pre></td></tr></table></figure>

<p>cover letter 的正文是用来给评审员提供额外的背景。一定要解释任何你的补丁自己没有说清楚的东西，但要记住，由于 cover letter 没有记录在提交历史中，任何可能对未来版本库历史的读者有用的东西也应该在你的提交信息中出现。</p>
<p>下文我们将介绍如何生成 cover letter 以及如何填写 cover letter。</p>
<h3 id="用-git-send-email-发送补丁"><a href="#用-git-send-email-发送补丁" class="headerlink" title="用 git send-email 发送补丁"></a>用 git send-email 发送补丁</h3><h4 id="前提条件-设置-git-send-email"><a href="#前提条件-设置-git-send-email" class="headerlink" title="前提条件 - 设置 git send-email"></a>前提条件 - 设置 git send-email</h4><p>对 <code>send-email</code> 的配置会根据你的操作系统和电子邮件供应商而有所不同，配置可以参考文档<a href="http://lifeislife.cn/2022/09/28/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8git-send-mail%E7%BB%99%E5%BC%80%E6%BA%90%E7%A4%BE%E5%8C%BA%E6%8F%90%E4%BA%A4Patch/">如何使用 git-send-mail 给开源社区提交 Patch - 如云泊</a>。</p>
<h4 id="准备初始补丁集"><a href="#准备初始补丁集" class="headerlink" title="准备初始补丁集"></a>准备初始补丁集</h4><p>在准备邮件本身之前，你需要准备补丁。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git format-patch --cover-letter -o update_gitignore/ --base=auto  update_gitignore@&#123;u&#125;..update_gitignore<br></code></pre></td></tr></table></figure>

<ul>
<li><code>--cover-letter</code> 选项告诉 <code>format-patch</code> 为你创建一个 <code>cover letter</code> 模板。在你准备发送之前，你将需要填写该模板。</li>
<li><code>-o update_gitignore/</code> 选项告诉 <code>format-patch</code> 把补丁文件放到目录<code>update_gitignore</code>中。这样发送多个<code>commit</code>时就可以使用命令一次性发送，因为 <code>git send-email</code> 可以接收一个目录并从那里发送所有补丁。</li>
<li><code>--base=auto</code> 选项告诉命令记录”基本提交”，接收者将在此基础上应用补丁系列。自动值将使 <code>format-patch</code> 自动计算基本提交，即远程跟踪分支的最新提交和指定修订范围的合并基数。</li>
<li><code>update_gitignore@&#123;u&#125;..update_gitignore</code> 选项告诉 <code>format-patch</code> 为你在 <code>update_gitignore</code> 分支上创建的提交生成补丁，因为它是从上游分叉出来的。<code>@&#123;u&#125;</code>的意思就是从分叉开始到最新的提交。</li>
</ul>
<p>执行完该命令我们看看生成了哪些内容。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git status<br>On branch update_gitignore<br>Your branch is ahead of <span class="hljs-string">&#x27;origin/master&#x27;</span> by 2 commits.<br>  (use <span class="hljs-string">&quot;git push&quot;</span> to publish your <span class="hljs-built_in">local</span> commits)<br><br>Untracked files:<br>  (use <span class="hljs-string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="hljs-keyword">in</span> what will be committed)<br><br>        update_gitignore/<br><br>$ ls update_gitignore <br>0000-cover-letter.patch  0001-top-filter-.vscode-folder.patch  0002-top-filter-.cache-folder.patch<br></code></pre></td></tr></table></figure>

<p>该命令将为每次提交制作一个补丁文件。运行后，您可以用您喜欢的文本编辑器看一下每个补丁，确保一切正常。可以看到创建了一个<code>-o</code>参数中的<code>update_gitignore</code>文件夹，该文件夹下有三个文件，分别是 cover letter 和上文我们做的两次提交对应的补丁文件。</p>
<p>分别打开他们，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">From 30614e5469be4a2f930cca570836627a4e91f1d1 Mon Sep 17 00:00:00 2001<br>From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date: Fri, 18 Nov 2022 16:41:32 +0800<br>Subject: [PATCH 0/2] *** SUBJECT HERE ***<br><br>*** BLURB HERE ***<br><br>Dominic Zhang (2):<br>  top: filter .vscode folder<br>  top: filter .cache folder<br><br> .gitignore | 3 +++<br> 1 file changed, 3 insertions(+)<br><br><br>base-commit: 880685586dcee950d209088a461443449a1693ce<br>-- <br>2.17.1<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs text">From 5dc340c29979d4c5d8c4d5a6e881348239714434 Mon Sep 17 00:00:00 2001<br>From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date: Fri, 18 Nov 2022 16:06:21 +0800<br>Subject: [PATCH 1/2] top: filter .vscode folder<br><br>Filter the workspace&#x27;s &#x27;.vscode&#x27; directory by adding &#x27;/.vscode/&#x27; to the.gitignore file.<br><br>Signed-off-by: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>---<br> .gitignore | 2 ++<br> 1 file changed, 2 insertions(+)<br><br>diff --git a/.gitignore b/.gitignore<br>index 95692bb..90cf552 100644<br>--- a/.gitignore<br>+++ b/.gitignore<br>@@ -10,3 +10,5 @@ install/<br> # Development friendly files<br> tags<br> cscope*<br>+<br>+/.vscode/<br>\ No newline at end of file<br>-- <br>2.17.1<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs text">From 30614e5469be4a2f930cca570836627a4e91f1d1 Mon Sep 17 00:00:00 2001<br>From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date: Fri, 18 Nov 2022 16:20:37 +0800<br>Subject: [PATCH 2/2] top: filter .cache folder<br><br>Filter the workspace&#x27;s &#x27;.cache&#x27; directory by adding &#x27;/.cache/&#x27; to the.gitignore file.<br><br>Signed-off-by: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>---<br> .gitignore | 3 ++-<br> 1 file changed, 2 insertions(+), 1 deletion(-)<br><br>diff --git a/.gitignore b/.gitignore<br>index 90cf552..bf9d716 100644<br>--- a/.gitignore<br>+++ b/.gitignore<br>@@ -11,4 +11,5 @@ install/<br> tags<br> cscope*<br> <br>-/.vscode/<br>\ No newline at end of file<br>+/.vscode/<br>+/.cache/<br>\ No newline at end of file<br>-- <br>2.17.1<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注：另外，你也可以使用 <code>--rfc</code> 参数，在你的补丁主题前加上<code>[RFC PATCH]</code>，而不是<code>[PATCH]</code>。RFC 是”请求评论”的意思，表示虽然你的代码还没有准备好提交，但你想开始代码审查过程。你也可能在列表中看到标有”WIP”的补丁，这意味着他们还没有完成，但希望审查者能看看他们目前的成果。你可以用<code>--subject-prefix=WIP</code>来添加这个标志。</p>
</blockquote>
<p>检查并确保你的补丁和 cover letter 模板存在于你指定的目录中，这就完成所有准备了。</p>
<h4 id="准备邮件"><a href="#准备邮件" class="headerlink" title="准备邮件"></a>准备邮件</h4><p>由于你在调用 <code>format-patch</code> 时使用了<code>--cover-letter</code>，你已经准备好了一个 cover letter 模板。在你喜欢的编辑器中打开它。</p>
<p>你应该看到已经有一些标题存在。检查你的<code>From:</code>标题是否正确。然后修改你的<code>Subject:</code>。</p>
<p>确保保留<code>[PATCH 0/X]</code>的部分；这是向 Git 社区表明这封邮件是一个补丁系列的开始，许多审查者会根据这种类型的标记过滤他们的邮件。</p>
<p>接下来，你必须填写你的 cover letter 的正文。同样，关于应包括哪些内容，见上文。</p>
<p>最后，信中会包括用于生成补丁的 Git 的版本。你可以不用管这个字符串。</p>
<p>完善后的 cover letter 如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">From 30614e5469be4a2f930cca570836627a4e91f1d1 Mon Sep 17 00:00:00 2001<br>From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date: Fri, 18 Nov 2022 16:41:32 +0800<br>Subject: [PATCH 0/2] Update gitignore<br><br>vscode is a very popular IDE, and it often needs to generate a.vscode. cache directory to hold workspace configuration files that should not be committed to a remote repository, so we made some modifications to the gitignore file to filter such directories.<br><br>Dominic Zhang (2):<br>  top: filter .vscode folder<br>  top: filter .cache folder<br><br> .gitignore | 3 +++<br> 1 file changed, 3 insertions(+)<br><br><br>base-commit: 880685586dcee950d209088a461443449a1693ce<br>-- <br>2.17.1<br></code></pre></td></tr></table></figure>

<h4 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h4><p>到这里，你应该有一个目录 <code>update_gitignore/</code>，里面包含你的补丁和一封 cover letter。是时候把它发出去了！你可以像这样发送。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git send-email --to=target@example.com update_gitignore/*.patch<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注：请查看 <code>git help send-email</code> 中的一些其他选项，你可能会发现这些选项很有价值，比如改变回复地址或添加更多的抄送地址或密送地址。</p>
</blockquote>
<blockquote>
<p>注：当你发送一个真正的补丁时，它将被发送到 <code>opensbi@lists.infradead.org</code> - 但请不要把你的补丁集从教程中发送到真正的邮件列表中！现在你可以把它发送给你自己，以确保你了解它的形式。</p>
</blockquote>
<p>在你运行上面的命令后，你会为每个即将发出的补丁看到一个交互提示。这给了你最后一次机会来编辑或放弃发送一些东西（但还是那句话，不要用这种方式编辑代码）。一旦你在这些提示下按下 <code>y</code> 或 <code>a</code>，你的邮件就会被发送出去！Congratulation!</p>
<h4 id="发送补丁的更新版本"><a href="#发送补丁的更新版本" class="headerlink" title="发送补丁的更新版本"></a>发送补丁的更新版本</h4><p>本节将重点介绍如何发送你的补丁集的 v2 版。我们将在 v2 版中重新使用我们的 <code>update_gitignore</code> 分支。在我们做任何改动之前，我们先新建一个名为<code>update_gitignore-v1</code>的分支，这个分支是我们没有做新的改动的分支。这样在后面我们就可以方便的进行对比差异。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout update_gitignore<br>git branch update_gitignore-v1<br></code></pre></td></tr></table></figure>

<p>在更新补丁时，我们可能会遇到两种情况，一种是社区的意见只让修改最新的一个提交，一种是修改历史记录中的 commit。我们分别来处理这两种情况。</p>
<h5 id="如何修改最新的提交"><a href="#如何修改最新的提交" class="headerlink" title="如何修改最新的提交"></a>如何修改最新的提交</h5><p>比如只需要修改<code>top: filter .cache folder</code>这个 commit。因为它在我们的修改中是最新的 commit，所以我们可以直接对代码修改。比如我们做一个简单的修改，给修改的内容<code>/.cache</code>加个注释。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs text"># Object files<br>*.o<br>*.a<br>*.dep<br><br>#Build &amp; install directories<br>build/<br>install/<br><br># Development friendly files<br>tags<br>cscope*<br><br>/.vscode/<br><br># Cache file<br>/.cache/<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .gitignore<br>git commit --amend<br></code></pre></td></tr></table></figure>

<p><strong>注意</strong>！我们不需要生成新的<code>commit</code>，所以使用 <code>--amend</code>参数修改最新的<code>commit message</code>即可。执行这条命令会弹出编辑窗口，因为修改内容已经很明确，我们不需要在<code>commit message</code>里再做额外说明，直接保存退出即可。如果修改内容比较大，需要重新编写<code>commit message</code>。</p>
<p>以上我们就完成了一次更新。</p>
<h5 id="如何修改历史记录中的提交"><a href="#如何修改历史记录中的提交" class="headerlink" title="如何修改历史记录中的提交"></a>如何修改历史记录中的提交</h5><p>如果很不巧，社区要求修改的是<code>top: filter .vscode folder</code>这个提交的内容，那怎么办，因为它不是最新的提交，而是上一个提交，我们无法使用<code>git commit --amend</code>来直接对他修改，好在 Git 十分强大，不需要我们<code>reset</code>就可以完成这样的工作。</p>
<p>同样我们也做一个简单的修改，为<code>/.vscode/</code>也添加一个注释。首先我们需要使用到<code>git rebase</code>这个强大的命令。本文只介绍使用到的功能，其他功能需要大家自行摸索。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git rebase -i<br></code></pre></td></tr></table></figure>

<p>这条命令会弹出编辑窗口，<code>-i</code>参数表示以交互式方式进行变基（rebase）操作。弹出窗口内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">pick 7175772 top: filter .vscode folder<br>pick 52b63f3 top: filter .cache folder<br><br><span class="hljs-comment"># Rebase 8806855..52b63f3 onto 8806855 (2 commands)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Commands:</span><br><span class="hljs-comment"># p, pick = use commit</span><br><span class="hljs-comment"># r, reword = use commit, but edit the commit message</span><br><span class="hljs-comment"># e, edit = use commit, but stop for amending</span><br><span class="hljs-comment"># s, squash = use commit, but meld into previous commit</span><br><span class="hljs-comment"># f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message</span><br><span class="hljs-comment"># x, exec = run command (the rest of the line) using shell</span><br><span class="hljs-comment"># d, drop = remove commit</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># These lines can be re-ordered; they are executed from top to bottom.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># However, if you remove everything, the rebase will be aborted.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Note that empty commits are commented out</span><br></code></pre></td></tr></table></figure>

<p>窗口会显示所有未提交到远程的 commit，下面的注释也告诉了我们该如何使用。我们找到<code>edit</code>的行，可以看到解释为使用当前的 commit，但是在变基过程中会停下来让我们修改。这正是我们想要的。我们编辑当前的内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">edit 7175772 top: filter .vscode folder<br>pick 52b63f3 top: filter .cache folder<br></code></pre></td></tr></table></figure>

<p>表示我们需要编辑历史记录中的<code>top: filter .vscode folder</code>提交，但是另一个 commit 我们不做改变。保存并退出当前窗口后，会有如下提示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Stopped at 7175772...  top: filter .vscode folder<br>You can amend the commit now, with<br><br>  git commit --amend <br><br>Once you are satisfied with your changes, run<br><br>  git rebase --<span class="hljs-built_in">continue</span><br></code></pre></td></tr></table></figure>

<p>根据提示，我们可以进行一系列修改了，修改完使用<code>git commit --amend</code>保存，如果一切符合自己要求了，再使用<code>git rebase --continue</code>完成变基操作。</p>
<p>我们先修改代码，可以看到代码已经回到了没有<code>/.cache/</code>的状态，我们添加一行注释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text"># Object files<br>*.o<br>*.a<br>*.dep<br><br>#Build &amp; install directories<br>build/<br>install/<br><br># Development friendly files<br>tags<br>cscope*<br><br># VSCode config file<br>/.vscode/<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .gitignore<br>git commit --amend<br></code></pre></td></tr></table></figure>

<p>同样弹出窗口后我们直接保存退出，如果修改幅度较大，可以进一步补充说明。然后使用以下命令继续完成变基。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git rebase --<span class="hljs-built_in">continue</span><br></code></pre></td></tr></table></figure>

<p>此时我们可以看到我们不仅修改了历史记录中的 commit，还保证了最新的 commit 没有丢失或者更改。</p>
<h5 id="准备更新版本的补丁集"><a href="#准备更新版本的补丁集" class="headerlink" title="准备更新版本的补丁集"></a>准备更新版本的补丁集</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ git format-patch -v2 --cover-letter -o update_gitignore/   master..update_gitignore-v1<br>update_gitignore/v2-0000-cover-letter.patch<br>update_gitignore/v2-0001-top-filter-.vscode-folder.patch<br>update_gitignore/v2-0002-top-filter-.cache-folder.patch<br></code></pre></td></tr></table></figure>

<p><code>--range-diff  master..update_gitignore-v1</code> 参数告诉 <code>format-patch</code> 在 cover letter 中包括 <code>update_gitignore-v1</code> 和 <code>update_gitignore</code> 两个分支之间的差异。这有助于告诉评审人你的 v1 和 v2 补丁之间的差异。</p>
<p><code>-v2</code> 参数告诉 <code>format-patch</code> 将你的补丁输出为 <code>v2</code> 版本。例如，你可能注意到你的 v2 版补丁都被命名为 <code>v2-000n-my-commit-subject.patch</code>。<code>-v2</code> 也会将你的补丁格式化，在前面加上<code>[PATCH v2]</code>，而不是<code>[PATCH]</code>。</p>
<p>运行此命令后，<code>format-patch</code> 会将补丁输出到 <code>update_gitignore/</code> 目录，与 v1 版的补丁一起。使用一个目录可以方便在校对 v2 补丁时参考旧的 v1 补丁，但你需要注意只发送 v2 补丁。我们将使用 <code>update_gitignore/v2-.patch</code>这样的模式（而不是 <code>update_gitignore/.patch</code>，这将匹配 v1 和 v2 补丁）。</p>
<p>再次编辑你的 cover letter。现在是一个很好的时间来提及你的上一个版本和现在有什么不同，如果它是重要的东西。你不需要在你的第二封 cover letter 中使用完全相同的内容；重点是向审查人员解释你所做的可能不那么明显的变化。</p>
<p>我们就简单的写一下添加了注释。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">From 30614e5469be4a2f930cca570836627a4e91f1d1 Mon Sep 17 00:00:00 2001<br>From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date: Fri, 18 Nov 2022 19:35:06 +0800<br>Subject: [PATCH v2 0/2] Update gitignore<br><br>Add a comment for the folder name.<br><br>Dominic Zhang (2):<br>  top: filter .vscode folder<br>  top: filter .cache folder<br><br> .gitignore | 3 +++<br> 1 file changed, 3 insertions(+)<br><br>-- <br>2.17.1<br></code></pre></td></tr></table></figure>

<p>发送更新版本时你需要将新版本抄送给提出建议的人，你可以在你的 cover letter 中直接添加这些抄送行，在 Subject 行上面写上这样一行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">CC: Name &lt;name@example.com&gt;<br></code></pre></td></tr></table></figure>

<p>例如，把更新的邮件抄送给我自己：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs text">From 30614e5469be4a2f930cca570836627a4e91f1d1 Mon Sep 17 00:00:00 2001<br>From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>CC: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;<br>Date: Fri, 18 Nov 2022 19:35:06 +0800<br>Subject: [PATCH v2 0/2] Update gitignore<br><br>Add a comment for the folder name.<br><br>Dominic Zhang (2):<br>  top: filter .vscode folder<br>  top: filter .cache folder<br><br> .gitignore | 3 +++<br> 1 file changed, 3 insertions(+)<br><br>-- <br>2.17.1<br></code></pre></td></tr></table></figure>

<p>现在再次发送电子邮件，注意你传入的参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">git send-email --to target@example.com update_gitignore/v2-*.patch<br></code></pre></td></tr></table></figure>

<p>恭喜你完成了一次补丁版本更新。</p>
<hr>
<p>对于一些社区，要求更新的版本需要在同一个 thread 上进行。如下示例这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">[PATCH 0/2] Here is what I did...<br>  [PATCH 1/2] Clean up and tests<br>  [PATCH 2/2] Implementation<br>  [PATCH v2 0/3] Here is a reroll<br>    [PATCH v2 1/3] Clean up<br>    [PATCH v2 2/3] New tests<br>    [PATCH v2 3/3] Implementation<br></code></pre></td></tr></table></figure>

<p>就是更新的版本需要关联到之前的版本，而不能作为单独的一个列表。</p>
<p>你还需要去找到你之前的 cover letter 的 Message-Id。你可以在发送第一个补丁系列时，从 <code>git send-email</code> 的输出中记下它。<br>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git send-email --to Dominic Zhang@gmail.com update_gitignore/v2-*.patch <br><br>update_gitignore/v2-0000-cover-letter.patch<br>update_gitignore/v2-0001-top-filter-.vscode-folder.patch<br>update_gitignore/v2-0002-top-filter-.cache-folder.patch<br>(mbox) Adding cc: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt; from line <span class="hljs-string">&#x27;From: Dominic Zhang &lt;Dominic Zhang@gmail.com&gt;&#x27;</span><br>(mbox) Adding cc: Dominic Zhang &lt;254758318@qq.com&gt; from line <span class="hljs-string">&#x27;CC: Dominic Zhang &lt;254758318@qq.com&gt;&#x27;</span><br><br>From: Dominic Zhang@gmail.com<br>To: Dominic Zhang@gmail.com<br>Cc: Dominic Zhang &lt;254758318@qq.com&gt;<br>Subject: [PATCH v2 0/2] Update gitignore<br>Date: Fri, 18 Nov 2022 19:54:54 +0800<br>Message-Id: &lt;20221118115456.2242-1-Dominic Zhang@gmail.com&gt;<br>X-Mailer: git-send-email 2.17.1<br></code></pre></td></tr></table></figure>

<p>你也可以从社区的邮箱列表中找到 Message ID，因为 OpenSBI 不要求在同一个 thread 回复，所以没有相关信息，这里以<a target="_blank" rel="noopener" href="https://lore.kernel.org/git/cover-00.12-00000000000-20221118T112205Z-avarab@gmail.com/T/#t">Git 社区</a>的邮箱列表为例。随便点击一个补丁主题，在页面中找到<code>permalink</code>或者<code>raw</code>，点击打开即可找到 Message ID 信息。</p>
<p>它的格式一般如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Message-Id: &lt;foo.12345.author@example.com&gt;<br></code></pre></td></tr></table></figure>

<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/20-11-53-e32c2da586e2b273cd1647e391c5c814-20221118201152-50efbe.png"></p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/20-12-36-60538da64fc2af130b05eceb7c38cc52-20221118201235-5e5ace.png"></p>
<p>如果要发送更新版本，那么我们就需要找到上一版本的 Message ID。如发送的是 V3 版本，那么我们需要找到 V2 版本的 Message ID。并且在发送邮件时添加如下参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git send-email --to Dominic Zhang@gmail.com <br>                 --in-reply-to=<span class="hljs-string">&quot;&lt;foo.12345.author@example.com&gt;&quot;</span> <br>                 update_gitignore/v2-*.patch <br></code></pre></td></tr></table></figure>

<h4 id="只有一个-Patch-的更改"><a href="#只有一个-Patch-的更改" class="headerlink" title="只有一个 Patch 的更改"></a>只有一个 Patch 的更改</h4><p>在某些情况下，你的非常小的变化可能只包括一个补丁。这时，你只需要发送一封邮件。你的提交信息应该已经很有意义了，你只需要生成补丁文件就可以发送了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git format-patch -o update_gitignore/  HEAD^<br></code></pre></td></tr></table></figure>

<ul>
<li><code>HEAD^</code>参数表示生成与上一个提交之间的差异。</li>
</ul>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/11/05/Linux%E6%9B%B4%E6%8D%A2Debian%E8%BD%AF%E4%BB%B6%E6%9B%B4%E6%96%B0%E6%BA%90/" itemprop="url">更换 Debian 软件更新源</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-11-05T01:27:52.000Z" itemprop="datePublished">11月 5 2022</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            3 分钟 读完 (约 425 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="确认-Debian-版本"><a href="#确认-Debian-版本" class="headerlink" title="确认 Debian 版本"></a>确认 Debian 版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ cat /etc/os-release               <br>PRETTY_NAME=<span class="hljs-string">&quot;Debian GNU/Linux 10 (buster)&quot;</span><br>NAME=<span class="hljs-string">&quot;Debian GNU/Linux&quot;</span><br>VERSION_ID=<span class="hljs-string">&quot;10&quot;</span><br>VERSION=<span class="hljs-string">&quot;10 (buster)&quot;</span><br>VERSION_CODENAME=buster<br>ID=debian<br>HOME_URL=<span class="hljs-string">&quot;https://www.debian.org/&quot;</span><br>SUPPORT_URL=<span class="hljs-string">&quot;https://www.debian.org/support&quot;</span><br>BUG_REPORT_URL=<span class="hljs-string">&quot;https://bugs.debian.org/&quot;</span><br></code></pre></td></tr></table></figure>

<p>括号里的<code>buster</code>就是版本信息。</p>
<h2 id="获取镜像地址"><a href="#获取镜像地址" class="headerlink" title="获取镜像地址"></a>获取镜像地址</h2><p>打开<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/debian/">debian | 清华大学开源软件镜像站</a>，选择<code>buster</code>版本，复制所有镜像地址。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img//2022/11/05/54a39f7d33cf13259607144e03747e5a.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><br>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><br>deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br></code></pre></td></tr></table></figure>

<h2 id="备份原文件"><a href="#备份原文件" class="headerlink" title="备份原文件"></a>备份原文件</h2><p>这也算是系统文件的一部分，还是保险一点，出错了再改回来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup<br></code></pre></td></tr></table></figure>

<h2 id="打开并修改"><a href="#打开并修改" class="headerlink" title="打开并修改"></a>打开并修改</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vim /etc/apt/sources.list<br></code></pre></td></tr></table></figure>

<p><code>vim</code>用的不习惯的估计会和我一样找全选内容怎么操作。教给你了<br>在命令模式下，就是按一下<code>esc</code>键，然后输入<code>ggvG</code>。具体什么含义看<code>VIM 笔记</code>吧，选择后直接<code>delete</code>删除，镜像地址粘贴进去。保存退出。</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get update<br>sudo apt-get dist-upgrade<br>sudo apt-get upgrade<br></code></pre></td></tr></table></figure>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/11/01/QEMU-s-instance-init-vs-realize/" itemprop="url">QEMU&#39;s instance_init() vs. realize()</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-11-01T01:51:28.000Z" itemprop="datePublished">11月 1 2022</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="../../categories/QEMU-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">QEMU 源码分析</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            9 分钟 读完 (约 1392 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>转载自<a target="_blank" rel="noopener" href="https://github.com/huth">huth (Thomas Huth)</a>的一篇文章，原文已经 404，从网页快照中找回的文章。</p>
<p>Note that this is a blog post for (new) QEMU developers. If you are just interested in using QEMU, you can certainly skip this text. Otherwise, in case you have ever been in touch with the QEMU device model (“qdev”), you are likely aware of the basic qdev code boilerplate already:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mydev_realize</span><span class="hljs-params">(DeviceState *dev, Error **errp)</span></span><br><span class="hljs-function"></span>&#123;<br>    <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mydev_instance_init</span><span class="hljs-params">(Object *obj)</span></span><br><span class="hljs-function"></span>&#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">static</span> Property mydev_properties[] = &#123;<br>    DEFINE_PROP_xxx(<span class="hljs-string">&quot;myprop&quot;</span>, MyDevState, field, ...),<br>    <br>    DEFINE_PROP_END_OF_LIST(),<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mydev_class_init</span><span class="hljs-params">(ObjectClass *oc, <span class="hljs-keyword">void</span> *data)</span></span><br><span class="hljs-function"></span>&#123;<br>    DeviceClass *dc = DEVICE_CLASS(oc);<br><br>    dc-&gt;realize = mydev_realize;<br>    dc-&gt;desc = <span class="hljs-string">&quot;My cool device&quot;</span>;<br>    dc-&gt;props = mydev_properties;<br>    <br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TypeInfo mydev_info = &#123;<br>    .name          = TYPE_MYDEV,<br>    .parent        = TYPE_SYS_BUS_DEVICE,  <br>    .instance_size = <span class="hljs-keyword">sizeof</span>(mydev_state),<br>    .instance_init = mydev_instance_init,<br>    .class_init    = mydev_class_init,<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mydev_register_types</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    type_register_static(&amp;mydev_info);<br>&#125;<br><br>type_init(mydev_register_types)<br></code></pre></td></tr></table></figure>

<p>There are three different initialization functions involved here, the <strong>class_init</strong>, the <strong>instance_init</strong> and the <strong>realize</strong> function. While it is quite obvious to distinguish the <em>class_init</em> function from the two others (it is used for initializing the class data, not the data that is used for an instance … this is similar to the object model with classes and instances in C++), I initially always wondered about the difference between the <em>instance_init()</em> and the <em>realize()</em> functions. Having fixed quite a lot of related bugs in the past months in the QEMU code base, I now know that a lot of other people are also not properly aware of the difference here, so I think it is now time to write down some information that I’m now aware of, to make sure that I don’t forget about this again, and maybe help others to avoid related bugs in the future ;-)</p>
<p>First it is of course always a good idea to have a look at the documentation. While the <a target="_blank" rel="noopener" href="https://translate.google.com/website?sl=en&tl=zh-CN&hl=zh-CN&prev=search&u=https://git.qemu.org/?p=qemu.git;a=blob;f=include/qom/object.h;hb=v3.0.0%23l427">documentation of </a><a target="_blank" rel="noopener" href="https://translate.google.com/website?sl=en&tl=zh-CN&hl=zh-CN&prev=search&u=https://git.qemu.org/?p=qemu.git;a=blob;f=include/qom/object.h;hb=v3.0.0%23l427"><em>TypeInfo</em></a> (where <a target="_blank" rel="noopener" href="https://translate.google.com/website?sl=en&tl=zh-CN&hl=zh-CN&prev=search&u=https://git.qemu.org/?p=qemu.git;a=blob;f=include/qom/object.h;hb=v3.0.0%23l434"><em>instance_init()</em></a> is defined) is not very helpful to understand the differences, the <a target="_blank" rel="noopener" href="https://translate.google.com/website?sl=en&tl=zh-CN&hl=zh-CN&prev=search&u=https://git.qemu.org/?p=qemu.git;a=blob;f=include/hw/qdev-core.h;hb=v3.0.0%23l40">documentation of </a><a target="_blank" rel="noopener" href="https://translate.google.com/website?sl=en&tl=zh-CN&hl=zh-CN&prev=search&u=https://git.qemu.org/?p=qemu.git;a=blob;f=include/hw/qdev-core.h;hb=v3.0.0%23l40"><em>DeviceClass</em></a> (where <a target="_blank" rel="noopener" href="https://translate.google.com/website?sl=en&tl=zh-CN&hl=zh-CN&prev=search&u=https://git.qemu.org/?p=qemu.git;a=blob;f=include/hw/qdev-core.h;hb=v3.0.0%23l43"><em>realize()</em></a> is defined) has some more useful information: You can learn here that the object instantiation is done first, before the device is realized, i.e. the <em>instance_init()</em> function is called first, and the <em>realize()</em> function is called afterwards. The former must not fail, while the latter can return an error to its caller via a pointer to an <em>“Error”</em> object pointer.</p>
<p>So the basic idea here is that device objects are first instantiated, then these objects can be inspected for their interfaces and their creators can set up their properties to configure their settings and wire them up with other devices, before the device finally becomes “active” by being <em>realized</em>. It is important here to notice that <strong>devices can be instantiated (and also finalized) <em><strong><strong>without</strong></strong></em> being realized</strong>! This happens for example if the device is introspected: If you enter for example <code>device_add xyz,help</code> at the HMP monitor, or if you send the <code>device-list-properties</code> QOM command to QEMU to retrieve the device’s properties, QEMU creates a temporary instance of the device to query the properties of the object, without realizing it. The object gets destroyed (“finalized”) immediately afterwards.</p>
<p>Knowing this, you can avoid a set of bugs which could be found with a couple of devices in the past:</p>
<ul>
<li>If you want your device to provide properties for other parts of the QEMU code or for the users, and you want to add those properties via one of the many object_property_add*() functions of QEMU (instead of using the <em>“props”</em> field of the <em>DeviceClass</em>), then you should do this in the <em>instance_init()</em> and not in the <em>realize()</em> function. Otherwise the properties won’t show up when the user runs <code>--device xyz,help</code> or the <code>device-list-properties</code> QOM command to get some information about your device.</li>
<li><em>instance_init()</em> functions must really never fail, i.e. also not call <em>abort()</em> or <em>exit()</em>. Otherwise QEMU can terminate unexpectedly when a user simply wanted to have a look at the list of device properties with <code>device_add xyz,help</code> or the <code>device-list-properties</code> QOM command. If your device cannot work in certain circumstances, check for the error condition in the <em>realize()</em> function instead and return with an appropriate error there.</li>
<li>Never assume that your device is always instantiated only with the machine that it was designed for. It’s of course a good idea to set the <em>“user_creatable = false”</em> flag in the <em>DeviceClass</em> of your device if your device cannot be plugged in arbitrary machines. But device introspection can still happen at any time, with any machine. So if you wrote a device called “mydev-a” that only works with <code>--machine A</code>, the user still can start QEMU with the option <code>--machine B</code> instead and then run <code>device_add mydev-a,help</code> or the <code>device-list-properties</code> QOM command. The <em>instance_init()</em> function of your device will be called to create a temporary instance of your device, even though the base machine is B and not A here. So you especially should take care to not depend on the availability of certain buses or other devices in the <em>instance_init()</em> function, nor use things like <em>serial_hd()</em> or <em>nd_table[]</em> in your <em>instance_init()</em> function, since these might (and should) have been used by the machine init function already. If your device needs to be wired up, provide properties as interfaces to the outside and let the creator of your device (e.g. the machine init code) wire your device between the device instantiation and the realize phase instead.</li>
<li>Make sure that your device leaves a clean state after a temporary instance is destroyed again, i.e. don’t assume that there will be only one instance of your device which is created at the beginning right after QEMU has been started and is destroyed at the very end before QEMU terminates. Thus do not assume that the things that you do in your <em>instance_init()</em> don’t need explicit clean-up since the device instance will only be destroyed when QEMU terminates. Device instances can be created and destroyed at any time, so when the device is finalized, you must not leave any dangling pointers or references to your device behind you, e.g. in the QOM tree. When you create other objects in your <em>instance_init()</em> function, make sure to set proper parents of these objects or use an <em>instance_finalize()</em> function, so that the created objects get cleaned up correctly again when your device is destroyed.</li>
</ul>
<p>All in all, if you write code for a new QEMU device, it is likely a good idea to use the <em>instance_init()</em> function only for e.g. creating properties and other things that are required before device realization, and then do the main work in the <em>realize()</em> function instead.</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../2022/10/18/ZH-UEFI%E8%A7%84%E8%8C%83-1-%E5%BC%95%E8%A8%80/" itemprop="url">ZH-UEFI 规范 -1-引言</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2022-10-18T12:07:10.000Z" itemprop="datePublished">10月 18 2022</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 小时 读完 (约 9684 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>统一可扩展固件接口 (UEFI) 规范描述了操作系统和平台固件之间的接口。UEFI 之前是可扩展固件接口规范 1.10 (EFI)。因此，一些代码和某些协议名称保留了 EFI 名称。除非另有说明，本规范中的 EFI 名称可假定为 UEFI 的一部分。</p>
<p>该接口采用数据表的形式，其中包含与平台相关的信息，以及可供 OS 加载程序和 OS 使用的引导和运行时服务调用。它们共同提供了一个引导操作系统的标准环境。本规范是作为一个纯粹的接口规范设计的。因此，<strong>该规范定义了平台固件必须实现的接口和结构集</strong>。类似地，该规范定义了操作系统在引导时可能使用的一组接口和结构。无论是固件开发者选择如何实现所需的元素，还是操作系统开发者选择如何利用这些接口和结构，都由开发者自己决定。</p>
<p>该规范的目的是定义一种方法，使操作系统和平台固件仅通信支持操作系统引导过程所必需的信息。这是通过平台和固件提供给操作系统的软件可见接口的正式和完整的抽象规范来实现的。</p>
<p>本规范的目的是为操作系统和平台固件定义一种方式，以仅传递支持操作系统启动过程所需的信息。这是通过平台和固件呈现给操作系统的软件可见接口的抽象规范来实现的。</p>
<p>使用这一正式定义，旨在运行在与受支持的处理器规范兼容的平台上的收缩包装操作系统将能够在各种系统设计上启动，而无需进一步的平台或操作系统定制。该定义还允许平台创新引入新特性和功能，以增强平台的能力，而不需要按照操作系统的引导顺序编写新代码。</p>
<p>此外，抽象规范开辟了一条替代遗留设备和固件代码的路径。新的设备类型和相关代码可以通过相同定义的抽象接口提供同等的功能，同样不会影响 OS 引导支持代码。</p>
<p>该规范适用于从移动系统到服务器的所有硬件平台。该规范提供了一组核心服务以及一组协议接口。协议接口的选择可以随着时间的推移而发展，并针对不同的平台市场细分进行优化。与此同时，该规范允许 oem 提供最大限度的可扩展性和定制能力，以实现差异化。在这方面，UEFI 的目的是定义一个从传统的“PC-AT”风格的引导世界到一个没有遗留 API 的环境的进化路径。</p>
<h2 id="UEFI-驱动模型扩展"><a href="#UEFI-驱动模型扩展" class="headerlink" title="UEFI 驱动模型扩展"></a>UEFI 驱动模型扩展</h2><p>对启动设备的访问是通过一系列的协议接口提供的。UEFI 驱动模型的一个目的是为 “PC-AT”式的 Option ROM（TODO）提供一个替代品。需要指出的是，写在 UEFI 驱动模型上的驱动，被设计为在预启动环境中访问启动设备。它们并不是为了取代高性能的、针对操作系统的驱动程序。</p>
<p>UEFI 驱动模型被设计为支持执行模块化的代码，也被称为驱动，在预启动环境中运行。这些驱动程序可以管理或控制平台上的硬件总线和设备，也可以提供一些软件衍生的、平台特定的服务。</p>
<p>UEFI 驱动模型还包含了 UEFI 驱动编写者所需的信息，以设计和实现平台启动 UEFI 兼容的操作系统可能需要的任何总线驱动和设备驱动的组合。</p>
<p>UEFI 驱动模型被设计为通用的，可以适应任何类型的总线或设备。UEFI 规范描述了如何编写 PCI 总线驱动程序、PCI 设备驱动程序、USB 总线驱动程序、USB 设备驱动程序和 SCSI 驱动程序。提供了允许将 UEFI 驱动程序存储在 PCI Option ROM 中的其他详细信息，同时保持了与旧 Option ROM 镜像的兼容性。</p>
<p>UEFI 规范的一个设计目标是使驱动镜像尽可能的小。然而，如果一个驱动程序需要支持多个处理器架构，那么也需要为每个支持的处理器架构提供一个驱动程序对象文件。为了解决这个空间问题，本规范还定义了 EFI 字节代码虚拟机（EFI Byte Code Virtual Machine）。一个 UEFI 驱动可以被编译成一个 EFI 字节代码对象文件。UEFI Specification-complaint（TODO）的固件必须包含一个 EFI 字节代码解释器。这使得支持多种处理器架构的单一 EFI 字节代码对象文件可以被运出。另一种节省空间的技术是使用压缩。该规范定义了压缩和解压算法，可用于减少 UEFI 驱动程序的大小，从而减少 UEFI 驱动程序存储在 ROM 设备中时的开销。</p>
<p>OSV、IHV、OEM 和固件供应商可以使用 UEFI 规范中包含的信息来设计和实现符合本规范的固件、生成标准协议接口的驱动程序以及可用于引导 UEFI 兼容的操作系统加载程序操作系统。</p>
<h2 id="章节安排"><a href="#章节安排" class="headerlink" title="章节安排"></a>章节安排</h2><p>本规范的章节组织如下：</p>
<table>
<thead>
<tr>
<th align="left">章节名</th>
<th align="left">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="left">引言/概述</td>
<td align="left">介绍 UEFI 规范，并描述 UEFI 的主要组件。</td>
</tr>
<tr>
<td align="left">启动管理器</td>
<td align="left">管理器用于加载写入此规范的驱动程序和应用程序。</td>
</tr>
<tr>
<td align="left">EFI 系统表和分区</td>
<td align="left">描述了一个 EFI 系统表，它被传递给每个兼容的驱动程序和应用程序，并定义了一个基于 GUID 的分区方案。</td>
</tr>
<tr>
<td align="left">块转换表</td>
<td align="left">用于执行块 I/O 的布局和规则集，可提供单个块的断电写入原子性。</td>
</tr>
<tr>
<td align="left">引导服务</td>
<td align="left">包含在引导操作系统之前存在于 UEFI 兼容系统中的基本服务的定义。</td>
</tr>
<tr>
<td align="left">运行时服务</td>
<td align="left">包含在操作系统启动之前和之后存在于兼容系统中的基本服务的定义。</td>
</tr>
<tr>
<td align="left">协议</td>
<td align="left">EFI 加载图像协议描述已加载到内存的 UEFI 镜像。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">设备路径协议提供了在 UEFI 环境中构建和管理设备路径所需的信息。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">UEFI 驱动模型描述了一组服务和协议，适用于每个总线和设备类型。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">控制台支持协议定义了I/O协议，处理系统用户在启动服务环境中执行的基于文本的信息的输入和输出。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">媒介访问协议定义了加载文件协议，文件系统格式和媒介格式处理可移动媒介。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">PCI 总线支持协议定义 PCI 总线驱动程序，PCI 设备驱动程序和 PCI Option ROM 布局。所描述的协议包括 PCI 根桥 I/O 协议和 PCI I/O协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">SCSI 驱动程序模型和总线支持定义了 SCSI I/O协议和扩展SCSI Pass Thru 协议，用于抽象访问由 SCSI 主机控制器产生的 SCSI 通道。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">iSCSI协议定义了通过TCP/IP传输SCSI数据。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">USB 支持协议定义了 USB 总线驱动程序和 USB 设备驱动程序。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">调试器支持协议描述了一组可选的协议，提供所需的服务，以实现一个源级调试器的 UEFI 环境。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">压缩算法规范详细描述了压缩/解压缩算法，外加一个标准的EFI解压缩接口，用于启动时使用。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ACPI 协议可用于从平台上安装或删除 ACPI 表。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">字符串服务：Unicode 排序协议允许在启动服务环境中运行的代码对给定语言的 Unicode 字符串执行词法比较函数;正则表达式协议用于根据正则表达式模式匹配 Unicode 字符串。</td>
</tr>
<tr>
<td align="left">EFI 字节码虚拟机</td>
<td align="left">定义 EFI 字节码虚拟处理器及其指令集。它还定义了如何将 EBC 对象文件加载到内存中，以及从本机代码到 EBC 代码再转换到本机代码的机制。</td>
</tr>
<tr>
<td align="left">固件更新和报告</td>
<td align="left">为设备提供一个抽象，以提供固件管理支持。</td>
</tr>
<tr>
<td align="left">网络协议</td>
<td align="left">SNP、PXE、BIS 和 HTTP 启动协议定义了在 UEFI 启动服务环境中执行时提供对网络设备访问的协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">受管网络协议定义了 EFI 受管网络协议，它提供原始 (未格式化) 异步网络数据包 I/O 服务和托管网络服务绑定协议，用于定位 MNP 驱动支持的通信设备。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">VLAN、EAP、Wi-Fi 和 Supplicant 协议定义了一个协议，为 VLAN 配置提供可管理性接口。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">蓝牙协议定义。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">TCP、IP、PIPsec、FTP、GTLS 和 Configurations 协议定义了 EFI TCPv4 (Transmission Control Protocol version 4) 协议和 EFI IPv4 (Internet Protocol version 4) 协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ARP、DHCP、DNS、HTTP 和 REST 协议定义了 ARP (Address Resolution Protocol) 协议接口和 EFI DHCPv4 协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">UDP 和 MTFTP 协议定义了 EFI UDPv4 (User Datagram Protocol version 4) 协议，该协议在 EFI IPv4 协议上接口，并定义了 EFI MTFTPv4 协议接口，该接口建立在 EFI UDPv4 协议之上。</td>
</tr>
<tr>
<td align="left">安全引导和驱动程序签名</td>
<td align="left">介绍 Secure Boot 和生成 UEFI 数字签名的方法。</td>
</tr>
<tr>
<td align="left">人机界面基础设施 (HII)</td>
<td align="left">定义实现人机接口基础设施 (HII) 所需的核心代码和服务，包括管理用户输入和相关协议的代码定义的基本机制。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">描述用于管理系统配置的数据和 api:描述旋钮和设置的实际数据。</td>
</tr>
<tr>
<td align="left">用户标识</td>
<td align="left">描述描述平台当前用户的服务。</td>
</tr>
<tr>
<td align="left">安全技术</td>
<td align="left">描述用于利用安全技术的协议，包括加密散列和密钥管理。</td>
</tr>
<tr>
<td align="left">杂项协议</td>
<td align="left">Timestamp 协议提供了一个独立于平台的接口来检索高分辨率的时间戳计数器。当调用 ResetSystem 时，重置通知协议提供注册通知的服务。</td>
</tr>
<tr>
<td align="left">附录</td>
<td align="left">GUID 和时间格式。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">基于基本文本的控制台要求，符合 efi 系统需要提供通信能力。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">设备路径使用数据结构的例子，定义各种硬件设备的引导服务。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">状态代码列出了 UEFI 接口返回的成功、错误和警告代码。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">通用网络驱动程序接口定义了32/64位硬件和软件通用网络驱动程序接口(UNDIs)。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">使用简单指针协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">使用 EFI 扩展 SCISI 直通协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">压缩源代码的一个压缩算法的实现。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">一个 EFI 解压缩算法的实现的解压源代码。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">EFI 字节码虚拟机操作码列表提供了相应指令集的摘要。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">字母功能列表按字母顺序标识所有 UEFI 接口功能。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">EFI 1.10 协议变更和折旧清单标识了协议、GUID、修订标识符名称变更以及与 EFI 1.10 规范相比已弃用的协议。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">平台错误记录描述了用于表示平台硬件错误的常见平台错误记录格式。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">UEFI ACPI Data Table 定义了 UEFI ACPI 表格式。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">硬件错误记录持久性使用。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">引用</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">术语表</td>
</tr>
<tr>
<td align="left">索引</td>
<td align="left">提供规范中关键术语和概念的索引。</td>
</tr>
</tbody></table>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>“PC-AT”启动环境对行业内的创新提出了重大挑战。每一个新的平台功能或硬件创新都要求固件开发人员设计越来越复杂的解决方案，并且通常要求操作系统开发人员修改引导代码，然后客户才能从创新中受益。这可能是一个耗时的过程，需要大量的资源投资。</p>
<p>UEFI 规范的主要目标是定义一个替代引导环境，可以减轻这些考虑。在这个目标中，该规范类似于其他现有的引导规范。本规范的主要属性可以概括为以下属性：</p>
<ul>
<li><p><strong>一致的、可扩展的平台环境</strong>。该规范为固件定义了一个完整的解决方案，以描述所有平台特性和 OS 的 surface platform(TODO) 功能在引导过程中。这些定义非常丰富，足以涵盖一系列当代处理器设计。</p>
</li>
<li><p><strong>从固件中抽象操作系统</strong>。该规范定义了平台功能的接口。通过使用抽象接口，该规范允许在构建 OS 加载器时，而无需了解作为这些接口基础的平台和固件。这些接口代表了底层平台和固件实现与操作系统加载程序之间定义良好的稳定边界。这样的边界允许底层固件和操作系统加载程序更改，前提是两者都将交互限制在定义的接口上。</p>
</li>
<li><p><strong>合理的设备抽象，不需要遗留接口</strong>。“PC-AT”BIOS 接口要求操作系统加载程序对某些硬件设备的工作有特定的了解。该规范为 OS 加载器开发人员提供了一些不同的东西：抽象接口使得可以构建在一系列底层硬件设备上工作的代码，而无需明确了解该范围内每个设备的细节。</p>
</li>
<li><p><strong>从固件中提取 Option ROM</strong>。该规范定义了平台功能的接口，包括 PCI、USB 和 SCSI 等标准总线类型。支持的总线类型可能会随着时间的推移而增加，因此包括了一种扩展到未来总线类型的机制。这些定义的接口以及扩展到未来总线类型的能力是 UEFI 驱动程序模型的组件。UEFI 驱动模型的一个目的是解决现有“PC-AT”Option ROM 中存在的广泛问题。与 OS 加载程序一样，驱动程序使用抽象接口，因此可以构建设备驱动程序和总线驱动程序，而无需了解作为这些接口基础的平台和固件。</p>
</li>
<li><p><strong>架构上可共享的系统分区</strong>。扩展平台功能和添加新设备的计划通常需要软件支持。在许多情况下，当这些平台创新（TODO）在操作系统控制平台之前被激活时，它们必须由特定于平台而不是客户选择的操作系统的代码支持。解决这个问题的传统方法是在制造过程中将代码嵌入平台中（例如，在闪存设备中）。对这种持久存储的需求正在快速增长。该规范定义了大型海量存储媒介类型上的持久存储，以供平台支持代码扩展使用，以补充传统方法。规范中明确了其工作原理的定义，以确保固件开发商、OEM、操作系统供应商甚至第三方可以安全地共享空间，同时增加平台功能。</p>
</li>
</ul>
<p>可以通过多种方式定义提供这些属性的引导环境。实际上，在编写本规范时，已经存在几种替代方案，从学术角度来看可能是可行的。然而，考虑到当前围绕支持的处理器平台的基础设施能力，这些替代方案通常会带来很高的门槛。本规范旨在提供上面列出的属性，同时也认识到行业的独特需求，该行业在兼容性方面进行了大量投资，并且拥有大量无法立即放弃的系统安装基础。这些需求推动了对本规范中体现的附加属性的要求：</p>
<ul>
<li><strong>进化性的，而不是革命性的</strong>。规范中的接口和结构旨在尽可能地减少初始实现的负担。虽然已经小注意保在接口本身中维护适当的抽象，但该设计还确保可以重用 BIOS 代码来实现接口，而只需要最少的额外编码工作。换句话说，在 PC-AT 平台上，规范最初可以作为基于现有代码的底层实现之上的薄接口（thin Interface TODO）层来实现。同时，抽象接口的引入提供了将来从遗留代码的迁移。一旦抽象被确立为固件和操作系统加载程序在引导期间交互的手段，开发人员就可以随意替换抽象接口下的遗留代码。类似的硬件遗留迁移也是可能的。由于抽象隐藏了设备的细节，因此可以移除底层硬件，并用提供改进功能、降低成本或两者兼而有之的新硬件替换它。显然，这需要编写新的平台固件来支持设备并通过抽象接口将其呈现给 OS 加载器。但是，如果没有接口抽象，则可能根本无法移除旧设备。</li>
<li><strong>设计上的兼容性</strong>。系统分区结构的设计还保留了当前在“PC-AT”引导环境中使用的所有结构。因此，构建一个能够从同一磁盘引导传统操作系统或 EFI-aware 操作系统的单一系统是一件简单的事情。</li>
<li><strong>简化了操作系统中立的平台增值的添加</strong>。该规范定义了一个开放的、可扩展的接口，它有助于创建平台“驱动程序”。这些可能类似于操作系统驱动程序，在引导过程中为新设备类型提供支持，或者它们可能用于实现增强的平台功能，例如容错或安全性。此外，这种扩展平台能力的能力从一开始就被设计到规范中。这旨在帮助开发人员避免在尝试将新代码挤入传统 BIOS 环境时所固有的许多挫败感。由于包含用于添加新协议的接口，OEM 或固件开发人员拥有以模块化方式向平台添加功能的基础设施。由于规范中定义的调用约定和环境，此类驱动程序可能会使用高级编码语言来实现。这反过来可能有助于降低创新的难度和成本。系统分区选项为此类扩展提供了非易失性存储器存储的替代方案。</li>
<li><strong>建立在现有投入的基础上</strong>。在可能的情况下，规范避免在现有行业规范提供足够覆盖的领域重新定义接口和结构。例如，ACPI 规范为操作系统提供了发现和配置平台资源所需的所有信息。同样，规范设计的这种哲学选择旨在尽可能降低采用该规范的障碍。</li>
</ul>
<h2 id="目标受众"><a href="#目标受众" class="headerlink" title="目标受众"></a>目标受众</h2><p>本文档主要适用于以下读者：</p>
<ul>
<li>将实现 UEFI 驱动程序的 IHV 和 OEM。</li>
<li>将创建支持的处理器平台的 OEM 厂商，旨在启动 shrink-wrap（TODO）的操作系统。</li>
<li>BIOS 开发人员，无论是创建通用 BIOS 和其他固件产品的人员，还是修改这些产品的支持人员。</li>
<li>操作系统开发人员将调整他们的 shrink-wrap（TODO）操作系统产品，用来在支持的基于处理器的平台上运行。</li>
</ul>
<h2 id="UEFI-设计概述"><a href="#UEFI-设计概述" class="headerlink" title="UEFI 设计概述"></a>UEFI 设计概述</h2><p>UEFI 的设计基于以下基本要素：</p>
<ul>
<li><strong>重用现有的基于表格的接口</strong>。为了保持对现有基础支持代码（包括操作系统和固件）的投资，必须在希望符合 UEFI 规范的平台上，实现通常在与支持的处理器规范兼容的平台上，实现的许多现有规范。 （有关更多信息，请参阅附录 Q：参考资料。）</li>
<li><strong>系统分区</strong>。系统分区定义了一个分区和文件系统，可允许多个供应商之间安全共享，并用于不同目的。包含单独的、可共享的系统分区的能力提供了增加平台附加值的机会，而不会显著增加对非易失性平台存储器的需求。</li>
<li><strong>引导服务</strong>。引导服务为可在引导期间使用的设备和系统功能提供接口。设备访问是通过“句柄”（handles）和“协议”(protocols) 抽象出来的。这有利于重用现有 BIOS 代码，将基本实现要求保持在规范之外，而不会给访问设备的消费者带来负担。</li>
<li><strong>运行时服务</strong>。提供了一组最小的运行时服务，以确保对基础平台的硬件资源进行适当的抽象，这些资源可能是操作系统在正常运行时需要的。</li>
</ul>
<hr>
<p><img src="../pic/1-1.jpg" alt="UEFI 概念概述"></p>
<hr>
<p>图 1-1 描述了用于完成平台和操作系统引导的符合 UEFI 规范的系统的各种组件的交互。</p>
<p>平台固件能够从系统分区中检索操作系统加载器镜像。该规范提供了各种大容量存储设备类型，包括磁盘、CD-ROM 和 DVD，以及通过网络的远程启动。通过可扩展的协议接口，有可能增加其他的引导媒介类型，尽管如果这些媒介需要使用本文件中定义的协议以外的协议，可能需要修改操作系统加载器。</p>
<p>一旦启动，操作系统加载程序将继续引导整个操作系统。为此，它可以使用本规范或其他所需规范定义的 EFI 引导服务和接口来探测、解析和初始化各种平台组件和管理它们的操作系统软件。在引导阶段，EFI 运行时服务也可供 OS 加载器使用。</p>
<h2 id="UEFI-驱动模型"><a href="#UEFI-驱动模型" class="headerlink" title="UEFI 驱动模型"></a>UEFI 驱动模型</h2><p>本节描述了符合本规范的固件的驱动模型的目标。目标是让这个驱动模型为所有类型的总线和设备提供一个实现总线驱动和设备驱动的机制。在撰写本文时，支持的总线类型包括 PCI、USB 等。</p>
<p>随着硬件架构的不断发展，平台中存在的总线数量和类型也在不断增加。这种趋势在高端服务器中尤为明显。然而，更多样化的总线类型被设计到桌面和移动系统，甚至一些嵌入式系统中。这种日益增长的复杂性，意味着在预启动环境中，需要一种简单的方法来描述和管理平台中的所有总线和设备。UEFI 驱动模型以协议、服务和启动服务的形式提供了这种简单的方法。</p>
<h3 id="UEFI-驱动程序模型目标"><a href="#UEFI-驱动程序模型目标" class="headerlink" title="UEFI 驱动程序模型目标"></a>UEFI 驱动程序模型目标</h3><p>UEFI 驱动模型有以下目标：</p>
<ul>
<li><strong>兼容</strong> – 符合此规范的驱动程序必须保持与 EFI 1.10 规范和 UEFI 规范的兼容性。这意味着 UEFI 驱动程序模型利用 UEFI 2. 0 规范中的可扩展性机制来添加所需的功能。</li>
<li><strong>简单</strong> - 符合本规范的驱动程序必须易于实现，易于维护。UEFI 驱动模型必须允许驱动编写者专注于正在开发的特定设备的驱动。驱动程序不应关注平台策略或平台管理问题。这些考虑应该留给系统固件。</li>
<li><strong>可扩展性</strong> - UEFI 驱动模型必须能够适应所有类型的平台。这些平台包括嵌入式系统、移动和桌面系统，以及工作站和服务器。</li>
<li><strong>灵活</strong> - UEFI 驱动模型必须支持枚举所有设备的能力，或者只枚举启动所需操作系统的那些设备。最小的设备枚举提供了对更快速的启动能力的支持，而完整的设备媒体提供了在系统中存在的任何启动设备上执行操作系统安装、系统维护或系统诊断的能力。</li>
<li><strong>可扩展性</strong> - UEFI 驱动模型必须能够扩展到未来定义的总线类型。</li>
<li><strong>可移植性</strong> - 根据 UEFI 驱动模型编写的驱动，必须在不同平台和支持的处理器架构之间可移植。</li>
<li><strong>可互操作性</strong> - 驱动程序必须与其他驱动程序和系统固件共存，并且必须在不产生资源冲突的情况下进行操作。</li>
<li><strong>描述复杂的总线层次结构</strong> - UEFI 驱动模型必须能够描述各种总线拓扑结构，从非常简单的单总线平台到包含许多不同类型总线的非常复杂的平台。</li>
<li><strong>驱动占用空间小</strong> - 由 UEFI 驱动程序模型产生的可执行文件的大小必须最小化，以减少整体平台成本。虽然灵活性和可扩展性是目标，但支持这些所需的额外开销必须保持在最低水平，以防止固件组件的大小变得无法管理。</li>
<li><strong>解决遗留 Option ROM 的问题</strong> - UEFI 驱动模型必须直接解决遗留 Option ROM 的约束和限制。具体来说，必须能够建立同时支持 UEFI 驱动和传统 Option ROM 的插件卡，这种卡可以在传统 BIOS 系统和符合 UEFI 的平台上执行，而无需修改卡上的代码。该解决方案必须提供一个从传统 Option ROM 驱动程序迁移到 UEFI 驱动程序的进化路径。</li>
</ul>
<h3 id="遗留-Option-ROM-问题"><a href="#遗留-Option-ROM-问题" class="headerlink" title="遗留 Option ROM 问题"></a>遗留 Option ROM 问题</h3><p>这个支持驱动模型的想法来自于对 UEFI 规范的反馈，它提供了一个明确的、由市场驱动的对传统选项 ROM（有时也被称为扩展 ROM）的替代要求。人们认为，UEFI 规范的出现代表了一个机会，通过用一种在 UEFI 规范框架内工作的替代机制来取代传统选项 ROM 镜像的构建和操作，从而摆脱隐含的限制。</p>
<h2 id="迁移要求"><a href="#迁移要求" class="headerlink" title="迁移要求"></a>迁移要求</h2><p>迁移要求涵盖了从最初实施本规范到未来所有平台和操作系统都实施本规范的过渡时期。在这一时期，有两个主要的兼容性考虑是很重要的。</p>
<ul>
<li>能够继续启动传统的操作系统；</li>
<li>能够在现有的平台上实现 UEFI，尽可能多地复用现有的固件代码，将开发资源和时间要求降到最低。</li>
</ul>
<h3 id="旧版操作系统支持"><a href="#旧版操作系统支持" class="headerlink" title="旧版操作系统支持"></a>旧版操作系统支持</h3><p>UEFI 规范代表了收缩式操作系统和固件在启动过程中进行通信的首选方式。然而，选择制作一个符合该规范的平台，并不排除该平台，也支持不了解 UEFI 规范的，现有传统操作系统二进制文件。</p>
<p>UEFI 规范并不限制平台设计者，选择同时支持 UEFI 规范和更传统的 “PC-AT “启动基础架构。如果要实现这样的传统基础架构，应该按照现有的行业惯例来开发，这些惯例是在本规范范围之外定义的。在任何给定的平台上，支持的传统操作系统的选项是由该平台的制造商决定的。</p>
<h3 id="在旧平台上支持-UEFI-规范"><a href="#在旧平台上支持-UEFI-规范" class="headerlink" title="在旧平台上支持 UEFI 规范"></a>在旧平台上支持 UEFI 规范</h3><p>UEFI 规范经过精心设计，允许以最少的开发工作扩展现有系统以支持它。特别是 UEFI 规范中定义的抽象结构和服务，都可以在遗留平台上得到支持</p>
<p>例如，要在现有且受支持的基于 32 位的平台上实现此类支持，该平台使用传统 BIOS 来支持操作系统启动，需要提供额外的固件代码层。需要这些额外的代码来将服务和设备的现有接口转换为对本规范中定义的抽象的支持。</p>
<h2 id="本文档中使用的约定"><a href="#本文档中使用的约定" class="headerlink" title="本文档中使用的约定"></a>本文档中使用的约定</h2><h3 id="数据结构描述"><a href="#数据结构描述" class="headerlink" title="数据结构描述"></a>数据结构描述</h3><p><strong>支持的处理器是“小端”机器</strong>。这种区别意味着内存中多字节数据项的低位字节位于最低地址，而高位字节位于最高地址。一些受支持的 64 位处理器可以配置为“小端”和“大端”操作。所有旨在符合本规范的实现都使用“小端”操作。</p>
<p>在某些内存布局描述中，某些字段被标记为保留。软件必须将这些字段初始化为零并在读取时忽略它们。在更新操作中，软件必须保留任何保留字段。</p>
<h3 id="协议描述"><a href="#协议描述" class="headerlink" title="协议描述"></a>协议描述</h3><p>协议描述一般有以下格式：</p>
<ul>
<li><strong>协议名称</strong>：协议接口的正式名称。</li>
<li><strong>摘要</strong>：协议接口的简要描述。</li>
<li><strong>GUID</strong>：协议接口的 128 位 GUID (Globally Unique Identifier)。</li>
<li><strong>协议接口结构</strong>：一种“c 风格”的数据结构定义，包含由该协议接口产生的过程和数据字段。</li>
<li><strong>参数</strong>：协议接口结构中各字段的简要说明。</li>
<li><strong>描述</strong>：对接口提供的功能的描述，包括调用者应该知道的任何限制和警告。</li>
<li><strong>相关定义</strong>：协议接口结构或其任何过程中使用的类型声明和常量。</li>
</ul>
<h3 id="过程描述"><a href="#过程描述" class="headerlink" title="过程描述"></a>过程描述</h3><p>过程描述通常具有以下格式：</p>
<ul>
<li><strong>过程名称</strong>：过程的正式名称。</li>
<li><strong>摘要</strong>：过程的简要说明。</li>
<li><strong>原型</strong>：定义调用序列的“C 风格”过程标头。</li>
<li><strong>参数</strong>：对程序原型中每个字段的简要描述。</li>
<li><strong>描述</strong>：对接口所提供的功能的描述，包括调用者应该注意的任何限制和注意事项。</li>
<li><strong>相关定义</strong>：仅由该过程使用的类型声明和常量。</li>
<li><strong>返回的状态代码</strong>：对接口所返回的任何代码的描述。该过程需要实现本表中列出的任何状态代码。可以返回更多的错误代码，但是它们不会被标准的符合性测试所测试，而且任何使用该程序的软件，都不能依赖于实现可能提供的任何扩展错误代码。</li>
</ul>
<h3 id="指令描述"><a href="#指令描述" class="headerlink" title="指令描述"></a>指令描述</h3><p>EBC 指令的指令描述一般有以下格式：</p>
<ul>
<li><strong>指令名称</strong>：指令的正式名称。</li>
<li><strong>语法</strong>：指令的简要描述。</li>
<li><strong>描述</strong>：对指令所提供的功能的描述，并附有指令编码的详细表格。</li>
<li><strong>操作</strong>：详细说明对操作数进行的操作。</li>
<li><strong>行为和限制</strong>：逐项描述指令中涉及的每个操作数的行为，以及适用于操作数或指令的任何限制。</li>
</ul>
<h3 id="伪代码约定"><a href="#伪代码约定" class="headerlink" title="伪代码约定"></a>伪代码约定</h3><p>提出伪代码是为了以更简洁的形式描述算法。本文件中的所有算法都不打算直接进行编译。代码是在与周围文本相对应的水平上呈现的。</p>
<p>在描述变量时，列表是一个无序的同质对象的集合。一个队列是一个同质对象的有序列表。除非另有说明，否则假设排序为先进先出。</p>
<p>伪代码以类似于 C 的格式呈现，在适当的地方使用 C 约定。编码风格，特别是缩进风格，是为了可读性，不一定符合 UEFI 规范的实现。</p>
<h3 id="排版约定"><a href="#排版约定" class="headerlink" title="排版约定"></a>排版约定</h3><p>本文件采用了以下描述的排版和说明性惯例。</p>
<ul>
<li>纯文本：规范中的绝大部分描述性文本都使用普通文本字体。</li>
<li>纯文本（蓝色）：任何有下划线和蓝色的纯文本都表示与交叉参考资料的活动链接。点击该词，就可以跟踪超链接。</li>
<li>加粗：在文本中，粗体字标识了一个处理器寄存器的名称。在其他情况下，黑体字可以作为段落中的标题。</li>
<li>斜体：在文本中，斜体字可以用作强调，以引入一个新的术语或表示手册或规范的名称。</li>
<li>加粗等宽（暗红色）：计算机代码、示例代码段和所有原型代码段使用 BOLD Monospace 字体，颜色为暗红色。这些代码列表通常出现在一个或多个独立的段落中，尽管单词或片段也可以嵌入到一个正常的文本段落中。</li>
<li>加粗等宽（蓝色）：用粗体单色字体的字，下划线和蓝色的字，表示该功能或类型定义的代码定义的活动超链接。点击该词，即可进入超链接。</li>
</ul>
<p><strong>注意</strong>：出于管理和文件大小的考虑，每一页上只有第一次出现的参考文献是一个主动链接。同一页上的后续参考文献不会被主动链接到定义上，而是使用标准的、无下划线的 BOLD Monospace 字体。在页面上找到该名称的第一个实例（使用下划线的 BOLD Monospace 字体），点击该词即可跳转到该功能或类型的定义。</p>
<ul>
<li>斜体等宽：在代码或文本中，斜体字表示必须提供的变量信息的占位符名称（即参数）。</li>
</ul>
<h3 id="数字格式"><a href="#数字格式" class="headerlink" title="数字格式"></a>数字格式</h3><p>在本标准中，二进制数字是由仅由西方阿拉伯数字 0 和 1 组成的任何数字序列表示的，后面紧跟一个小写的 b（例如，0101b）。在二进制数字表示中的字符之间可以包含下划线或空格，以增加可读性或划分领域边界（例如，0 0101 1010b 或 0_0101_1010b）。</p>
<h4 id="十六进制"><a href="#十六进制" class="headerlink" title="十六进制"></a>十六进制</h4><p>十六进制数字在本标准中用 0x 表示，前面是仅由西阿拉伯数字 0 至 9 和/或大写英文字母 A 至 F 组成的任何数字序列（例如，0xFA23）。十六进制数字表示中的字符之间可以包含下划线或空格，以增加可读性或划定字段边界（例如，0xB FD8C FA23 或 0xB_FD8C_FA23）。</p>
<h4 id="十进制"><a href="#十进制" class="headerlink" title="十进制"></a>十进制</h4><p>在本标准中，小数是由仅由阿拉伯数字 0 到 9 组成的任何数字序列来表示的，后面不紧跟小写的 b 或小写的 h（例如，25）。本标准使用以下惯例来表示小数：</p>
<ul>
<li>小数点分隔符（即分隔数字的整数部分和小数部分）是一个句号；</li>
<li>千位数分隔符（即分隔数字部分的三位数组）是一个逗号；</li>
<li>千位数分隔符用于数字的整数部分，不用于数字的小数部分。</li>
</ul>
<h3 id="二进制前缀"><a href="#二进制前缀" class="headerlink" title="二进制前缀"></a>二进制前缀</h3><p>本标准使用国际单位制（SI）中定义的前缀来表示 10 的幂值。见 “SI 二进制前缀 “标题下的 “UEFI 相关文件链接”（<a target="_blank" rel="noopener" href="http://uefi.org/uefi">http://uefi.org/uefi</a>）。</p>
<p><img src="../pic/table1-1.jpg"></p>
<p>本标准使用ISO/IEC 80000-13《数量和单位–第 13 部分：信息科学和技术》和 IEEE 1514《二进制倍数前缀标准》中定义的二进制前缀，用于表示 2 的幂值。</p>
<p><img src="../pic/table1-2.jpg"></p>
<p>例如，4 KB 意味着 4000 个字节，4 KiB 意味着 4096 个字节。</p>
<h3 id="修订号"><a href="#修订号" class="headerlink" title="修订号"></a>修订号</h3><p>对 UEFI 规范的更新被认为是新的修订或勘误表，如下所述：</p>
<ul>
<li>当有实质性的新内容或可能修改现有行为的变化时，就会产生一个新的修订。新的修订版由一个主要的。次要的版本号来指定（例如：xx.yy）。在变化特别小的情况下，我们可能有一个 major.minor.minor 的命名惯例（例如 xx.yy.zz）。</li>
<li>当批准的规范更新不包括任何重要的新材料或修改现有行为时，就会产生勘误的版本。勘误的指定方法是在版本号后面加上一个大写字母，如 xx.yy 勘误 A。</li>
</ul>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous">
        <a href="../5/">上一页</a>
    </div>
    <div class="pagination-next">
        <a href="../7/">下一页</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link" href="../../">1</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="../5/">5</a></li>
        
        <li><a class="pagination-link is-current" href="">6</a></li>
        
        <li><a class="pagination-link" href="../7/">7</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="../26/">26</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Dominic&nbsp;
                powered_by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>




<script src="../../js/script.js"></script>


    
</body>
</html>