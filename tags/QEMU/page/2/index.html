<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Tag: QEMU - 如云泊</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="">










<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="../../../../css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>



<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="atom.xml" title="如云泊" type="application/atom+xml">
</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="../../../../index.html">
                
                <img src="../../../../images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            
        </div>
    </div>
</nav>

    <section class="section section-heading">
    <div class="container">
        <div class="content">
            <h5>#QEMU</h5>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../../../2021/07/28/QEMU%E4%B8%8A%E8%BF%90%E8%A1%8C64%E4%BD%8D%E5%92%8C32%E4%BD%8DRISC-V-Linux/" itemprop="url">在 QEMU 上运行 64 位和 32 位 RISC-V-Linux</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2021-07-28T05:47:56.000Z" itemprop="datePublished">7月 28 2021</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            6 分钟 lesen (Über 838 Wörter)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="制作交叉工具链-riscv-gnu-toolchain"><a href="#制作交叉工具链-riscv-gnu-toolchain" class="headerlink" title="制作交叉工具链 riscv-gnu-toolchain"></a>制作交叉工具链 riscv-gnu-toolchain</h2><h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3><p>这个仓库是我遇到的最难下载的一个仓库了，公司网慢和虚拟机性能差都脱不了干系。估计下载了五小时都不止，刚开始还指望一个命令所有子模块都下载完的，结果愣是等了半天中断了。试了两次后放弃了。如果各位看官能一次完成，那您是福大。</p>
<p>国内的码云平台有个<a target="_blank" rel="noopener" href="https://gitee.com/organizations/mirrors/projects">Gitee 极速下载</a>项目，上面有 GitHub 的一些常用开源项目的镜像，可供加速下载。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># riscv-gnu-toolchain</span><br>https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/mirrors/</span>riscv-gnu-toolchain.git<br></code></pre></td></tr></table></figure>

<p>下载时问题出现了，如果下载子模块仍然会卡住，如果不加<code>--recursive</code>就只能下载主体内容，子模块都没有。（<strong>以下内容为第一安装时的方法，后续又找到了<a href="">git clone 快速下载子模块</a>的方法</strong>）</p>
<p>开始下载时不加<code>--recursive</code>参数，只下载<code>riscv-gnu-toolchain</code>的主体内容，然后进入到<code>riscv-gnu-toolchain</code>文件夹下，手动下载子模块的内容。</p>
<p>当下完<code>riscv-binutils</code>继续下载<code>riscv-gdb</code>时发现这两个项目是同一个项目，只是不同的分支。但是码云上并没有区分，但是我也没找到在码云上的对应分支。只能用油猴脚本了。</p>
<p>如果你有油猴插件可以去<a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN">greasyfork</a>搜索安装<strong>GitHub 镜像访问，加速下载</strong>这个脚本，刷新 GitHub 仓库界面就会多出几个镜像地址，一般下载都会快好几倍。如果不用油猴插件的可以用我复制好的链接。</p>
<p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/20210728155417.png"></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># riscv-binutils</span><br>git clone https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/mirrors/</span>riscv-binutils-gdb.git<br><span class="hljs-comment"># riscv-gcc</span><br>git clone https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/mirrors/</span>riscv-gcc.git<br><span class="hljs-comment"># riscv-dejagnu</span><br>git clone https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/mirrors/</span>riscv-dejagnu.git<br><span class="hljs-comment"># riscv-glibc</span><br>git clone https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/mirrors/</span>riscv-glibc.git<br><span class="hljs-comment"># riscv-newlib</span><br>git clone https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/mirrors/</span>riscv-newlib.git<br><span class="hljs-comment"># riscv-gdb</span><br>git clone --depth=<span class="hljs-number">1</span> https:<span class="hljs-regexp">//</span>hub.fastgit.org<span class="hljs-regexp">/riscv/</span>riscv-binutils-gdb.git<br></code></pre></td></tr></table></figure>

<h3 id="编译-riscv-gnu-toolchain"><a href="#编译-riscv-gnu-toolchain" class="headerlink" title="编译 riscv-gnu-toolchain"></a>编译 riscv-gnu-toolchain</h3><p>提前安装如下软件：</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">sudo apt-<span class="hljs-built_in">get</span> install autoconf automake autotools-<span class="hljs-built_in">dev</span> curl python3 libmpc-<span class="hljs-built_in">dev</span> libmpfr-<span class="hljs-built_in">dev</span> libgmp-<span class="hljs-built_in">dev</span> gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-<span class="hljs-built_in">dev</span> libexpat-<span class="hljs-built_in">dev</span><br></code></pre></td></tr></table></figure>

<p>不听老人言，吃亏在眼前呀，本以为这是可选项，很多库都安装了，就没有操作这一步，结果就是编译半天结果还错了。如果报<code>make 错误 127</code>，那就老老实实把前置的这些库都装上。</p>
<p>建立<code>riscv-gnu-toolchain</code>安装目录<code>/opt/riscv64</code>。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">./configure --prefix=<span class="hljs-regexp">/opt/</span>riscv64 <br>sudo make linux -j8<br></code></pre></td></tr></table></figure>

<h3 id="导出安装路径"><a href="#导出安装路径" class="headerlink" title="导出安装路径"></a>导出安装路径</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$PATH</span>:/opt/riscv64/bin&quot;</span><br></code></pre></td></tr></table></figure>

<p>出现一下信息表示安装成功。</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">Using built-in specs.<br>COLLECT_GCC=riscv64-unknown-linux-gnu-gcc<br>COLLECT_LTO_WRAPPER=<span class="hljs-string">/opt/riscv64/libexec/gcc/riscv64-unknown-linux-gnu/10.2.0/lto-wrapper</span><br>Target: riscv64-unknown-linux-gnu<br>Configured with: <span class="hljs-string">/home/dominic/riscv64-linux/riscv-gnu-toolchain/riscv-gcc/configure</span> <span class="hljs-params">--target=riscv64-unknown-linux-gnu</span> <span class="hljs-params">--prefix=/opt/riscv64</span> <span class="hljs-params">--with-sysroot=/opt/riscv64/sysroot</span> <span class="hljs-params">--with-system-zlib</span> <span class="hljs-params">--enable-shared</span> <span class="hljs-params">--enable-tls</span> <span class="hljs-params">--enable-languages=c</span>,c++,fortran <span class="hljs-params">--disable-libmudflap</span> <span class="hljs-params">--disable-libssp</span> <span class="hljs-params">--disable-libquadmath</span> <span class="hljs-params">--disable-libsanitizer</span> <span class="hljs-params">--disable-nls</span> <span class="hljs-params">--disable-bootstrap</span> <span class="hljs-params">--src=</span><span class="hljs-string">.././riscv-gcc</span> <span class="hljs-params">--disable-multilib</span> <span class="hljs-params">--with-abi=lp64d</span> <span class="hljs-params">--with-arch=rv64imafdc</span> <span class="hljs-params">--with-tune=rocket</span> &#x27;CFLAGS_FOR_TARGET=-O2   -mcmodel=medlow&#x27; &#x27;CXXFLAGS_FOR_TARGET=-O2   -mcmodel=medlow&#x27;<br>Thread model: posix<br>Supported LTO compression algorithms: zlib<br>gcc <span class="hljs-keyword">version</span> 10.2.0 <span class="hljs-params">(GCC)</span> <br></code></pre></td></tr></table></figure>

<h2 id="制作内核"><a href="#制作内核" class="headerlink" title="制作内核"></a>制作内核</h2><h3 id="下载-Linux-内核"><a href="#下载-Linux-内核" class="headerlink" title="下载 Linux 内核"></a>下载 Linux 内核</h3><p>makefile</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../../../2021/07/27/QEMU%E6%96%87%E6%A1%A3/" itemprop="url">QEMU 文档</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2021-07-27T03:12:01.000Z" itemprop="datePublished">7月 27 2021</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            23 分钟 lesen (Über 3389 Wörter)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="调用文档"><a href="#调用文档" class="headerlink" title="调用文档"></a>调用文档</h1><p><code>qemu-system-x86_64 [options] [disk_image] </code><br><code>disk_image</code>是 IDE 硬盘 0 的原始硬盘映像。某些目标不需要磁盘映像。</p>
<h2 id="标准参数-Standard-options"><a href="#标准参数-Standard-options" class="headerlink" title="标准参数 Standard options"></a>标准参数 Standard options</h2><h3 id="h"><a href="#h" class="headerlink" title="-h"></a><code>-h</code></h3><ul>
<li><p>功能<br>显示帮助信息并退出</p>
</li>
<li><p>子参数</p>
</li>
<li><p>调用实例</p>
  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-riscv<span class="hljs-number">32</span> -h<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="version"><a href="#version" class="headerlink" title="-version"></a><code>-version</code></h3><ul>
<li><p>功能<br>显示 qemu 版本信息并退出</p>
</li>
<li><p>子参数</p>
</li>
<li><p>调用实例</p>
  <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">qemu-<span class="hljs-keyword">system</span>-riscv32 -<span class="hljs-built_in">version</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="machine-type-name-prop-value"><a href="#machine-type-name-prop-value" class="headerlink" title="-machine [type=]name[,prop=value[,...]]"></a><code>-machine [type=]name[,prop=value[,...]]</code></h3><ul>
<li><p>功能<br>通过名称选择模拟器。使用 <code>-machine help</code> 可以查看可用的模拟器。<br>对于支持跨版本实时迁移兼容性的架构，每个版本都会引入一个新的版本化模拟器类型。例如，2.8.0 版本为 <code>x86_64/i686</code> 架构引入了<code>“pc-i440fx-2.8”</code>和<code>“pc-q35-2.8”</code>。</p>
</li>
<li><p>子参数<br>为了允许用户从 QEMU 2.8.0 版实时迁移到 QEMU 2.9.0 版，2.9.0 版也必须支持<code>“pc-i440fx-2.8”</code>和<code>“pc-q35-2.8”</code>机器。为了允许用户在升级时实时迁移 VMs 跳过多个中间版本，QEMU 的新版本将支持多个以前版本的机器类型。<br>支持的机器属性有：</p>
<ul>
<li><code>accel=accels1[:accels2[:...]]</code><br>This is used to enable an accelerator. Depending on the target architecture, kvm, xen, hax, hvf, nvmm, whpx or tcg can be available. By default, tcg is used. If there is more than one accelerator specified, the next one is used if the previous one fails to initialize.</li>
<li><code>vmport=on|off|auto</code><br>Enables emulation of VMWare IO port, for vmmouse etc. auto says to select the value based on accel. For accel=xen the default is off otherwise the default is on.</li>
<li><code>dump-guest-core=on|off</code><br>Include guest memory in a core dump. The default is on.</li>
<li><code>mem-merge=on|off</code><br>Enables or disables memory merge support. This feature, when supported by the host, de-duplicates identical memory pages among VMs instances (enabled by default).</li>
<li><code>aes-key-wrap=on|off</code><br>Enables or disables AES key wrapping support on s390-ccw hosts. This feature controls whether AES wrapping keys will be created to allow execution of AES cryptographic functions. The default is on.</li>
<li><code>dea-key-wrap=on|off</code><br>Enables or disables DEA key wrapping support on s390-ccw hosts. This feature controls whether DEA wrapping keys will be created to allow execution of DEA cryptographic functions. The default is on.</li>
<li><code>nvdimm=on|off</code><br>Enables or disables NVDIMM support. The default is off.</li>
<li><code>memory-encryption=</code><br>Memory encryption object to use. The default is none.</li>
<li><code>hmat=on|off</code><br>Enables or disables ACPI Heterogeneous Memory Attribute Table (HMAT) support. The default is off.</li>
<li><code>memory-backend=&#39;id&#39;</code><br>An alternative to legacy -mem-path and mem-prealloc options. Allows to use a memory backend as main RAM.<br>For example: <code>:: -object memory-backend-file,id=pc.ram,size=512M,mem-path=/hugetlbfs,prealloc=on,share=on -machine memory-backend=pc.ram -m 512M</code><br>Migration compatibility note: a) as backend id one shall use value of ‘default-ram-id’, advertised by machine type (available via query-machines QMP command), if migration to/from old QEMU (&lt;5.0) is expected. b) for machine types 4.0 and older, user shall use x-use-canonical-path-for-ramblock-id=off backend option if migration to/from old QEMU (&lt;5.0) is expected. For example: :: -object memory-backend-ram,id=pc.ram,size=512M,x-use-canonical-path-for-ramblock-id=off -machine memory-backend=pc.ram -m 512M</li>
</ul>
</li>
<li><p>调用实例：</p>
  <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">qemu-<span class="hljs-keyword">system</span>-riscv32 -machine virt,mem-<span class="hljs-built_in">merge</span>=<span class="hljs-keyword">on</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="cpu-model"><a href="#cpu-model" class="headerlink" title="-cpu model"></a><code>-cpu model</code></h3><ul>
<li>功能<br>选择 CPU 型号（<code>-cpu help</code>显示帮助列表和附加功能的选项）</li>
</ul>
<blockquote>
<p>默认情况会给客户机提供 qemu64 或 qemu32 的基本 CPU 模型。这样做可以对 CPU 特性提供一些高级的过滤功能，让客户机在同一组硬件平台上的动态迁移会更加平滑和安全。<br>在客户机中查看 CPU 信息 (cat /proc/cpuinfo)，model name 就是当前 CPU 模型的名称。</p>
</blockquote>
<ul>
<li><p>调用实例</p>
  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-riscv<span class="hljs-number">32</span> -cpu rv<span class="hljs-number">32</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="accel-name-prop-value"><a href="#accel-name-prop-value" class="headerlink" title="accel name[,prop=value[,...]]"></a><code>accel name[,prop=value[,...]]</code></h3><ul>
<li>功能<br>This is used to enable an accelerator. Depending on the target architecture, kvm, xen, hax, hvf, nvmm, whpx or tcg can be available. By default, tcg is used. If there is more than one accelerator specified, the next one is used if the previous one fails to initialize.</li>
<li>子参数<ul>
<li><code>igd-passthru=on|off</code><br>When Xen is in use, this option controls whether Intel integrated graphics devices can be passed through to the guest (default=off)</li>
<li><code>kernel-irqchip=on|off|split</code><br>Controls KVM in-kernel irqchip support. The default is full acceleration of the interrupt controllers. On x86, split irqchip reduces the kernel attack surface, at a performance cost for non-MSI interrupts. Disabling the in-kernel irqchip completely is not recommended except for debugging purposes.</li>
<li><code>kvm-shadow-mem=size</code><br>Defines the size of the KVM shadow MMU.</li>
<li><code>split-wx=on|off</code><br>Controls the use of split w^x mapping for the TCG code generation buffer. Some operating systems require this to be enabled, and in such a case this will default on. On other operating systems, this will default off, but one may enable this for testing or debugging.</li>
<li><code>tb-size=n</code><br>Controls the size (in MiB) of the TCG translation block cache.</li>
<li><code>thread=single|multi</code><br>Controls number of TCG threads. When the TCG is multi-threaded there will be one thread per vCPU therefore taking advantage of additional host cores. The default is to enable multi-threading where both the back-end and front-ends support it and no incompatible TCG features have been enabled (e.g. icount/replay).</li>
<li><code>dirty-ring-size=n</code><br>When the KVM accelerator is used, it controls the size of the per-vCPU dirty page ring buffer (number of entries for each vCPU). It should be a value that is power of two, and it should be 1024 or bigger (but still less than the maximum value that the kernel supports). 4096 could be a good initial value if you have no idea which is the best. Set this value to 0 to disable the feature. By default, this feature is disabled (dirty-ring-size=0). When enabled, KVM will instead record dirty pages in a bitmap.</li>
</ul>
</li>
</ul>
<h3 id="smp-cpus-n-maxcpus-maxcpus-sockets-sockets-dies-dies-cores-cores-threads-threads"><a href="#smp-cpus-n-maxcpus-maxcpus-sockets-sockets-dies-dies-cores-cores-threads-threads" class="headerlink" title="smp [[cpus=]n][,maxcpus=maxcpus][,sockets=sockets][,dies=dies][,cores=cores][,threads=threads]"></a><code>smp [[cpus=]n][,maxcpus=maxcpus][,sockets=sockets][,dies=dies][,cores=cores][,threads=threads]</code></h3><ul>
<li><p>功能<br>配置客户机的 SMP（Symmetric Multi-Processing），对称多处理机</p>
</li>
<li><p>子参数</p>
<ul>
<li><code>[cpus=]n</code><br>设置客户机中使用逻辑的 CPU 数量（默认值是 1）。</li>
<li><code>[,maxcpus=cpus]</code><br>设置客户机最大可能被使用的 CPU 数量（可以用热插拔 hot-plug 添加 CPU，不能超过 maxcpus 上限）。</li>
<li><code>[,cores=cores]</code><br>设置每个 CPU socket 上的 core 数量（默认值是 1）。</li>
<li><code>[,threads=threads]</code><br>设置每个 CPU core 上的线程数（默认值是 1）。</li>
<li><code>[,sockets=sockets]</code><br>设置客户机中总的 CPU socket 数量。</li>
</ul>
</li>
<li><p>调用实例</p>
</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>  -smp <span class="hljs-number">1</span>,sockets=<span class="hljs-number">1</span>,cores=<span class="hljs-number">2</span>,threads=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<h3 id="numa-node-mem-size-cpus-firstcpu-lastcpu-nodeid-node-initiator-initiator"><a href="#numa-node-mem-size-cpus-firstcpu-lastcpu-nodeid-node-initiator-initiator" class="headerlink" title="-numa node[,mem=size][,cpus=firstcpu[-lastcpu]][,nodeid=node][,initiator=initiator]"></a><code>-numa node[,mem=size][,cpus=firstcpu[-lastcpu]][,nodeid=node][,initiator=initiator]</code></h3><h3 id="numa-node-memdev-id-cpus-firstcpu-lastcpu-nodeid-node-initiator-initiator"><a href="#numa-node-memdev-id-cpus-firstcpu-lastcpu-nodeid-node-initiator-initiator" class="headerlink" title="-numa node[,memdev=id][,cpus=firstcpu[-lastcpu]][,nodeid=node][,initiator=initiator]"></a><code>-numa node[,memdev=id][,cpus=firstcpu[-lastcpu]][,nodeid=node][,initiator=initiator]</code></h3><h3 id="numa-dist-src-source-dst-destination-val-distance"><a href="#numa-dist-src-source-dst-destination-val-distance" class="headerlink" title="-numa dist,src=source,dst=destination,val=distance"></a><code>-numa dist,src=source,dst=destination,val=distance</code></h3><h3 id="numa-cpu-node-id-node-socket-id-x-core-id-y-thread-id-z"><a href="#numa-cpu-node-id-node-socket-id-x-core-id-y-thread-id-z" class="headerlink" title="-numa cpu,node-id=node[,socket-id=x][,core-id=y][,thread-id=z]"></a><code>-numa cpu,node-id=node[,socket-id=x][,core-id=y][,thread-id=z]</code></h3><h3 id="numa-hmat-lb-initiator-node-target-node-hierarchy-hierarchy-data-type-tpye-latency-lat-bandwidth-bw"><a href="#numa-hmat-lb-initiator-node-target-node-hierarchy-hierarchy-data-type-tpye-latency-lat-bandwidth-bw" class="headerlink" title="-numa hmat-lb,initiator=node,target=node,hierarchy=hierarchy,data-type=tpye[,latency=lat][,bandwidth=bw]"></a><code>-numa hmat-lb,initiator=node,target=node,hierarchy=hierarchy,data-type=tpye[,latency=lat][,bandwidth=bw]</code></h3><h3 id="numa-hmat-cache-node-id-node-size-size-level-level-associativity-str-policy-str-line-size"><a href="#numa-hmat-cache-node-id-node-size-size-level-level-associativity-str-policy-str-line-size" class="headerlink" title="-numa hmat-cache,node-id=node,size=size,level=level[,associativity=str][,policy=str][,line=size]"></a><code>-numa hmat-cache,node-id=node,size=size,level=level[,associativity=str][,policy=str][,line=size]</code></h3><ul>
<li>功能</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="add-fd-fd-fd-set-set-opaque-opaque"><a href="#add-fd-fd-fd-set-set-opaque-opaque" class="headerlink" title="-add-fd fd=fd,set=set[,opaque=opaque]"></a><code>-add-fd fd=fd,set=set[,opaque=opaque]</code></h3><ul>
<li>功能</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="set-group-id-arg-value"><a href="#set-group-id-arg-value" class="headerlink" title="-set group.id.arg=value"></a><code>-set group.id.arg=value</code></h3><ul>
<li>功能</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="global-driver-prop-value"><a href="#global-driver-prop-value" class="headerlink" title="-global driver.prop=value"></a><code>-global driver.prop=value</code></h3><ul>
<li>功能</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="global-driver-driver-property-property-value-value"><a href="#global-driver-driver-property-property-value-value" class="headerlink" title="-global driver=driver,property=property,value=value"></a><code>-global driver=driver,property=property,value=value</code></h3><ul>
<li>功能</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="boot-order-drives-once-drives-menu-on-off-splash-sp-name-splash-time-sp-time-reboot-timeout-rb-timeout-strict-on-off"><a href="#boot-order-drives-once-drives-menu-on-off-splash-sp-name-splash-time-sp-time-reboot-timeout-rb-timeout-strict-on-off" class="headerlink" title="-boot [order=drives][,once=drives][,menu=on|off][,splash=sp_name][,splash-time=sp_time][,reboot-timeout=rb_timeout][,strict=on|off]"></a><code>-boot [order=drives][,once=drives][,menu=on|off][,splash=sp_name][,splash-time=sp_time][,reboot-timeout=rb_timeout][,strict=on|off]</code></h3><ul>
<li>功能<br>设置客户机启动顺序</li>
</ul>
<blockquote>
<p>在 qemu 模拟的 x86 平台中，用”a”、”b”分别表示第一和第二软驱，用”c”表示第一个硬盘，用”d”表示 CD-ROM 光驱，用”n”表示从网络启动。<br>默认从硬盘启动。</p>
</blockquote>
<ul>
<li><p>子参数</p>
<ul>
<li><code>[order=drives]</code><br>设置启动顺序。</li>
<li><code>[,once=drives]</code><br>只设置下一次启动的顺序，再重启后无效。</li>
<li><code>[,menu=on|off]</code><br>只要固件/BIOS 支持，就可以启用交互式引导菜单/提示。默认为非交互式引导。</li>
<li><code>[,splash=sp_name]</code><br>如果固件/BIOS 支持选项 splash=sp_name 和 menu=on，则可以将启动画面传递给 bios，使用户能够将其显示为徽标。目前 Seabios for X86 系统支持它。限制：启动文件可以是 24 BPP 格式（真彩色）的 jpeg 文件或 BMP 文件。分辨率应该是 SVGA 模式支持的，推荐 320x240、640x480、800x640。</li>
<li><code>[,splash-time=sp_time]</code></li>
<li><code>[,reboot-timeout=rb_timeout]</code><br>引导失败时，客户机将暂停 <code>rb_timeout</code> 毫秒，然后重新启动。如果 <code>rb_timeout</code> 为 ‘-1’，客户机不会重启，qemu 默认将 ‘-1’ 传递给 bios。目前 Seabios for X86 系统支持它。</li>
<li><code>[,strict=on|off]</code><br>只要固件/BIOS 支持，就通过严格启动。这仅在 bootindex 选项更改引导优先级时有效。默认为非严格引导。</li>
</ul>
</li>
<li><p>调用实例</p>
  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 尝试先从网络启动，然后从硬盘启动</span><br><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> -boot order=nc<br><span class="hljs-comment"># 先从光驱启动，重启后切换回默认顺序</span><br><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> -boot once=d<br><span class="hljs-comment"># 5 秒钟的启动画面。</span><br><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> -boot menu=<span class="hljs-literal">on</span>,splash=/root/boot.bmp,splash-time=<span class="hljs-number">5000</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="m-size-megs-slots-n-maxmem-size"><a href="#m-size-megs-slots-n-maxmem-size" class="headerlink" title="-m [size=]megs[,slots=n,maxmem=size]"></a><code>-m [size=]megs[,slots=n,maxmem=size]</code></h3><ul>
<li><p>功能<br>将客户机内存设置为 <code>megs</code> M字节。默认值为 <code>128 MiB</code>。或者，也可以使用“M”或“G”的后缀。齐。</p>
</li>
<li><p>子参数</p>
<ul>
<li><code>[size=]megs</code><br>将客户机内存设置为 <code>megs</code> M字节</li>
<li><code>[,slots=n,maxmem=size]</code><br>可用于设置可热插拔内存插槽的数量和最大内存数量。<code>maxmem</code> 必须与页面大小对</li>
</ul>
</li>
<li><p>调用实例<br>以下命令行将客户机启动 RAM 大小设置为 1GB，创建 3 个插槽以热插拔额外内存，并将客户机可以达到的最大内存设置为 4GB：</p>
  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> -m <span class="hljs-number">1</span>G,slots=<span class="hljs-number">3</span>,maxmem=<span class="hljs-number">4</span>G<br></code></pre></td></tr></table></figure>

<p>  如果未指定 <code>slot</code> 和 <code>maxmem</code>，则不会启用内存热插拔，并且客户机内存永远不会增加。</p>
</li>
</ul>
<h3 id="mem-path-path"><a href="#mem-path-path" class="headerlink" title="-mem-path path"></a><code>-mem-path path</code></h3><ul>
<li>功能<br>使用huge page。对于内存访问密集型的应用，使用<code>huge page</code>是可以比较明显地提高客户机性能。 使用<code>huge page</code>的内存不能被换出（swap out），也不能使用<code>ballooning</code>方式自动增长。</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="mem-prealloc"><a href="#mem-prealloc" class="headerlink" title="-mem-prealloc"></a><code>-mem-prealloc</code></h3><ul>
<li>功能<br>使宿主机在客户机启动时就全部分配好客户机的内存</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="k-language"><a href="#k-language" class="headerlink" title="-k language"></a><code>-k language</code></h3><ul>
<li><p>功能<br>设置键盘布局语言，默认为<code>en-us</code></p>
</li>
<li><p>子参数<br>可用布局：</p>
  <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">ar</span>  de-ch  es  <span class="hljs-keyword">fo</span>     fr-<span class="hljs-keyword">ca</span>  hu  ja  <span class="hljs-keyword">mk</span>     <span class="hljs-keyword">no</span>  <span class="hljs-keyword">pt</span>-<span class="hljs-keyword">br</span>  <span class="hljs-keyword">sv</span><br>da  <span class="hljs-keyword">en</span>-gb  et  fr     fr-ch  <span class="hljs-keyword">is</span>  <span class="hljs-keyword">lt</span>  nl     pl  <span class="hljs-keyword">ru</span>     <span class="hljs-keyword">th</span><br>de  <span class="hljs-keyword">en</span>-us  fi  fr-<span class="hljs-keyword">be</span>  hr     it  <span class="hljs-keyword">lv</span>  nl-<span class="hljs-keyword">be</span>  <span class="hljs-keyword">pt</span>  <span class="hljs-keyword">sl</span>     <span class="hljs-keyword">tr</span><br></code></pre></td></tr></table></figure></li>
<li><p>调用实例</p>
</li>
</ul>
<h2 id="块设备参数-Block-device-options"><a href="#块设备参数-Block-device-options" class="headerlink" title="块设备参数 Block device options"></a>块设备参数 Block device options</h2><h3 id="fda-file"><a href="#fda-file" class="headerlink" title="fda file"></a><code>fda file</code></h3><ul>
<li>功能<br>为客户机指定软盘设备，指定客户机的第一个软盘设备，在客户机中显示为<code>/dev/fd0</code></li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="fdb-file"><a href="#fdb-file" class="headerlink" title="fdb file"></a><code>fdb file</code></h3><ul>
<li>功能<br>为客户机指定软盘设备，指定客户机的第一个软盘设备，在客户机中显示为<code>/dev/fd1</code></li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="hda-file"><a href="#hda-file" class="headerlink" title="hda file"></a><code>hda file</code></h3><h3 id="hdb-file"><a href="#hdb-file" class="headerlink" title="hdb file"></a><code>hdb file</code></h3><h3 id="hdc-file"><a href="#hdc-file" class="headerlink" title="hdc file"></a><code>hdc file</code></h3><h3 id="hdd-file"><a href="#hdd-file" class="headerlink" title="hdd file"></a><code>hdd file</code></h3><ul>
<li>功能<br>为客户机指定块存储设备，指定客户机种的第一个 IDE 设备</li>
<li>子参数<br>若客户机使用<code>PIIX_IDE</code>驱动，显示为<code>/dev/hda</code>设备；<br>若客户机使用<code>ata_piix</code>驱动，显示为<code>/dev/sda</code>设备。<br>若没有使用<code>-hdx</code>的参数，则默认使用<code>-hda</code>参数；<br>可以将宿主机的一块硬盘作为<code>-hda</code>的参数使用；<br>若文件名包含逗号，应使用两个连续的逗号进行转义。</li>
<li>调用实例</li>
</ul>
<h3 id="cdrom-file"><a href="#cdrom-file" class="headerlink" title="-cdrom file"></a><code>-cdrom file</code></h3><ul>
<li>功能<br>为客户机指定光盘 CD-ROM。可以将宿主机的光驱<code>/dev/cdrom</code>设备作为<code>-cdrom</code>参数使用。<code>-cdrom</code>参数不能与<code>-hdc</code>参数同时使用，因为<code>-cdrom</code>就是客户机里的第三个 IDE 设备</li>
<li>子参数</li>
<li>调用实例</li>
</ul>
<h3 id="blockdev-option-option-option"><a href="#blockdev-option-option-option" class="headerlink" title="-blockdev option[,option[,option[,...]]]"></a><code>-blockdev option[,option[,option[,...]]]</code></h3><ul>
<li><p>功能</p>
</li>
<li><p>子参数</p>
</li>
<li><p>调用实例</p>
</li>
</ul>
<h3 id="drive-option-option-option"><a href="#drive-option-option-option" class="headerlink" title="-drive option[,option[,option[,...]]]"></a><code>-drive option[,option[,option[,...]]]</code></h3><ul>
<li>功能<br>定义一个存储驱动器</li>
<li>子参数<ul>
<li><code>[file=file]</code><br>加载<code>file</code>镜像文件到客户机的驱动器中。</li>
<li><code>[,if=type]</code><br>指定驱动器使用的接口类型：可用的类类型有：<code>ide</code>、<code>scsi</code>、<code>virtio</code>、<code>sd</code>、<code>floopy</code>、<code>pflash</code>等。</li>
<li><code>[,bus=n]</code><br>设置驱动器在客户机中的总线编号。</li>
<li><code>[,unit=m]</code><br>设置驱动器在客户机中的单元编号。</li>
<li><code>[,media=d]</code><br>设置驱动器中媒介的类型，值为 disk 或 cdrom。</li>
<li><code>[,index=i]</code><br>设置在通一种接口的驱动器中的索引编号。</li>
<li><code>[,snapshot=on|off]</code><br>当值为 on 时，qemu 不会将磁盘数据的更改写回到镜像文件中，而是写到临时文件中，可以在 qemu moinitor 中使用 commit 命令强制将磁盘数据保存回镜像文件中。</li>
<li><code>[,cache=writethrough|writeback|none|directsync|unsafe]</code><br>设置宿主机对块设备数据访问的 cache 模式。，<br><code>writethrough</code>（直写模式）：调用 write 写入数据的同时将数据写入磁盘缓存和后端块设备中。<br><code>writeback</code>（回写模式）：调用 write 写入数据时只将数据写入到磁盘缓存中，当数据被换出缓存时才写入到后端存储中。优点写入数据块，缺点系统掉电数据无法恢复。</li>
<li><code>[,aio=threads|native]</code><br>选择异步 IO 的方式</li>
<li><code>threads</code><br>为 aio 参数的默认值，让一个线程池去处理异步 IO；</li>
<li><code>native</code><br>只适用于 cache=none 的情况，使用的是 Linux 原生的 AIO。</li>
<li><code>[,format=f]</code><br>指定使用的磁盘格式，默认是 QEMU 自动检测磁盘格式的。</li>
<li><code>[,serial=s]</code><br>指定分配给设备的序列号。</li>
<li><code>[,addr=A]</code><br>分配给驱动器控制器的 PCI 地址，只在使用 virtio 接口时适用。</li>
<li><code>[,id=name]</code><br>设置驱动器的 ID，可以在 QEMU monitor 中用 info block 看到。<br><code>[,readonly=on|off]</code><br>设置驱动器是否只读。</li>
</ul>
</li>
<li>调用实例</li>
</ul>
<h2 id="USB-参数-USB-convenience-options"><a href="#USB-参数-USB-convenience-options" class="headerlink" title="USB 参数 USB convenience options"></a>USB 参数 USB convenience options</h2><h2 id="显示参数-Display-options"><a href="#显示参数-Display-options" class="headerlink" title="显示参数 Display options"></a>显示参数 Display options</h2><h2 id="仅限-i386-架构的参数-i386-target-only"><a href="#仅限-i386-架构的参数-i386-target-only" class="headerlink" title="仅限 i386 架构的参数 i386 target only"></a>仅限 i386 架构的参数 i386 target only</h2><h2 id="网络参数-Network-options"><a href="#网络参数-Network-options" class="headerlink" title="网络参数 Network options"></a>网络参数 Network options</h2><h2 id="字符设备参数-Character-device-options"><a href="#字符设备参数-Character-device-options" class="headerlink" title="字符设备参数 Character device options"></a>字符设备参数 Character device options</h2><h2 id="TPM-设备-TPM-device-options"><a href="#TPM-设备-TPM-device-options" class="headerlink" title="TPM 设备 TPM device options"></a>TPM 设备 TPM device options</h2><h2 id="指定启动指引-Linux-Multiboot-boot-specific"><a href="#指定启动指引-Linux-Multiboot-boot-specific" class="headerlink" title="指定启动指引 Linux/Multiboot boot specific"></a>指定启动指引 Linux/Multiboot boot specific</h2><p>当使用该调用参数时，你可以使用给定的 Linux 或者多重引导内核，而不需要安装内核到一个光盘中。这样可以更方便地测试不同内核。</p>
<ul>
<li><p><code>-kernel bzImage</code></p>
<ul>
<li>功能<br>用 bzImage 作为内核镜像，也可以使用其他启动格式。</li>
</ul>
</li>
<li><p><code>-append cmdline</code></p>
<ul>
<li>功能<br>用<code>cmd</code>命令行，作为内核的命令行</li>
</ul>
</li>
<li><p><code>-initrd file</code></p>
<ul>
<li>功能<br>用文件作为初始化 ram</li>
</ul>
</li>
<li><p><code>-initrd &quot;file1 arg=foo,file2&quot;</code></p>
<ul>
<li>功能<br>此语法仅适用于多重引导<br>使用 <code>file1</code> 和 <code>file2</code> 作为模块并将 <code>arg=foo</code> 作为参数传递给第一个模块</li>
</ul>
</li>
<li><p><code>-dtb file</code></p>
<ul>
<li>功能<br>将文件用作设备树二进制 (dtb) 映像并在启动时将其传递给内核</li>
</ul>
</li>
</ul>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../../../2021/07/23/QEMU%E5%88%9D%E8%AF%86/" itemprop="url">QEMU 初识</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2021-07-23T03:54:49.000Z" itemprop="datePublished">7月 23 2021</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            7 分钟 lesen (Über 1122 Wörter)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>QEMU 是一款开源的模拟器及虚拟机监管器 (Virtual Machine Monitor, VMM)。QEMU 主要提供两种功能给用户使用。一是作为用户态模拟器，利用动态代码翻译机制来执行不同于主机架构的代码。二是作为虚拟机监管器，模拟全系统，利用其他 VMM(Xen, KVM, etc) 来使用硬件提供的虚拟化支持，创建接近于主机性能的虚拟机。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="使用包管理安装"><a href="#使用包管理安装" class="headerlink" title="使用包管理安装"></a>使用包管理安装</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-builtin-name">get</span> install qemu<br></code></pre></td></tr></table></figure>

<h3 id="使用源码安装"><a href="#使用源码安装" class="headerlink" title="使用源码安装"></a>使用源码安装</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> wget https://download.qemu.org/qemu-<span class="hljs-number">6</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-rc<span class="hljs-number">3</span>.tar.xz<br><span class="hljs-attribute">tar</span> xvJf qemu-<span class="hljs-number">6</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-rc<span class="hljs-number">3</span>.tar.xz<br><span class="hljs-attribute">cd</span> qemu-<span class="hljs-number">6</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-rc<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>

<h3 id="安装相关库"><a href="#安装相关库" class="headerlink" title="安装相关库"></a>安装相关库</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">apt-get <span class="hljs-keyword">install </span>libglib2.<span class="hljs-number">0</span>-dev<br>apt-get <span class="hljs-keyword">install </span>ninja-<span class="hljs-keyword">build</span><br><span class="hljs-keyword"></span>apt <span class="hljs-keyword">install </span>g++<br>apt <span class="hljs-keyword">install </span>libpixman<span class="hljs-number">-1</span>-dev<br>apt <span class="hljs-keyword">install </span>libsdl2-dev -y<br></code></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>通过<code>./configure --help</code> 的查看编译时的选项，<code>--target-list</code>选项为可选的模拟器，默认全选。<br><code>--target-list</code> 中的 <code>xxx-soft</code> 和 <code>xxx-linux-user</code> 分别指系统模拟器和应用程序模拟器，生成的二进制文件名字为<code>qemu-system-xxx</code>和 <code>qemu-xxx</code><br>本文使用如下配置：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">./configure <span class="hljs-attribute">--prefix</span>=XXX --enable-<span class="hljs-builtin-name">debug</span> <span class="hljs-attribute">--target-list</span>=riscv32-softmmu,riscv32-linux-user,riscv64-linux-user,riscv64-softmmu --enable-kvm<br><span class="hljs-comment"># --prefix 选项设置qemu的安装位置绝对路径，之后若要卸载删除qemu只要删除该文件夹即可，--enable-kvm开启kvm</span><br><span class="hljs-comment"># config完，可以在指定的qemu安装文件夹下面找到config-host.mak文件，</span><br><span class="hljs-comment"># 该文件记录着qemu配置的选项，可以和自己设置的进行对比，确保配置和自己已知</span><br></code></pre></td></tr></table></figure>

<p>接着进行编译</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">make</span> -j<span class="hljs-number">8</span><br></code></pre></td></tr></table></figure>

<p>直接<code>make</code>会很慢，第一次编译时默认安装说有模拟器，编译了三四个小时。加上<code>-j8</code>可以进行多线程编译</p>
<h2 id="创建与使用"><a href="#创建与使用" class="headerlink" title="创建与使用"></a>创建与使用</h2><h3 id="创建虚拟镜像"><a href="#创建虚拟镜像" class="headerlink" title="创建虚拟镜像"></a>创建虚拟镜像</h3><p>使用虚拟镜像来模拟虚拟机的硬盘，在启动虚拟机之前需要创建一个镜像文件</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># qemu-img create -f qcow2 qmtest.img 10G</span><br>Formatting <span class="hljs-string">&#x27;qmtest.img&#x27;</span>, fmt=qcow2 size=<span class="hljs-number">10737418240</span> encryption=off cluster_size=<span class="hljs-number">65536</span> lazy_refcounts=off <br>root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># ls</span><br>qmtest.img<br></code></pre></td></tr></table></figure>

<p><code>-f</code>选项用于指定镜像的格式，<code>qcow2</code>格式是 QEMU 最常用的镜像格式，采用写时复制技术来优化性能。<code>qmtest.img</code>是镜像文件的名字，<code>10G</code>是镜像文件大小。</p>
<p>镜像文件创建完成后，可使用<code>qemu-system-x86</code>来启动<code>x86</code>架构的虚拟机：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> qmtest.img<br></code></pre></td></tr></table></figure>

<p>qmtest.img 中还未安装操作系统，所以会提示“No bootable device”的错误。</p>
<h3 id="准备操作系统镜像"><a href="#准备操作系统镜像" class="headerlink" title="准备操作系统镜像"></a>准备操作系统镜像</h3><p>下载需要的 Linux 发行版镜像文件，<a target="_blank" rel="noopener" href="https://launchpad.net/ubuntu/+cdmirrors">https://launchpad.net/ubuntu/+cdmirrors</a>，找到想要下载的镜像，这里以交通大学的镜像为例<br>右击链接复制地址：<a target="_blank" rel="noopener" href="https://ftp.sjtu.edu.cn/ubuntu-cd/20.10/ubuntu-20.10-live-server-amd64.iso">https://ftp.sjtu.edu.cn/ubuntu-cd/20.10/ubuntu-20.10-live-server-amd64.iso</a></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># wget https://ftp.sjtu.edu.cn/ubuntu-cd/20.10/ubuntu-20.10-live-server-amd64.iso</span><br></code></pre></td></tr></table></figure>

<h3 id="检查-KVM-是否可用"><a href="#检查-KVM-是否可用" class="headerlink" title="检查 KVM 是否可用"></a>检查 KVM 是否可用</h3><p>QEMU 使用 KVM 来提升虚拟机性能，如果不启用 KVM 会导致性能损失。要使用 KVM，首先要检查硬件是否有虚拟化支持：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># grep -E &#x27;vmx|svm&#x27; /proc/cpuinfo</span><br></code></pre></td></tr></table></figure>

<p>如果有输出则表示硬件有虚拟化支持。其次要检查 kvm 模块是否已经加载：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># lsmod | grep kvm</span><br>kvm_intel             <span class="hljs-number">142999</span>  0 <br>kvm                   <span class="hljs-number">444314</span>  <span class="hljs-number">1</span> kvm_intel<br></code></pre></td></tr></table></figure>

<p>如果<code>kvm_intel/kvm_amd</code>、<code>kvm</code>模块被显示出来，则<code>kvm</code>模块已经加载。最后要确保 qemu 在编译的时候使能了<code>KVM</code>，即在执行<code>configure</code>脚本的时候加入了<code>–enable-kvm</code>选项。</p>
<h3 id="启动虚拟机安装操作系统"><a href="#启动虚拟机安装操作系统" class="headerlink" title="启动虚拟机安装操作系统"></a>启动虚拟机安装操作系统</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># qemu-system-x86_64 -m 2048 -enable-kvm qmtest.img -cdrom ./Fedora-Live-Desktop-x86_64-20-1.iso</span><br></code></pre></td></tr></table></figure>

<p><code>-m</code>指定虚拟机内存大小，默认单位是 MB，<code>-enable-kvm</code>使用 KVM 进行加速，<code>-cdrom</code>添加 fedora 的安装镜像。可在弹出的窗口中操作虚拟机，安装操作系统，安装完成后重起虚拟机便会从硬盘 (qmtest.img) 启动。之后再启动虚拟机只需要执行：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment">#  qemu-system-x86_64 -m 2048 -enable-kvm qmtest.img</span><br></code></pre></td></tr></table></figure>

<h2 id="退出-qemu"><a href="#退出-qemu" class="headerlink" title="退出 qemu"></a>退出 qemu</h2><p>在运行 qemu 后，关闭图形界面但是终端仍然是处于 qemu 环境中，可以直接关闭终端退出。如果不想关闭终端，可以另外打开一个终端 kill 进程</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">killall</span> qemu-system-riscv<span class="hljs-number">32</span><br></code></pre></td></tr></table></figure>

<p>如果记不清全称，可以输入大概名称回车后会列出相关的进程</p>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="../../../../2021/07/20/QEMU%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" itemprop="url">QEMU 学习记录</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2021-07-20T08:51:34.000Z" itemprop="datePublished">7月 20 2021</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            14 分钟 lesen (Über 2132 Wörter)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="QEMU-学习记录"><a href="#QEMU-学习记录" class="headerlink" title="QEMU 学习记录"></a>QEMU 学习记录</h1><h2 id="什么是-KVM？"><a href="#什么是-KVM？" class="headerlink" title="什么是 KVM？"></a>什么是 KVM？</h2><p>基于内核的虚拟机 <code>Kernel-based Virtual Machine（KVM）</code>是一种内建于 Linux 中的开源虚拟化技术。具体而言，<code>KVM</code> 可帮助用户将 Linux 转变为虚拟机监控程序，使主机计算机能够运行多个隔离的虚拟环境，即虚拟客户机或虚拟机（VM）。</p>
<h2 id="什么是-QEMU？"><a href="#什么是-QEMU？" class="headerlink" title="什么是 QEMU？"></a>什么是 QEMU？</h2><p>Qemu 是一个完整的可以单独运行的软件，它可以用来模拟不同架构的机器，非常灵活和可移植。它主要通过一个特殊的’重编译器’将为特定处理器编写二进制代码转换为另一种。</p>
<h2 id="KVM-与-QEMU-的关系"><a href="#KVM-与-QEMU-的关系" class="headerlink" title="KVM 与 QEMU 的关系"></a>KVM 与 QEMU 的关系</h2><p>KVM 是 Linux 的一个模块。可以用<code>modprobe</code>去加载 KVM 模块。加载了模块后，才能进一步通过其他工具创建虚拟机。但仅有 KVM 模块是 远远不够的，因为用户无法直接控制内核模块去作事情：还必须有一个用户空间的工具才行。这个用户空间的工具，开发者选择了已经成型的开源虚拟化软件 QEMU。KVM 使用了 QEMU 的一部分，并稍加改造，就成了可控制 KVM 的用户空间工具了。所以你会看到，官方提供的 KVM 下载有两 大部分三个文件，分别是 KVM 模块、QEMU 工具以及二者的合集。也就是说，你可以只升级 KVM 模块，也可以只升级 QEMU 工具。</p>
<h2 id="QEMU-用户模式与系统模式"><a href="#QEMU-用户模式与系统模式" class="headerlink" title="QEMU 用户模式与系统模式"></a>QEMU 用户模式与系统模式</h2><p>QEMU 属于应用层的仿真程序，它支持两种操作模式：<strong>用户模式</strong>模拟和<strong>系统模式</strong>模拟。</p>
<ul>
<li><strong>用户模式仿真</strong> 利用动态代码翻译机制，可以在当前 CPU 上执行被编译为支持其他 CPU 的程序，如可以在 x86 机器上执行一个 ARM 二进制可执行程序。（执行主机 CPU 指令的动态翻译并相应地转换 Linux 系统调用）。</li>
<li><strong>系统模式仿真</strong> 利用其它 VMM(Xen, KVM) 来使用硬件提供的虚拟化支持，创建接近于主机性能的全功能虚拟机，包括处理器和配套的外围设备（磁盘，以太网等）。</li>
</ul>
<h3 id="用户模式"><a href="#用户模式" class="headerlink" title="用户模式"></a>用户模式</h3><p>支持的 CPU：x86 (32 and 64 bit), PowerPC (32 and 64 bit), ARM, MIPS (32 bit only), Sparc (32 and 64 bit), Alpha, ColdFire(m68k), CRISv32 和 MicroBlaze<br>下列操作系统支持 QEMU 的用户模式模拟：</p>
<ul>
<li>Linux (referred as qemu-linux-user)</li>
<li>BSD (referred as qemu-bsd-user)</li>
</ul>
<p>调用（<a target="_blank" rel="noopener" href="https://qemu.readthedocs.io/en/latest/user/main.html">具体参数含义</a>）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">qemu-i386 <span class="hljs-selector-attr">[-h]</span> <span class="hljs-selector-attr">[-d]</span> <span class="hljs-selector-attr">[-L path]</span> <span class="hljs-selector-attr">[-s size]</span> <span class="hljs-selector-attr">[-cpu model]</span> <span class="hljs-selector-attr">[-g port]</span> <span class="hljs-selector-attr">[-B offset]</span> <span class="hljs-selector-attr">[-R size]</span> program <span class="hljs-selector-attr">[arguments...]</span><br></code></pre></td></tr></table></figure>

<p>用户模式模拟环境下运行速度要比系统模式模拟环境下快，但并不是完美模拟，比如程序读取<code>/proc/cpuinfo</code>内容时，由主机内核返回，因此返回的信息是描述主机 CPU 的，而不是模拟的 CPU。</p>
<h3 id="系统模式"><a href="#系统模式" class="headerlink" title="系统模式"></a>系统模式</h3><p>首先创建虚拟镜像，模拟硬盘空间：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># qemu-img create -f qcow2 qmtest.img 10G</span><br>Formatting <span class="hljs-string">&#x27;qmtest.img&#x27;</span>, fmt=qcow2 size=<span class="hljs-number">10737418240</span> encryption=off cluster_size=<span class="hljs-number">65536</span> lazy_refcounts=off <br>root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># ls</span><br>qmtest.img<br></code></pre></td></tr></table></figure>

<p><code>-f</code>选项用于指定镜像的格式，<code>qcow2</code>格式是 QEMU 最常用的镜像格式，采用写时复制技术来优化性能。<code>qmtest.img</code>是镜像文件的名字，<code>10G</code>是镜像文件大小。</p>
<p>镜像文件创建完成后，可使用<code>qemu-system-x86</code>来启动<code>x86</code>架构的虚拟机：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> qmtest.img<br></code></pre></td></tr></table></figure>

<p>qmtest.img 中还未安装操作系统，所以会提示“No bootable device”的错误。</p>
<p>其次，准备操作系统镜像<br>下载需要的 Linux 发行版镜像文件，<a target="_blank" rel="noopener" href="https://launchpad.net/ubuntu/+cdmirrors">https://launchpad.net/ubuntu/+cdmirrors</a>，找到想要下载的镜像，这里以交通大学的镜像为例<br>右击链接复制地址：<a target="_blank" rel="noopener" href="https://ftp.sjtu.edu.cn/ubuntu-cd/20.10/ubuntu-20.10-live-server-amd64.iso">https://ftp.sjtu.edu.cn/ubuntu-cd/20.10/ubuntu-20.10-live-server-amd64.iso</a></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># wget https://ftp.sjtu.edu.cn/ubuntu-cd/20.10/ubuntu-20.10-live-server-amd64.iso</span><br></code></pre></td></tr></table></figure>

<p>最后，启动虚拟机安装操作系统</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@hanhan</span><span class="hljs-symbol">:/home/dominic/qemu/</span><span class="hljs-comment"># qemu-system-x86_64 -m 2048 -enable-kvm qmtest.img -cdrom ./Fedora-Live-Desktop-x86_64-20-1.iso</span><br></code></pre></td></tr></table></figure>

<p><code>-m</code>指定虚拟机内存大小，默认单位是 MB，<code>-enable-kvm</code>使用 KVM 进行加速，<code>-cdrom</code>添加 fedora 的安装镜像。</p>
<p>该模式下，要比用户模式模拟慢得多，因为模拟了目标内核，以及设备输入/输出、中断等。</p>
<h2 id="QEMU-工作原理"><a href="#QEMU-工作原理" class="headerlink" title="QEMU 工作原理"></a>QEMU 工作原理</h2><p><img src="https://picbed-1311007548.cos.ap-shanghai.myqcloud.com/markdown_picbed/img/20210721140349.png"><br>单纯使用 qemu，采用的是完全虚拟化的模式。qemu 向 Guest OS 模拟 CPU，也模拟其他的硬件，GuestOS 认为自己和硬件直接打交道，其实是同 qemu 模拟出来的硬件打交道，qemu 会将这些指令转译给真正的硬件。由于所有的指令都要从 qemu 里面过一手，因而性能就会比较差。</p>
<p>完全虚拟化是非常慢的，所以要使用硬件辅助虚拟化技术 <code>Intel-VT</code>，<code>AMD-V</code>，所以需要 CPU 硬件开启这个标志位，一般在 BIOS 里面设置。当确认开始了标志位之后，通过<code>KVM</code>，GuestOS 的 CPU 指令不用经过 Qemu 转译，直接运行，大大提高了速度。所以，<code>KVM</code> 在内核里面需要有一个模块，来设置当前 CPU 是 Guest OS 在用，还是 Host OS 在用。</p>
<p>可以通过如下命令查看内核模块中是否有 KVM</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">lsmod <span class="hljs-string">| grep kvm</span><br></code></pre></td></tr></table></figure>

<p>KVM 内核模块通过 <code>/dev/kvm</code> 暴露接口，用户态程序可以通过 <code>ioctl</code>来访问这个接口。Qemu 将 KVM 整合进来，将有关 CPU 指令的部分交由内核模块来做，就是 <code>qemu-kvm (qemu-system-XXX)</code>。</p>
<p>qemu 和 kvm 整合之后，CPU 的性能问题解决了。另外 Qemu 还会模拟其他的硬件，如网络和硬盘。同样，全虚拟化的方式也会影响这些设备的性能。</p>
<p>于是，qemu 采取半虚拟化的方式，让 Guest OS 加载特殊的驱动来做这件事情。</p>
<p>例如，网络需要加载 <code>virtio_net</code>，存储需要加载 <code>virtio_blk</code>，Guest 需要安装这些半虚拟化驱动，GuestOS 知道自己是虚拟机，所以数据会直接发送给半虚拟化设备，经过特殊处理（例如排队、缓存、批量处理等性能优化方式），最终发送给真正的硬件。这在一定程度上提高了性能。</p>
<blockquote>
<p>Q : 系统模式和用户模式的区别？<br>系统模式 是 qemu 虚拟出一套完整的硬件环境，包含 CPU，内存，网卡，硬盘，对于虚拟机上运行的 OS 看到的和硬件和真实的是一样的。<br>用户模式是直接将可执行的文件进行指令翻译，只虚拟出 CPU。<br>假设有 KVM：host 是 x86，QEMU 虚拟出 x86 的系统模式 运行 Windows 系统。QEMU 会将 Windows 指令直接交给  host CPU 直接运行（这个功能是由 KVM 实现的，相当于直接调用 host CPU），性能损失小。内存，硬盘，网络等外设是由 qemu 虚拟出来的。<br>假设无 KVM：host 是 x86，QEMU 虚拟出 x86 的系统模式运行 Windows 系统。QEMU 会将 Windows 指令翻译成中间码，中间码再转成   host CPU 指令（这个功能是由 qemu TCG 实现的），性能损失大。内存，硬盘，网洛等外设是由 qemu 虚拟出来的。<br>假设有 KVM：host 是 x86，QEMU 虚拟出 RISC-V 的系统模式 运行 Linux 系统。QEMU 会将 Linux 指令翻译成中间码，中间码再转成 host CPU 指令（这个功能是由 qemu TCG 实现的），性能损失大。内存，硬盘，网洛等外设是由 qemu 虚拟出来的。<br>KVM 需要在虚拟机与宿主机架构相同时才生效。<br>此外，用户模式下调用 IO 硬件会报错。qemu 系统模式下会模拟出所有设备，但是模拟的 IO 设备效率低，所以后来有了半虚拟化。</p>
</blockquote>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous">
        <a href="../../">Vorheriges</a>
    </div>
    <div class="pagination-next is-invisible is-hidden-mobile">
        <a href="../3/">Nächstes</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link" href="../../">1</a></li>
        
        <li><a class="pagination-link is-current" href="">2</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Dominic&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>




<script src="../../../../js/script.js"></script>


    
</body>
</html>